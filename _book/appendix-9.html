<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Another set of solutions and notes to ‘R for Data Science’</title>
  <meta name="description" content="My notes and solutions to ‘R for Data Science’ by Garrett Grolemund and Hadley Wickham">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Another set of solutions and notes to ‘R for Data Science’" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="My notes and solutions to ‘R for Data Science’ by Garrett Grolemund and Hadley Wickham" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Another set of solutions and notes to ‘R for Data Science’" />
  
  <meta name="twitter:description" content="My notes and solutions to ‘R for Data Science’ by Garrett Grolemund and Hadley Wickham" />
  

<meta name="author" content="Bryan Shalloway">


<meta name="date" content="2019-05-24">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="ch-24-model-building.html">
<link rel="next" href="ch-25-many-models.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.8.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.39.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.39.2/plotly-latest.min.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.3.1/str_view.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Purpose of this book</a></li>
<li class="chapter" data-level="2" data-path="features-of-this-book.html"><a href="features-of-this-book.html"><i class="fa fa-check"></i><b>2</b> Features of this book</a></li>
<li class="chapter" data-level="3" data-path="origin-of-this-book.html"><a href="origin-of-this-book.html"><i class="fa fa-check"></i><b>3</b> Origin of this book</a></li>
<li class="chapter" data-level="4" data-path="plug-for-r4ds.html"><a href="plug-for-r4ds.html"><i class="fa fa-check"></i><b>4</b> Plug for R4DS</a><ul>
<li class="chapter" data-level="4.1" data-path="plug-for-r4ds.html"><a href="plug-for-r4ds.html#plug-for-r4ds-1"><i class="fa fa-check"></i><b>4.1</b> Plug for R4DS</a></li>
<li class="chapter" data-level="4.2" data-path="plug-for-r4ds.html"><a href="plug-for-r4ds.html#acknowledgements"><i class="fa fa-check"></i><b>4.2</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-3.html"><a href="chapter-3.html"><i class="fa fa-check"></i><b>5</b> Chapter 3</a><ul>
<li class="chapter" data-level="5.1" data-path="chapter-3.html"><a href="chapter-3.html#first-steps"><i class="fa fa-check"></i><b>5.1</b> 3.2: First steps</a><ul>
<li class="chapter" data-level="5.1.1" data-path="chapter-3.html"><a href="chapter-3.html#section"><i class="fa fa-check"></i><b>5.1.1</b> 3.2.4</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chapter-3.html"><a href="chapter-3.html#aesthetic-mappings"><i class="fa fa-check"></i><b>5.2</b> 3.3: Aesthetic mappings</a><ul>
<li class="chapter" data-level="5.2.1" data-path="chapter-3.html"><a href="chapter-3.html#section-1"><i class="fa fa-check"></i><b>5.2.1</b> 3.3.1.</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chapter-3.html"><a href="chapter-3.html#facets"><i class="fa fa-check"></i><b>5.3</b> 3.5: Facets</a><ul>
<li class="chapter" data-level="5.3.1" data-path="chapter-3.html"><a href="chapter-3.html#section-2"><i class="fa fa-check"></i><b>5.3.1</b> 3.5.1.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="chapter-3.html"><a href="chapter-3.html#geometric-objects"><i class="fa fa-check"></i><b>5.4</b> 3.6: Geometric Objects</a><ul>
<li class="chapter" data-level="5.4.1" data-path="chapter-3.html"><a href="chapter-3.html#section-3"><i class="fa fa-check"></i><b>5.4.1</b> 3.6.1</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="chapter-3.html"><a href="chapter-3.html#statistical-transformations"><i class="fa fa-check"></i><b>5.5</b> 3.7: statistical transformations</a><ul>
<li class="chapter" data-level="5.5.1" data-path="chapter-3.html"><a href="chapter-3.html#section-4"><i class="fa fa-check"></i><b>5.5.1</b> 3.7.1.</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="chapter-3.html"><a href="chapter-3.html#position-adjjustment"><i class="fa fa-check"></i><b>5.6</b> 3.8: Position Adjjustment</a><ul>
<li class="chapter" data-level="5.6.1" data-path="chapter-3.html"><a href="chapter-3.html#section-5"><i class="fa fa-check"></i><b>5.6.1</b> 3.8.1.</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="chapter-3.html"><a href="chapter-3.html#coordinate-systems"><i class="fa fa-check"></i><b>5.7</b> 3.9: Coordinate systems</a><ul>
<li class="chapter" data-level="5.7.1" data-path="chapter-3.html"><a href="chapter-3.html#section-6"><i class="fa fa-check"></i><b>5.7.1</b> 3.9.1.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>6</b> Appendix</a><ul>
<li class="chapter" data-level="6.1" data-path="appendix.html"><a href="appendix.html#extension"><i class="fa fa-check"></i><b>6.1</b> 3.7.1.1 extension</a></li>
<li class="chapter" data-level="6.2" data-path="appendix.html"><a href="appendix.html#position-adustments"><i class="fa fa-check"></i><b>6.2</b> 3.8: Position adustments</a></li>
<li class="chapter" data-level="6.3" data-path="appendix.html"><a href="appendix.html#coordinate-systems-1"><i class="fa fa-check"></i><b>6.3</b> 3.9: Coordinate systems</a></li>
<li class="chapter" data-level="6.4" data-path="appendix.html"><a href="appendix.html#add-in-table-of-contents-and-other-details"><i class="fa fa-check"></i><b>6.4</b> add in table of contents and other details…</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ch-5.html"><a href="ch-5.html"><i class="fa fa-check"></i><b>7</b> ch. 5</a><ul>
<li class="chapter" data-level="7.1" data-path="ch-5.html"><a href="ch-5.html#filter-rows"><i class="fa fa-check"></i><b>7.1</b> 5.2: Filter rows</a></li>
<li class="chapter" data-level="7.2" data-path="ch-5.html"><a href="ch-5.html#section-7"><i class="fa fa-check"></i><b>7.2</b> 5.2.4.</a><ul>
<li class="chapter" data-level="7.2.1" data-path="ch-5.html"><a href="ch-5.html#section-8"><i class="fa fa-check"></i><b>7.2.1</b> 5.3.1.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ch-5.html"><a href="ch-5.html#grouped-summaries"><i class="fa fa-check"></i><b>7.3</b> 5.6: Grouped summaries</a><ul>
<li class="chapter" data-level="7.3.1" data-path="ch-5.html"><a href="ch-5.html#section-9"><i class="fa fa-check"></i><b>7.3.1</b> 5.6.7.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ch-5.html"><a href="ch-5.html#grouped-mutates-and-filters"><i class="fa fa-check"></i><b>7.4</b> Grouped mutates (and filters)</a><ul>
<li class="chapter" data-level="7.4.1" data-path="ch-5.html"><a href="ch-5.html#section-10"><i class="fa fa-check"></i><b>7.4.1</b> 5.7.1.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="appendix-1.html"><a href="appendix-1.html"><i class="fa fa-check"></i><b>8</b> Appendix</a><ul>
<li class="chapter" data-level="8.1" data-path="appendix-1.html"><a href="appendix-1.html#section-11"><i class="fa fa-check"></i><b>8.1</b> 5.4.1.3.</a></li>
<li class="chapter" data-level="8.2" data-path="appendix-1.html"><a href="appendix-1.html#section-12"><i class="fa fa-check"></i><b>8.2</b> 5.5.2.1.</a></li>
<li class="chapter" data-level="8.3" data-path="appendix-1.html"><a href="appendix-1.html#section-13"><i class="fa fa-check"></i><b>8.3</b> 5.5.2.2</a><ul>
<li class="chapter" data-level="8.3.1" data-path="appendix-1.html"><a href="appendix-1.html#closer-look-at-air_time"><i class="fa fa-check"></i><b>8.3.1</b> Closer look at <code>air_time</code></a></li>
<li class="chapter" data-level="8.3.2" data-path="appendix-1.html"><a href="appendix-1.html#other-plots-with-air_time"><i class="fa fa-check"></i><b>8.3.2</b> Other plots with <code>air_time</code></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="appendix-1.html"><a href="appendix-1.html#section-14"><i class="fa fa-check"></i><b>8.4</b> 5.6.7.1.</a></li>
<li class="chapter" data-level="8.5" data-path="appendix-1.html"><a href="appendix-1.html#section-15"><i class="fa fa-check"></i><b>8.5</b> 5.6.7.4.</a></li>
<li class="chapter" data-level="8.6" data-path="appendix-1.html"><a href="appendix-1.html#section-16"><i class="fa fa-check"></i><b>8.6</b> 5.6.7.5.</a><ul>
<li class="chapter" data-level="8.6.1" data-path="appendix-1.html"><a href="appendix-1.html#modeling-approach"><i class="fa fa-check"></i><b>8.6.1</b> Modeling approach</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="appendix-1.html"><a href="appendix-1.html#section-17"><i class="fa fa-check"></i><b>8.7</b> 5.6.7.6.</a></li>
<li class="chapter" data-level="8.8" data-path="appendix-1.html"><a href="appendix-1.html#section-18"><i class="fa fa-check"></i><b>8.8</b> 5.7.1.6.</a></li>
<li class="chapter" data-level="8.9" data-path="appendix-1.html"><a href="appendix-1.html#section-19"><i class="fa fa-check"></i><b>8.9</b> 5.7.1.5</a></li>
<li class="chapter" data-level="8.10" data-path="appendix-1.html"><a href="appendix-1.html#section-20"><i class="fa fa-check"></i><b>8.10</b> 5.7.1.8.</a></li>
<li class="chapter" data-level="8.11" data-path="appendix-1.html"><a href="appendix-1.html#other"><i class="fa fa-check"></i><b>8.11</b> Other</a><ul>
<li class="chapter" data-level="8.11.1" data-path="appendix-1.html"><a href="appendix-1.html#on-piping-dots"><i class="fa fa-check"></i><b>8.11.1</b> On piping dots</a></li>
</ul></li>
<li class="chapter" data-level="8.12" data-path="appendix-1.html"><a href="appendix-1.html#plotly"><i class="fa fa-check"></i><b>8.12</b> plotly</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ch-7-data-exploration.html"><a href="ch-7-data-exploration.html"><i class="fa fa-check"></i><b>9</b> ch. 7, data exploration</a><ul>
<li class="chapter" data-level="9.1" data-path="ch-7-data-exploration.html"><a href="ch-7-data-exploration.html#variation"><i class="fa fa-check"></i><b>9.1</b> 7.3. Variation</a><ul>
<li class="chapter" data-level="9.1.1" data-path="ch-7-data-exploration.html"><a href="ch-7-data-exploration.html#section-21"><i class="fa fa-check"></i><b>9.1.1</b> 7.3.4.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="ch-7-data-exploration.html"><a href="ch-7-data-exploration.html#missing-values"><i class="fa fa-check"></i><b>9.2</b> 7.4. Missing values</a><ul>
<li class="chapter" data-level="9.2.1" data-path="ch-7-data-exploration.html"><a href="ch-7-data-exploration.html#section-22"><i class="fa fa-check"></i><b>9.2.1</b> 7.4.1.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="ch-7-data-exploration.html"><a href="ch-7-data-exploration.html#covariation"><i class="fa fa-check"></i><b>9.3</b> 7.5. Covariation</a><ul>
<li class="chapter" data-level="9.3.1" data-path="ch-7-data-exploration.html"><a href="ch-7-data-exploration.html#section-23"><i class="fa fa-check"></i><b>9.3.1</b> 7.5.1.1.</a></li>
<li class="chapter" data-level="9.3.2" data-path="ch-7-data-exploration.html"><a href="ch-7-data-exploration.html#section-24"><i class="fa fa-check"></i><b>9.3.2</b> 7.5.2.1.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="ch-7-data-exploration.html"><a href="ch-7-data-exploration.html#two-continuous-variables"><i class="fa fa-check"></i><b>9.4</b> 7.5.3 Two continuous variables</a><ul>
<li class="chapter" data-level="9.4.1" data-path="ch-7-data-exploration.html"><a href="ch-7-data-exploration.html#section-25"><i class="fa fa-check"></i><b>9.4.1</b> 7.5.3.1.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="appendix-2.html"><a href="appendix-2.html"><i class="fa fa-check"></i><b>10</b> Appendix</a><ul>
<li class="chapter" data-level="10.1" data-path="appendix-2.html"><a href="appendix-2.html#section-26"><i class="fa fa-check"></i><b>10.1</b> 7.5.2.1.2.</a></li>
<li class="chapter" data-level="10.2" data-path="appendix-2.html"><a href="appendix-2.html#section-27"><i class="fa fa-check"></i><b>10.2</b> 7.5.3.1.4.</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ch-10-tibbles.html"><a href="ch-10-tibbles.html"><i class="fa fa-check"></i><b>11</b> ch. 10: Tibbles</a><ul>
<li class="chapter" data-level="11.1" data-path="ch-10-tibbles.html"><a href="ch-10-tibbles.html#section-28"><i class="fa fa-check"></i><b>11.1</b> 10.5</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ch-11-data-import.html"><a href="ch-11-data-import.html"><i class="fa fa-check"></i><b>12</b> ch. 11: Data import</a><ul>
<li class="chapter" data-level="12.1" data-path="ch-11-data-import.html"><a href="ch-11-data-import.html#section-29"><i class="fa fa-check"></i><b>12.1</b> 11.2.2.</a></li>
<li class="chapter" data-level="12.2" data-path="ch-11-data-import.html"><a href="ch-11-data-import.html#section-30"><i class="fa fa-check"></i><b>12.2</b> 11.3.5.</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html"><i class="fa fa-check"></i><b>13</b> ch. 12: Tidy data</a><ul>
<li class="chapter" data-level="13.1" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html#tidy-data"><i class="fa fa-check"></i><b>13.1</b> 12.2: Tidy data</a><ul>
<li class="chapter" data-level="13.1.1" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html#section-31"><i class="fa fa-check"></i><b>13.1.1</b> 12.2.1.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html#spreading-and-gathering"><i class="fa fa-check"></i><b>13.2</b> 12.3: Spreading and gathering</a><ul>
<li class="chapter" data-level="13.2.1" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html#section-32"><i class="fa fa-check"></i><b>13.2.1</b> 12.3.3.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html#separating-and-uniting"><i class="fa fa-check"></i><b>13.3</b> 12.4: Separating and uniting</a><ul>
<li class="chapter" data-level="13.3.1" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html#section-33"><i class="fa fa-check"></i><b>13.3.1</b> 12.4.3.</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html#missing-values-1"><i class="fa fa-check"></i><b>13.4</b> 12.5: missing values</a><ul>
<li class="chapter" data-level="13.4.1" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html#section-34"><i class="fa fa-check"></i><b>13.4.1</b> 12.5.1.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html#case-study"><i class="fa fa-check"></i><b>13.5</b> 12.6 Case Study</a><ul>
<li class="chapter" data-level="13.5.1" data-path="ch-12-tidy-data.html"><a href="ch-12-tidy-data.html#section-35"><i class="fa fa-check"></i><b>13.5.1</b> 12.6.1.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="ch-13-relational-data.html"><a href="ch-13-relational-data.html"><i class="fa fa-check"></i><b>14</b> ch. 13: Relational data</a><ul>
<li class="chapter" data-level="14.1" data-path="ch-13-relational-data.html"><a href="ch-13-relational-data.html#nycflights13"><i class="fa fa-check"></i><b>14.1</b> 13.2 nycflights13</a><ul>
<li class="chapter" data-level="14.1.1" data-path="ch-13-relational-data.html"><a href="ch-13-relational-data.html#section-36"><i class="fa fa-check"></i><b>14.1.1</b> 13.2.1</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="ch-13-relational-data.html"><a href="ch-13-relational-data.html#keys"><i class="fa fa-check"></i><b>14.2</b> 13.3 Keys</a><ul>
<li class="chapter" data-level="14.2.1" data-path="ch-13-relational-data.html"><a href="ch-13-relational-data.html#section-37"><i class="fa fa-check"></i><b>14.2.1</b> 13.3.1</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="ch-13-relational-data.html"><a href="ch-13-relational-data.html#mutating-joins"><i class="fa fa-check"></i><b>14.3</b> 13.4 Mutating joins</a><ul>
<li class="chapter" data-level="14.3.1" data-path="ch-13-relational-data.html"><a href="ch-13-relational-data.html#section-38"><i class="fa fa-check"></i><b>14.3.1</b> 13.4.6</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="ch-13-relational-data.html"><a href="ch-13-relational-data.html#filtering-joins"><i class="fa fa-check"></i><b>14.4</b> 13.5 Filtering joins</a><ul>
<li class="chapter" data-level="14.4.1" data-path="ch-13-relational-data.html"><a href="ch-13-relational-data.html#section-39"><i class="fa fa-check"></i><b>14.4.1</b> 13.5.1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="ch-14-strings.html"><a href="ch-14-strings.html"><i class="fa fa-check"></i><b>15</b> ch. 14: Strings</a><ul>
<li class="chapter" data-level="15.1" data-path="ch-14-strings.html"><a href="ch-14-strings.html#string-basics"><i class="fa fa-check"></i><b>15.1</b> 14.2: String basics</a><ul>
<li class="chapter" data-level="15.1.1" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-40"><i class="fa fa-check"></i><b>15.1.1</b> 14.2.5</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="ch-14-strings.html"><a href="ch-14-strings.html#matching-patterns-w-regex"><i class="fa fa-check"></i><b>15.2</b> 14.3: Matching patterns w/ regex</a><ul>
<li class="chapter" data-level="15.2.1" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-41"><i class="fa fa-check"></i><b>15.2.1</b> 14.3.1.1</a></li>
<li class="chapter" data-level="15.2.2" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-42"><i class="fa fa-check"></i><b>15.2.2</b> 14.3.2.1</a></li>
<li class="chapter" data-level="15.2.3" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-43"><i class="fa fa-check"></i><b>15.2.3</b> 14.3.3.1</a></li>
<li class="chapter" data-level="15.2.4" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-44"><i class="fa fa-check"></i><b>15.2.4</b> 14.3.4.1</a></li>
<li class="chapter" data-level="15.2.5" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-45"><i class="fa fa-check"></i><b>15.2.5</b> 14.3.5.1</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="ch-14-strings.html"><a href="ch-14-strings.html#tools"><i class="fa fa-check"></i><b>15.3</b> 14.4 Tools</a><ul>
<li class="chapter" data-level="15.3.1" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-46"><i class="fa fa-check"></i><b>15.3.1</b> 14.4.2</a></li>
<li class="chapter" data-level="15.3.2" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-47"><i class="fa fa-check"></i><b>15.3.2</b> 14.4.3.1</a></li>
<li class="chapter" data-level="15.3.3" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-48"><i class="fa fa-check"></i><b>15.3.3</b> 14.4.4.1</a></li>
<li class="chapter" data-level="15.3.4" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-49"><i class="fa fa-check"></i><b>15.3.4</b> 14.4.5.1</a></li>
<li class="chapter" data-level="15.3.5" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-50"><i class="fa fa-check"></i><b>15.3.5</b> 14.4.6.1</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="ch-14-strings.html"><a href="ch-14-strings.html#other-types-of-patterns"><i class="fa fa-check"></i><b>15.4</b> 14.5: Other types of patterns</a><ul>
<li class="chapter" data-level="15.4.1" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-51"><i class="fa fa-check"></i><b>15.4.1</b> 14.5.1</a></li>
<li class="chapter" data-level="15.4.2" data-path="ch-14-strings.html"><a href="ch-14-strings.html#section-52"><i class="fa fa-check"></i><b>15.4.2</b> 14.7.1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="ch-15-factors.html"><a href="ch-15-factors.html"><i class="fa fa-check"></i><b>16</b> ch. 15: Factors</a><ul>
<li class="chapter" data-level="16.1" data-path="ch-15-factors.html"><a href="ch-15-factors.html#modifying-factor-order"><i class="fa fa-check"></i><b>16.1</b> 15.4: Modifying factor order</a><ul>
<li class="chapter" data-level="16.1.1" data-path="ch-15-factors.html"><a href="ch-15-factors.html#section-53"><i class="fa fa-check"></i><b>16.1.1</b> 15.3.1</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="ch-15-factors.html"><a href="ch-15-factors.html#modifying-factor-order-1"><i class="fa fa-check"></i><b>16.2</b> 15.4: Modifying factor order</a><ul>
<li class="chapter" data-level="16.2.1" data-path="ch-15-factors.html"><a href="ch-15-factors.html#section-54"><i class="fa fa-check"></i><b>16.2.1</b> 15.4.1</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="ch-15-factors.html"><a href="ch-15-factors.html#modifying-factor-levels"><i class="fa fa-check"></i><b>16.3</b> 15.5: Modifying factor levels</a><ul>
<li class="chapter" data-level="16.3.1" data-path="ch-15-factors.html"><a href="ch-15-factors.html#section-55"><i class="fa fa-check"></i><b>16.3.1</b> 15.5.1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="appendix-3.html"><a href="appendix-3.html"><i class="fa fa-check"></i><b>17</b> Appendix</a><ul>
<li class="chapter" data-level="17.1" data-path="appendix-3.html"><a href="appendix-3.html#viewing-all-levels"><i class="fa fa-check"></i><b>17.1</b> Viewing all levels</a></li>
<li class="chapter" data-level="17.2" data-path="appendix-3.html"><a href="appendix-3.html#percentage-na-each-level"><i class="fa fa-check"></i><b>17.2</b> Percentage NA each level</a></li>
<li class="chapter" data-level="17.3" data-path="appendix-3.html"><a href="appendix-3.html#print-all-levels-of-tibble"><i class="fa fa-check"></i><b>17.3</b> Print all levels of tibble</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="ch-16-dates-and-times.html"><a href="ch-16-dates-and-times.html"><i class="fa fa-check"></i><b>18</b> ch. 16: Dates and times</a><ul>
<li class="chapter" data-level="18.1" data-path="ch-16-dates-and-times.html"><a href="ch-16-dates-and-times.html#creating-datetimes"><i class="fa fa-check"></i><b>18.1</b> 16.2: Creating date/times</a><ul>
<li class="chapter" data-level="18.1.1" data-path="ch-16-dates-and-times.html"><a href="ch-16-dates-and-times.html#section-56"><i class="fa fa-check"></i><b>18.1.1</b> 16.2.4</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="ch-16-dates-and-times.html"><a href="ch-16-dates-and-times.html#date-time-components"><i class="fa fa-check"></i><b>18.2</b> 16.3: Date-time components</a><ul>
<li class="chapter" data-level="18.2.1" data-path="ch-16-dates-and-times.html"><a href="ch-16-dates-and-times.html#section-57"><i class="fa fa-check"></i><b>18.2.1</b> 16.3.4</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="ch-16-dates-and-times.html"><a href="ch-16-dates-and-times.html#time-spans"><i class="fa fa-check"></i><b>18.3</b> 16.4: Time spans</a><ul>
<li class="chapter" data-level="18.3.1" data-path="ch-16-dates-and-times.html"><a href="ch-16-dates-and-times.html#section-58"><i class="fa fa-check"></i><b>18.3.1</b> 16.4.5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="appendix-4.html"><a href="appendix-4.html"><i class="fa fa-check"></i><b>19</b> Appendix</a><ul>
<li class="chapter" data-level="19.1" data-path="appendix-4.html"><a href="appendix-4.html#section-59"><i class="fa fa-check"></i><b>19.1</b> 16.3.4.1</a></li>
<li class="chapter" data-level="19.2" data-path="appendix-4.html"><a href="appendix-4.html#section-60"><i class="fa fa-check"></i><b>19.2</b> 16.3.4.3</a></li>
<li class="chapter" data-level="19.3" data-path="appendix-4.html"><a href="appendix-4.html#section-61"><i class="fa fa-check"></i><b>19.3</b> 16.3.4.4</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="ch-18-pipes-notes-only.html"><a href="ch-18-pipes-notes-only.html"><i class="fa fa-check"></i><b>20</b> ch. 18: Pipes (notes only)</a></li>
<li class="chapter" data-level="21" data-path="ch-19-functions.html"><a href="ch-19-functions.html"><i class="fa fa-check"></i><b>21</b> ch. 19: Functions</a><ul>
<li class="chapter" data-level="21.1" data-path="ch-19-functions.html"><a href="ch-19-functions.html#when-should-you-write-a-function"><i class="fa fa-check"></i><b>21.1</b> 19.2: When should you write a function?</a><ul>
<li class="chapter" data-level="21.1.1" data-path="ch-19-functions.html"><a href="ch-19-functions.html#section-62"><i class="fa fa-check"></i><b>21.1.1</b> 19.2.1</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="ch-19-functions.html"><a href="ch-19-functions.html#functions-are-for-humans-and-computers"><i class="fa fa-check"></i><b>21.2</b> 19.3: Functions are for humans and computers</a><ul>
<li class="chapter" data-level="21.2.1" data-path="ch-19-functions.html"><a href="ch-19-functions.html#section-63"><i class="fa fa-check"></i><b>21.2.1</b> 19.3.1</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="ch-19-functions.html"><a href="ch-19-functions.html#conditional-execution"><i class="fa fa-check"></i><b>21.3</b> 19.4: Conditional execution</a><ul>
<li class="chapter" data-level="21.3.1" data-path="ch-19-functions.html"><a href="ch-19-functions.html#section-64"><i class="fa fa-check"></i><b>21.3.1</b> 19.4.4</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="ch-19-functions.html"><a href="ch-19-functions.html#function-arguments"><i class="fa fa-check"></i><b>21.4</b> 19.5: Function arguments</a><ul>
<li class="chapter" data-level="21.4.1" data-path="ch-19-functions.html"><a href="ch-19-functions.html#section-65"><i class="fa fa-check"></i><b>21.4.1</b> 19.5.5</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="ch-19-functions.html"><a href="ch-19-functions.html#return-values"><i class="fa fa-check"></i><b>21.5</b> 19.6: Return values</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="appendix-5.html"><a href="appendix-5.html"><i class="fa fa-check"></i><b>22</b> Appendix</a><ul>
<li class="chapter" data-level="22.1" data-path="appendix-5.html"><a href="appendix-5.html#section-66"><i class="fa fa-check"></i><b>22.1</b> 19.2.1.4</a></li>
<li class="chapter" data-level="22.2" data-path="appendix-5.html"><a href="appendix-5.html#changing-values-with-indexes"><i class="fa fa-check"></i><b>22.2</b> Changing values with indexes</a><ul>
<li class="chapter" data-level="22.2.1" data-path="appendix-5.html"><a href="appendix-5.html#applying-indexing-to-dfs"><i class="fa fa-check"></i><b>22.2.1</b> Applying indexing to dfs</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="appendix-5.html"><a href="appendix-5.html#better-than-ifelse"><i class="fa fa-check"></i><b>22.3</b> Better than <code>ifelse()</code>?</a></li>
<li class="chapter" data-level="22.4" data-path="appendix-5.html"><a href="appendix-5.html#dplyr-and-functions"><i class="fa fa-check"></i><b>22.4</b> Dplyr and functions</a></li>
<li class="chapter" data-level="22.5" data-path="appendix-5.html"><a href="appendix-5.html#section-67"><i class="fa fa-check"></i><b>22.5</b> 19.2.3.5</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="ch-20-vectors.html"><a href="ch-20-vectors.html"><i class="fa fa-check"></i><b>23</b> ch. 20: Vectors</a><ul>
<li class="chapter" data-level="23.0.1" data-path="ch-20-vectors.html"><a href="ch-20-vectors.html#section-68"><i class="fa fa-check"></i><b>23.0.1</b> 20.3.5</a></li>
<li class="chapter" data-level="23.1" data-path="ch-20-vectors.html"><a href="ch-20-vectors.html#using-atomic-vectors"><i class="fa fa-check"></i><b>23.1</b> 20.4: Using atomic vectors</a><ul>
<li class="chapter" data-level="23.1.1" data-path="ch-20-vectors.html"><a href="ch-20-vectors.html#section-69"><i class="fa fa-check"></i><b>23.1.1</b> 20.4.6</a></li>
</ul></li>
<li class="chapter" data-level="23.2" data-path="ch-20-vectors.html"><a href="ch-20-vectors.html#recursive-vectors-lists"><i class="fa fa-check"></i><b>23.2</b> 20.5: Recursive vectors (lists)</a><ul>
<li class="chapter" data-level="23.2.1" data-path="ch-20-vectors.html"><a href="ch-20-vectors.html#section-70"><i class="fa fa-check"></i><b>23.2.1</b> 20.5.4</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="ch-20-vectors.html"><a href="ch-20-vectors.html#augmented-vectors"><i class="fa fa-check"></i><b>23.3</b> 20.7: Augmented vectors</a><ul>
<li class="chapter" data-level="23.3.1" data-path="ch-20-vectors.html"><a href="ch-20-vectors.html#section-71"><i class="fa fa-check"></i><b>23.3.1</b> 20.7.4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="appendix-6.html"><a href="appendix-6.html"><i class="fa fa-check"></i><b>24</b> Appendix</a><ul>
<li class="chapter" data-level="24.1" data-path="appendix-6.html"><a href="appendix-6.html#subsetting-nested-lists"><i class="fa fa-check"></i><b>24.1</b> subsetting nested lists</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html"><i class="fa fa-check"></i><b>25</b> ch. 21: Iteration</a><ul>
<li class="chapter" data-level="25.1" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html#for-loops"><i class="fa fa-check"></i><b>25.1</b> 21.2: For loops</a><ul>
<li class="chapter" data-level="25.1.1" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html#section-72"><i class="fa fa-check"></i><b>25.1.1</b> 21.2.1</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html#for-loop-variations"><i class="fa fa-check"></i><b>25.2</b> 21.3 For loop variations</a><ul>
<li class="chapter" data-level="25.2.1" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html#section-73"><i class="fa fa-check"></i><b>25.2.1</b> 21.3.5</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html#for-loops-vs.-functionals"><i class="fa fa-check"></i><b>25.3</b> 21.4: For loops vs. functionals</a><ul>
<li class="chapter" data-level="25.3.1" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html#section-74"><i class="fa fa-check"></i><b>25.3.1</b> 21.4.1</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html#the-map-functions"><i class="fa fa-check"></i><b>25.4</b> 21.5: The map functions</a><ul>
<li class="chapter" data-level="25.4.1" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html#section-75"><i class="fa fa-check"></i><b>25.4.1</b> 21.5.3</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html#other-patterns-of-for-loops"><i class="fa fa-check"></i><b>25.5</b> 21.9 Other patterns of for loops</a><ul>
<li class="chapter" data-level="25.5.1" data-path="ch-21-iteration.html"><a href="ch-21-iteration.html#section-76"><i class="fa fa-check"></i><b>25.5.1</b> 21.9.3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="appendix-7.html"><a href="appendix-7.html"><i class="fa fa-check"></i><b>26</b> Appendix</a><ul>
<li class="chapter" data-level="26.1" data-path="appendix-7.html"><a href="appendix-7.html#section-77"><i class="fa fa-check"></i><b>26.1</b> 21.3.5.1</a><ul>
<li class="chapter" data-level="26.1.1" data-path="appendix-7.html"><a href="appendix-7.html#using-map"><i class="fa fa-check"></i><b>26.1.1</b> Using map</a></li>
<li class="chapter" data-level="26.1.2" data-path="appendix-7.html"><a href="appendix-7.html#plot-of-names"><i class="fa fa-check"></i><b>26.1.2</b> Plot of names</a></li>
<li class="chapter" data-level="26.1.3" data-path="appendix-7.html"><a href="appendix-7.html#csv-other-example"><i class="fa fa-check"></i><b>26.1.3</b> csv other example</a></li>
</ul></li>
<li class="chapter" data-level="26.2" data-path="appendix-7.html"><a href="appendix-7.html#with-purrr"><i class="fa fa-check"></i><b>26.2</b> 21.3.5.2 with purrr</a></li>
<li class="chapter" data-level="26.3" data-path="appendix-7.html"><a href="appendix-7.html#mirroring-keep"><i class="fa fa-check"></i><b>26.3</b> 21.9 mirroring keep</a></li>
<li class="chapter" data-level="26.4" data-path="appendix-7.html"><a href="appendix-7.html#invoke-examples"><i class="fa fa-check"></i><b>26.4</b> invoke examples</a></li>
<li class="chapter" data-level="26.5" data-path="appendix-7.html"><a href="appendix-7.html#indexing-nms-caution"><i class="fa fa-check"></i><b>26.5</b> indexing nms caution</a></li>
<li class="chapter" data-level="26.6" data-path="appendix-7.html"><a href="appendix-7.html#in-class-notes"><i class="fa fa-check"></i><b>26.6</b> in class notes</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="ch-23-model-basics.html"><a href="ch-23-model-basics.html"><i class="fa fa-check"></i><b>27</b> ch. 23: Model basics</a><ul>
<li class="chapter" data-level="27.1" data-path="ch-23-model-basics.html"><a href="ch-23-model-basics.html#a-simple-model"><i class="fa fa-check"></i><b>27.1</b> 23.2: A simple model</a><ul>
<li class="chapter" data-level="27.1.1" data-path="ch-23-model-basics.html"><a href="ch-23-model-basics.html#section-78"><i class="fa fa-check"></i><b>27.1.1</b> 23.2.1</a></li>
</ul></li>
<li class="chapter" data-level="27.2" data-path="ch-23-model-basics.html"><a href="ch-23-model-basics.html#visualising-models"><i class="fa fa-check"></i><b>27.2</b> 23.3: Visualising models</a><ul>
<li class="chapter" data-level="27.2.1" data-path="ch-23-model-basics.html"><a href="ch-23-model-basics.html#section-79"><i class="fa fa-check"></i><b>27.2.1</b> 23.3.3</a></li>
</ul></li>
<li class="chapter" data-level="27.3" data-path="ch-23-model-basics.html"><a href="ch-23-model-basics.html#formulas-and-model-families"><i class="fa fa-check"></i><b>27.3</b> 23.4: Formulas and model families</a><ul>
<li class="chapter" data-level="27.3.1" data-path="ch-23-model-basics.html"><a href="ch-23-model-basics.html#section-80"><i class="fa fa-check"></i><b>27.3.1</b> 23.4.5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="28" data-path="appendix-8.html"><a href="appendix-8.html"><i class="fa fa-check"></i><b>28</b> Appendix</a><ul>
<li class="chapter" data-level="28.1" data-path="appendix-8.html"><a href="appendix-8.html#other-model-families"><i class="fa fa-check"></i><b>28.1</b> Other model families</a></li>
<li class="chapter" data-level="28.2" data-path="appendix-8.html"><a href="appendix-8.html#book-example"><i class="fa fa-check"></i><b>28.2</b> 23.2 book example</a><ul>
<li class="chapter" data-level="28.2.1" data-path="appendix-8.html"><a href="appendix-8.html#tidy-grid_space"><i class="fa fa-check"></i><b>28.2.1</b> tidy grid_space</a></li>
</ul></li>
<li class="chapter" data-level="28.3" data-path="appendix-8.html"><a href="appendix-8.html#section-81"><i class="fa fa-check"></i><b>28.3</b> 23.4.5.4</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="ch-24-model-building.html"><a href="ch-24-model-building.html"><i class="fa fa-check"></i><b>29</b> ch. 24: Model building</a><ul>
<li class="chapter" data-level="29.1" data-path="ch-24-model-building.html"><a href="ch-24-model-building.html#why-are-low-quality-diamonds-more-expensive"><i class="fa fa-check"></i><b>29.1</b> 24.2: Why are low quality diamonds more expensive?</a><ul>
<li class="chapter" data-level="29.1.1" data-path="ch-24-model-building.html"><a href="ch-24-model-building.html#section-82"><i class="fa fa-check"></i><b>29.1.1</b> 24.2.3</a></li>
</ul></li>
<li class="chapter" data-level="29.2" data-path="ch-24-model-building.html"><a href="ch-24-model-building.html#what-affects-the-number-of-daily-flights"><i class="fa fa-check"></i><b>29.2</b> 24.3 What affects the number of daily flights?</a><ul>
<li class="chapter" data-level="29.2.1" data-path="ch-24-model-building.html"><a href="ch-24-model-building.html#section-83"><i class="fa fa-check"></i><b>29.2.1</b> 24.3.5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="30" data-path="appendix-9.html"><a href="appendix-9.html"><i class="fa fa-check"></i><b>30</b> Appendix</a><ul>
<li class="chapter" data-level="30.1" data-path="appendix-9.html"><a href="appendix-9.html#section-84"><i class="fa fa-check"></i><b>30.1</b> 24.2.3.3</a></li>
<li class="chapter" data-level="30.2" data-path="appendix-9.html"><a href="appendix-9.html#section-85"><i class="fa fa-check"></i><b>30.2</b> 24.2.3.4</a><ul>
<li class="chapter" data-level="30.2.1" data-path="appendix-9.html"><a href="appendix-9.html#heteroskedasticity"><i class="fa fa-check"></i><b>30.2.1</b> heteroskedasticity</a></li>
<li class="chapter" data-level="30.2.2" data-path="appendix-9.html"><a href="appendix-9.html#rsquared-on-logged-values"><i class="fa fa-check"></i><b>30.2.2</b> rsquared on logged values</a></li>
</ul></li>
<li class="chapter" data-level="30.3" data-path="appendix-9.html"><a href="appendix-9.html#section-86"><i class="fa fa-check"></i><b>30.3</b> 24.2.3.1</a><ul>
<li class="chapter" data-level="30.3.1" data-path="appendix-9.html"><a href="appendix-9.html#more-notes-on-logs"><i class="fa fa-check"></i><b>30.3.1</b> More notes on logs</a></li>
<li class="chapter" data-level="30.3.2" data-path="appendix-9.html"><a href="appendix-9.html#carat-more-clumped-than-price"><i class="fa fa-check"></i><b>30.3.2</b> carat more clumped than price</a></li>
</ul></li>
<li class="chapter" data-level="30.4" data-path="appendix-9.html"><a href="appendix-9.html#logs-simulated-examples"><i class="fa fa-check"></i><b>30.4</b> Logs (simulated examples)</a><ul>
<li class="chapter" data-level="30.4.1" data-path="appendix-9.html"><a href="appendix-9.html#exponential-relationship"><i class="fa fa-check"></i><b>30.4.1</b> Exponential relationship</a></li>
<li class="chapter" data-level="30.4.2" data-path="appendix-9.html"><a href="appendix-9.html#log-log-relationship"><i class="fa fa-check"></i><b>30.4.2</b> Log log relationship</a></li>
</ul></li>
<li class="chapter" data-level="30.5" data-path="appendix-9.html"><a href="appendix-9.html#diamonds-data-review"><i class="fa fa-check"></i><b>30.5</b> Diamonds data review</a><ul>
<li class="chapter" data-level="30.5.1" data-path="appendix-9.html"><a href="appendix-9.html#carat-by-mean-table-value"><i class="fa fa-check"></i><b>30.5.1</b> carat by mean <code>table</code> value</a></li>
<li class="chapter" data-level="30.5.2" data-path="appendix-9.html"><a href="appendix-9.html#cutoff-part-1"><i class="fa fa-check"></i><b>30.5.2</b> Cutoff, Part 1</a></li>
<li class="chapter" data-level="30.5.3" data-path="appendix-9.html"><a href="appendix-9.html#cutoff-part-2"><i class="fa fa-check"></i><b>30.5.3</b> Cutoff, Part 2</a></li>
</ul></li>
<li class="chapter" data-level="30.6" data-path="appendix-9.html"><a href="appendix-9.html#section-87"><i class="fa fa-check"></i><b>30.6</b> 25.3.5.4</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="ch-25-many-models.html"><a href="ch-25-many-models.html"><i class="fa fa-check"></i><b>31</b> ch. 25: Many models</a><ul>
<li class="chapter" data-level="31.1" data-path="ch-25-many-models.html"><a href="ch-25-many-models.html#gapminder"><i class="fa fa-check"></i><b>31.1</b> 25.2: gapminder</a><ul>
<li class="chapter" data-level="31.1.1" data-path="ch-25-many-models.html"><a href="ch-25-many-models.html#section-88"><i class="fa fa-check"></i><b>31.1.1</b> 25.2.5</a></li>
</ul></li>
<li class="chapter" data-level="31.2" data-path="ch-25-many-models.html"><a href="ch-25-many-models.html#creating-list-columns"><i class="fa fa-check"></i><b>31.2</b> 25.4: Creating list-columns</a><ul>
<li class="chapter" data-level="31.2.1" data-path="ch-25-many-models.html"><a href="ch-25-many-models.html#section-89"><i class="fa fa-check"></i><b>31.2.1</b> 25.4.5</a></li>
</ul></li>
<li class="chapter" data-level="31.3" data-path="ch-25-many-models.html"><a href="ch-25-many-models.html#simplifying-list-columns"><i class="fa fa-check"></i><b>31.3</b> 25.5: Simplifying list-columns</a><ul>
<li class="chapter" data-level="31.3.1" data-path="ch-25-many-models.html"><a href="ch-25-many-models.html#section-90"><i class="fa fa-check"></i><b>31.3.1</b> 25.5.3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="32" data-path="appendix-10.html"><a href="appendix-10.html"><i class="fa fa-check"></i><b>32</b> Appendix</a><ul>
<li class="chapter" data-level="32.1" data-path="appendix-10.html"><a href="appendix-10.html#models-in-lists"><i class="fa fa-check"></i><b>32.1</b> models in lists</a></li>
<li class="chapter" data-level="32.2" data-path="appendix-10.html"><a href="appendix-10.html#list-columns-for-sampling"><i class="fa fa-check"></i><b>32.2</b> list-columns for sampling</a></li>
<li class="chapter" data-level="32.3" data-path="appendix-10.html"><a href="appendix-10.html#section-91"><i class="fa fa-check"></i><b>32.3</b> 25.2.5.1</a><ul>
<li class="chapter" data-level="32.3.1" data-path="appendix-10.html"><a href="appendix-10.html#include-cubic-term"><i class="fa fa-check"></i><b>32.3.1</b> Include cubic term</a></li>
</ul></li>
<li class="chapter" data-level="32.4" data-path="appendix-10.html"><a href="appendix-10.html#multiple-graphs-in-chunk"><i class="fa fa-check"></i><b>32.4</b> Multiple graphs in chunk</a></li>
<li class="chapter" data-level="32.5" data-path="appendix-10.html"><a href="appendix-10.html#listquantile-examples"><i class="fa fa-check"></i><b>32.5</b> list(quantile()) examples</a></li>
<li class="chapter" data-level="32.6" data-path="appendix-10.html"><a href="appendix-10.html#extracting-row-names"><i class="fa fa-check"></i><b>32.6</b> extracting row names</a></li>
<li class="chapter" data-level="32.7" data-path="appendix-10.html"><a href="appendix-10.html#invoke_map-example-book"><i class="fa fa-check"></i><b>32.7</b> <code>invoke_map</code> example (book)</a></li>
<li class="chapter" data-level="32.8" data-path="appendix-10.html"><a href="appendix-10.html#named-list-example-book"><i class="fa fa-check"></i><b>32.8</b> named list example (book)</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="ch-27-r-markdown.html"><a href="ch-27-r-markdown.html"><i class="fa fa-check"></i><b>33</b> ch. 27: R Markdown</a><ul>
<li class="chapter" data-level="33.1" data-path="ch-27-r-markdown.html"><a href="ch-27-r-markdown.html#r-markdown-basics"><i class="fa fa-check"></i><b>33.1</b> 27.2 R Markdown basics</a><ul>
<li class="chapter" data-level="33.1.1" data-path="ch-27-r-markdown.html"><a href="ch-27-r-markdown.html#section-92"><i class="fa fa-check"></i><b>33.1.1</b> 27.2.1</a></li>
</ul></li>
<li class="chapter" data-level="33.2" data-path="ch-27-r-markdown.html"><a href="ch-27-r-markdown.html#text-formatting-with-markdown"><i class="fa fa-check"></i><b>33.2</b> 27.3: Text formatting with Markdown</a><ul>
<li class="chapter" data-level="33.2.1" data-path="ch-27-r-markdown.html"><a href="ch-27-r-markdown.html#section-93"><i class="fa fa-check"></i><b>33.2.1</b> 27.3.1</a></li>
</ul></li>
<li class="chapter" data-level="33.3" data-path="ch-27-r-markdown.html"><a href="ch-27-r-markdown.html#cv-of-bryan-shalloway"><i class="fa fa-check"></i><b>33.3</b> <strong>CV of Bryan Shalloway</strong></a></li>
<li class="chapter" data-level="33.4" data-path="ch-27-r-markdown.html"><a href="ch-27-r-markdown.html#experience"><i class="fa fa-check"></i><b>33.4</b> Experience</a></li>
<li class="chapter" data-level="33.5" data-path="ch-27-r-markdown.html"><a href="ch-27-r-markdown.html#education"><i class="fa fa-check"></i><b>33.5</b> Education</a></li>
<li class="chapter" data-level="33.6" data-path="ch-27-r-markdown.html"><a href="ch-27-r-markdown.html#code-chunks"><i class="fa fa-check"></i><b>33.6</b> 27.4: Code chunks</a><ul>
<li class="chapter" data-level="33.6.1" data-path="ch-27-r-markdown.html"><a href="ch-27-r-markdown.html#section-94"><i class="fa fa-check"></i><b>33.6.1</b> 27.4.7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="34" data-path="ch-28-graphics-for-communication.html"><a href="ch-28-graphics-for-communication.html"><i class="fa fa-check"></i><b>34</b> ch. 28: Graphics for communication</a><ul>
<li class="chapter" data-level="34.1" data-path="ch-28-graphics-for-communication.html"><a href="ch-28-graphics-for-communication.html#label"><i class="fa fa-check"></i><b>34.1</b> 28.2: Label</a><ul>
<li class="chapter" data-level="34.1.1" data-path="ch-28-graphics-for-communication.html"><a href="ch-28-graphics-for-communication.html#section-95"><i class="fa fa-check"></i><b>34.1.1</b> 28.2.1</a></li>
</ul></li>
<li class="chapter" data-level="34.2" data-path="ch-28-graphics-for-communication.html"><a href="ch-28-graphics-for-communication.html#annotations"><i class="fa fa-check"></i><b>34.2</b> 28.3: Annotations</a><ul>
<li class="chapter" data-level="34.2.1" data-path="ch-28-graphics-for-communication.html"><a href="ch-28-graphics-for-communication.html#section-96"><i class="fa fa-check"></i><b>34.2.1</b> 28.3.1</a></li>
</ul></li>
<li class="chapter" data-level="34.3" data-path="ch-28-graphics-for-communication.html"><a href="ch-28-graphics-for-communication.html#scales"><i class="fa fa-check"></i><b>34.3</b> 28.4: Scales</a><ul>
<li class="chapter" data-level="34.3.1" data-path="ch-28-graphics-for-communication.html"><a href="ch-28-graphics-for-communication.html#section-97"><i class="fa fa-check"></i><b>34.3.1</b> 28.4.4</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Another set of solutions and notes to ‘R for Data Science’</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="appendix-9" class="section level1">
<h1><span class="header-section-number">Chapter 30</span> Appendix</h1>
<div id="section-84" class="section level2">
<h2><span class="header-section-number">30.1</span> 24.2.3.3</h2>
<p>Plots of extreme values against a sample and colored by some of the key attributes</p>
<p><em>Plots of extreme values against carat, price, clarity</em></p>
<div class="sourceCode" id="cb1236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1236-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1236-2" title="2"><span class="st">  </span><span class="kw">add_predictions</span>(mod_diamond2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1236-3" title="3"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">5000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1236-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(carat, price))<span class="op">+</span></a>
<a class="sourceLine" id="cb1236-5" title="5"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(carat, price, <span class="dt">colour =</span> clarity), <span class="dt">alpha =</span> <span class="fl">0.5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1236-6" title="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(carat, price, <span class="dt">colour =</span> clarity), <span class="dt">data =</span> extreme_vals, <span class="dt">size =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p><em>Plots of extreme values against carat, price, cut</em></p>
<div class="sourceCode" id="cb1237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1237-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1237-2" title="2"><span class="st">  </span><span class="kw">add_predictions</span>(mod_diamond2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1237-3" title="3"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">5000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1237-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(carat, price))<span class="op">+</span></a>
<a class="sourceLine" id="cb1237-5" title="5"><span class="st">  </span><span class="co"># geom_hex(bins = 50)+</span></a>
<a class="sourceLine" id="cb1237-6" title="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(carat, price, <span class="dt">colour =</span> cut), <span class="dt">alpha =</span> <span class="fl">0.5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1237-7" title="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(carat, price, <span class="dt">colour =</span> cut), <span class="dt">data =</span> extreme_vals, <span class="dt">size =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
<div id="section-85" class="section level2">
<h2><span class="header-section-number">30.2</span> 24.2.3.4</h2>
<div id="heteroskedasticity" class="section level3">
<h3><span class="header-section-number">30.2.1</span> heteroskedasticity</h3>
<p>Note that heteroskedasticity is one (of several other) important considerations that would be important when deciding how much you trust the model.</p>
<p><em>residual vs lprice</em></p>
<div class="sourceCode" id="cb1238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1238-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1238-2" title="2"><span class="st">  </span><span class="kw">add_residuals</span>(mod_diamond2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1238-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lprice, resid))<span class="op">+</span></a>
<a class="sourceLine" id="cb1238-4" title="4"><span class="st">  </span><span class="kw">geom_hex</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<ul>
<li>the log transformation helped to ensure our residuals did not have heteroskedasticity against the predictor</li>
</ul>
<p><em>residual (transformed) vs price</em>
(<code>resid_transformed</code> represents the residual against the residual after transforming it from a prediction for <code>log2(price)</code> to a prediction for <code>price</code>)</p>
<div class="sourceCode" id="cb1239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1239-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1239-2" title="2"><span class="st">  </span><span class="kw">add_predictions</span>(mod_diamond2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1239-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">resid_transformed =</span> price <span class="op">-</span><span class="st"> </span><span class="dv">2</span><span class="op">^</span>(pred)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1239-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(price, resid_transformed))<span class="op">+</span></a>
<a class="sourceLine" id="cb1239-5" title="5"><span class="st">  </span><span class="kw">geom_hex</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<ul>
<li>This is what heteroskedasticity looks like</li>
</ul>
<p><em>residual (transformed) vs log price</em>
(<code>resid_transformed</code> represents the residual against the residual after transforming it from a prediction for <code>log2(price)</code> to a prediction for <code>price</code>)</p>
<div class="sourceCode" id="cb1240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1240-1" title="1"><span class="co"># resid v lprice (% change on x resid)</span></a>
<a class="sourceLine" id="cb1240-2" title="2">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1240-3" title="3"><span class="st">  </span><span class="kw">add_predictions</span>(mod_diamond2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1240-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">resid_transformed =</span> price <span class="op">-</span><span class="st"> </span><span class="dv">2</span><span class="op">^</span>(pred)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1240-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lprice, resid_transformed))<span class="op">+</span></a>
<a class="sourceLine" id="cb1240-6" title="6"><span class="st">  </span><span class="kw">geom_hex</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
<div id="rsquared-on-logged-values" class="section level3">
<h3><span class="header-section-number">30.2.2</span> rsquared on logged values</h3>
<p><strong>(incorrect)</strong>
This is what I did initially. Below I calculate the R^2 on the log values. Within the exercise solution I decided to report the R^2 when calculated on <code>2^pred</code>. This has the more useful interpretation of representing the percentage of the variance on the actual price that the model captures, which seems more appropriate in some ways. This question about which is more appropriate to report may be worth revisiting in the future.</p>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1241-1" title="1"><span class="co">#to see if I&#39;m doing it right let&#39;s calculate the R_squared of the model using this technique</span></a>
<a class="sourceLine" id="cb1241-2" title="2">ss_res &lt;-<span class="st">  </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1241-3" title="3"><span class="st">  </span><span class="kw">add_predictions</span>(mod_diamond2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1241-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">extreme_value =</span> (<span class="kw">abs</span>(resid_lg) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1241-5" title="5">         <span class="dt">pred_exp =</span> <span class="dv">2</span><span class="op">^</span>(pred),</a>
<a class="sourceLine" id="cb1241-6" title="6">         <span class="dt">squ_mod =</span> (<span class="kw">log2</span>(price) <span class="op">-</span><span class="st"> </span>pred)<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1241-7" title="7">         <span class="dt">squ_error =</span> (<span class="kw">log2</span>(price) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(<span class="kw">log2</span>(price)))<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1241-8" title="8"><span class="st">  </span>.<span class="op">$</span>squ_mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sum</span>()</a>
<a class="sourceLine" id="cb1241-9" title="9"></a>
<a class="sourceLine" id="cb1241-10" title="10">ss_tot &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1241-11" title="11"><span class="st">  </span><span class="kw">add_predictions</span>(mod_diamond2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1241-12" title="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">extreme_value =</span> (<span class="kw">abs</span>(resid_lg) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1241-13" title="13">         <span class="dt">pred_exp =</span> <span class="dv">2</span><span class="op">^</span>(pred),</a>
<a class="sourceLine" id="cb1241-14" title="14">         <span class="dt">squ_mod =</span> (<span class="kw">log2</span>(price) <span class="op">-</span><span class="st"> </span>pred)<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1241-15" title="15">         <span class="dt">squ_error =</span> (<span class="kw">log2</span>(price) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(<span class="kw">log2</span>(price)))<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1241-16" title="16"><span class="st">  </span>.<span class="op">$</span>squ_error <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sum</span>()</a>
<a class="sourceLine" id="cb1241-17" title="17"></a>
<a class="sourceLine" id="cb1241-18" title="18"><span class="co"># calculated by hand</span></a>
<a class="sourceLine" id="cb1241-19" title="19"><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>ss_res <span class="op">/</span><span class="st"> </span>ss_tot</a></code></pre></div>
<pre><code>## [1] 0.9827876</code></pre>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1243-1" title="1"><span class="co"># built-in calculation</span></a>
<a class="sourceLine" id="cb1243-2" title="2"><span class="kw">rsquare</span>(mod_diamond2, diamonds2)</a></code></pre></div>
<pre><code>## [1] 0.9827876</code></pre>
<p>The R-squred is ~ 0.983, which means that the model accounts for 98.3% of the variance in price, which seems pretty solid.</p>
</div>
</div>
<div id="section-86" class="section level2">
<h2><span class="header-section-number">30.3</span> 24.2.3.1</h2>
<p>Visualization with horizontal stripes and <code>lprice</code> as the focus</p>
<div class="sourceCode" id="cb1245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1245-1" title="1"><span class="co"># horizontal stripes</span></a>
<a class="sourceLine" id="cb1245-2" title="2">gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(plot_lp_lc, plot_lp, plot_lc <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>()) </a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<ul>
<li>same thing, just change orientation and highlight <code>lprice</code> with a histogram</li>
</ul>
<p><em>A few other graphs from this problem</em></p>
<div class="sourceCode" id="cb1246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1246-1" title="1">diamonds2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1246-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(price))<span class="op">+</span></a>
<a class="sourceLine" id="cb1246-3" title="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">50</span>)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1247-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1247-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(carat))<span class="op">+</span></a>
<a class="sourceLine" id="cb1247-3" title="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.01</span>)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-32-2.png" width="672" /></p>
<p>Taking the log of price seems to have a bigger impact on the shape of the geom_hex graph</p>
<div class="sourceCode" id="cb1248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1248-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1248-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(carat, lprice))<span class="op">+</span></a>
<a class="sourceLine" id="cb1248-3" title="3"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb1249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1249-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1249-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lcarat, price))<span class="op">+</span></a>
<a class="sourceLine" id="cb1249-3" title="3"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-33-2.png" width="672" /></p>
<div id="more-notes-on-logs" class="section level3">
<h3><span class="header-section-number">30.3.1</span> More notes on logs</h3>
<p>While taking the log of both price and carat seems to help improve the ‘linearity’ of the model, perhaps taking the log of the price makes a bigger difference.</p>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1250-1" title="1"><span class="co"># a few other plots</span></a>
<a class="sourceLine" id="cb1250-2" title="2">plot_c &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1250-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(carat))<span class="op">+</span></a>
<a class="sourceLine" id="cb1250-4" title="4"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb1250-5" title="5"></a>
<a class="sourceLine" id="cb1250-6" title="6">plot_p &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1250-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(price))<span class="op">+</span></a>
<a class="sourceLine" id="cb1250-8" title="8"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1250-9" title="9"></a>
<a class="sourceLine" id="cb1250-10" title="10">plot_c_lp &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1250-11" title="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(carat, lprice))<span class="op">+</span></a>
<a class="sourceLine" id="cb1250-12" title="12"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1250-13" title="13"></a>
<a class="sourceLine" id="cb1250-14" title="14">plot_lc_p &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1250-15" title="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lcarat, price))<span class="op">+</span></a>
<a class="sourceLine" id="cb1250-16" title="16"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1250-17" title="17"></a>
<a class="sourceLine" id="cb1250-18" title="18"></a>
<a class="sourceLine" id="cb1250-19" title="19">gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(plot_lc_lp, plot_c_lp, plot_lc_p)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<ul>
<li>The reason for this may be that the log of the price better resembles a normal distribution than the log of the carat, though taking the log of the carat does also help by, at the least, centering the distribution…</li>
</ul>
<div class="sourceCode" id="cb1251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1251-1" title="1">gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(plot_lp_lc, plot_lp, plot_p)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<div class="sourceCode" id="cb1252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1252-1" title="1">gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(plot_lc_lp, plot_lc, plot_c)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-35-2.png" width="672" /></p>
</div>
<div id="carat-more-clumped-than-price" class="section level3">
<h3><span class="header-section-number">30.3.2</span> carat more clumped than price</h3>
<p><em>(Unnecessary)</em>
* let’s see between price and carat, which causes the appearance of “bands” in the data
* to do this let’s look at <code>geom_hex</code> when making the accompanying value random</p>
<div class="sourceCode" id="cb1253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1253-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1253-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rand_val =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>())) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1253-3" title="3"><span class="st">      </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lcarat, lprice))<span class="op">+</span></a>
<a class="sourceLine" id="cb1253-4" title="4"><span class="st">      </span><span class="kw">geom_hex</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<div class="sourceCode" id="cb1254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1254-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1254-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rand_val =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>())) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1254-3" title="3"><span class="st">      </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lcarat, rand_val))<span class="op">+</span></a>
<a class="sourceLine" id="cb1254-4" title="4"><span class="st">      </span><span class="kw">geom_hex</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
<div class="sourceCode" id="cb1255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1255-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1255-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rand_val =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>())) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1255-3" title="3"><span class="st">      </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lprice, rand_val))<span class="op">+</span></a>
<a class="sourceLine" id="cb1255-4" title="4"><span class="st">      </span><span class="kw">geom_hex</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-36-3.png" width="672" /></p>
<ul>
<li>clearly carat are much more clumped</li>
<li>this check was unnecessary in this case, though the method felt worth saving</li>
</ul>
</div>
</div>
<div id="logs-simulated-examples" class="section level2">
<h2><span class="header-section-number">30.4</span> Logs (simulated examples)</h2>
<div id="exponential-relationship" class="section level3">
<h3><span class="header-section-number">30.4.1</span> Exponential relationship</h3>
<p>Taking the log of a value often centers the distribution which is helpful for getting more normal errors, it’s actually not about making the relationship linear per se… but about making the errors normal (and linearlizing the relationship has the effect of doing this). Let’s generate some data.</p>
<p><em>Review logs on simulated dataset</em></p>
<div class="sourceCode" id="cb1256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1256-1" title="1"><span class="kw">set.seed</span>(<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb1256-2" title="2">log_notes_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">rand_origin =</span> <span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb1256-3" title="3">                       <span class="dt">rand_noise =</span> rand_origin <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1256-4" title="4">                       <span class="dt">rand_exp =</span> <span class="dv">8</span><span class="op">^</span>rand_noise,</a>
<a class="sourceLine" id="cb1256-5" title="5">                       <span class="dt">rand_exp_log =</span> <span class="kw">log2</span>(rand_exp))</a>
<a class="sourceLine" id="cb1256-6" title="6"></a>
<a class="sourceLine" id="cb1256-7" title="7"><span class="co"># exponential distribution</span></a>
<a class="sourceLine" id="cb1256-8" title="8">log_notes_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1256-9" title="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rand_exp))<span class="op">+</span></a>
<a class="sourceLine" id="cb1256-10" title="10"><span class="st">  </span><span class="kw">geom_histogram</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<div class="sourceCode" id="cb1257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1257-1" title="1"><span class="co"># Then take log base 2 of</span></a>
<a class="sourceLine" id="cb1257-2" title="2"><span class="co"># centered at 15 because 8 = 2^3 and it becomes 3*rnorm(mean = 5)</span></a>
<a class="sourceLine" id="cb1257-3" title="3">log_notes_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1257-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rand_exp_log))<span class="op">+</span></a>
<a class="sourceLine" id="cb1257-5" title="5"><span class="st">  </span><span class="kw">geom_histogram</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-37-2.png" width="672" /></p>
<div class="sourceCode" id="cb1258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1258-1" title="1"><span class="co"># The log helped us to uncover the relationship that existed between the original values and the values after some noise was added and then exponentiated</span></a>
<a class="sourceLine" id="cb1258-2" title="2">log_notes_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1258-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rand_origin, <span class="dt">y =</span> rand_exp_log))<span class="op">+</span></a>
<a class="sourceLine" id="cb1258-4" title="4"><span class="st">  </span><span class="kw">geom_hex</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-37-3.png" width="672" /></p>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1259-1" title="1">  <span class="co"># coord_fixed()</span></a>
<a class="sourceLine" id="cb1259-2" title="2"></a>
<a class="sourceLine" id="cb1259-3" title="3"></a>
<a class="sourceLine" id="cb1259-4" title="4"><span class="co"># for every one unit increase in &#39;rand_origin&#39; we get a ~3 fold increase in the log of the output</span></a>
<a class="sourceLine" id="cb1259-5" title="5"><span class="co"># this corresponds with the relationship being 2^3*1 , i.e. 3 comes from 2^3, and the 1 is because there is a 1 to ~1 relationship</span></a>
<a class="sourceLine" id="cb1259-6" title="6">log_notes_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1259-7" title="7"><span class="st">  </span><span class="kw">lm</span>(rand_exp_log <span class="op">~</span><span class="st"> </span>rand_origin, <span class="dt">data =</span> .)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = rand_exp_log ~ rand_origin, data = .)
## 
## Coefficients:
## (Intercept)  rand_origin  
##       0.246        2.972</code></pre>
<ul>
<li>because of the properties of logs and exponents, taking the log transform is robust to linearlizing any exponential relationship regardles of log</li>
</ul>
</div>
<div id="log-log-relationship" class="section level3">
<h3><span class="header-section-number">30.4.2</span> Log log relationship</h3>
<p>What happens if you have a log relationship and you take the log of this leading to a log-log relationship?
* You would not need to take the log of a graph in this relationship, but let’s look at what happens</p>
<div class="sourceCode" id="cb1261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1261-1" title="1">log_notes_df2 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">rand_origin =</span> <span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">256</span>, <span class="dt">sd =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb1261-2" title="2">                       <span class="dt">rand_noise =</span> rand_origin <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1261-3" title="3">                       <span class="dt">rand_log =</span> <span class="kw">log2</span>(rand_noise),</a>
<a class="sourceLine" id="cb1261-4" title="4">                       <span class="dt">rand_log_log =</span> <span class="kw">log2</span>(rand_log),</a>
<a class="sourceLine" id="cb1261-5" title="5">                       <span class="dt">rand_exp =</span> <span class="dv">2</span><span class="op">^</span>rand_log)</a>
<a class="sourceLine" id="cb1261-6" title="6"></a>
<a class="sourceLine" id="cb1261-7" title="7"><span class="co"># centered at 8 because 256 = 2^8 </span></a>
<a class="sourceLine" id="cb1261-8" title="8">log_notes_df2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1261-9" title="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rand_log))<span class="op">+</span></a>
<a class="sourceLine" id="cb1261-10" title="10"><span class="st">  </span><span class="kw">geom_histogram</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<div class="sourceCode" id="cb1262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1262-1" title="1"><span class="co"># centered at 3 because 2^3 = 8</span></a>
<a class="sourceLine" id="cb1262-2" title="2">log_notes_df2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rand_log_log))<span class="op">+</span></a>
<a class="sourceLine" id="cb1262-4" title="4"><span class="st">  </span><span class="kw">geom_histogram</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-38-2.png" width="672" /></p>
<div class="sourceCode" id="cb1263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1263-1" title="1">log_notes_df2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1263-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rand_log_log, <span class="dt">y =</span> rand_origin))<span class="op">+</span></a>
<a class="sourceLine" id="cb1263-3" title="3"><span class="st">  </span><span class="kw">geom_hex</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-38-3.png" width="672" /></p>
<ul>
<li>linear relationship still visually seems to exist</li>
</ul>
<p>Conceptualizing Linear regression can actually get surprisingly complicated. I’ll pull this into a separate blog post at some point.</p>
</div>
</div>
<div id="diamonds-data-review" class="section level2">
<h2><span class="header-section-number">30.5</span> Diamonds data review</h2>
<p><em>(Section arguably unnecessary)</em></p>
<div id="carat-by-mean-table-value" class="section level3">
<h3><span class="header-section-number">30.5.1</span> carat by mean <code>table</code> value</h3>
<p><code>table</code> represents the percentage of the max area that is covered by the flat top part of the diamond</p>
<div class="sourceCode" id="cb1264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1264-1" title="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1264-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(carat) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1264-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb1264-4" title="4">            <span class="dt">sd =</span> <span class="kw">sd</span>(table),</a>
<a class="sourceLine" id="cb1264-5" title="5">            <span class="dt">mean =</span> <span class="kw">mean</span>(table)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1264-6" title="6"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1264-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> mean))<span class="op">+</span></a>
<a class="sourceLine" id="cb1264-8" title="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> n))<span class="op">+</span></a>
<a class="sourceLine" id="cb1264-9" title="9"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
<div id="cutoff-part-1" class="section level3">
<h3><span class="header-section-number">30.5.2</span> Cutoff, Part 1</h3>
<p>I get nervous that in the opening example that the diamonds dataset was biased because all values with price over 19000 or carat over 2.5 were removed. This seemed to have the affect of causing larger diamonds to have lower prices than expected. I was worried this might in some way impact the pattern described regarding the residuals across the other dimensions – so looked at the residuals when building the model on just diamonds with carats less than 0.90. None of the prices seemed to approach 19000 for carats this small so this seemed like a good place to validate the discussion on residuals.</p>
<p>The pattern did indeed hold for even just these small diamonds, so the example Hadley discusses seems appropriate.</p>
<p><em>diamonds2 alternative… say that we only want to look at diamonds with carat less than 0.9</em></p>
<div class="sourceCode" id="cb1265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1265-1" title="1">diamonds_test &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1265-2" title="2"><span class="st">  </span><span class="kw">filter</span>(carat <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.9</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1265-3" title="3"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(price, carat), <span class="kw">funs</span>(<span class="dt">lg =</span> log2))</a></code></pre></div>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## please use list() instead
## 
## # Before:
## funs(name = f(.)
## 
## # After: 
## list(name = ~f(.))
## This warning is displayed once per session.</code></pre>
<div class="sourceCode" id="cb1267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1267-1" title="1">mod_diamond &lt;-<span class="st"> </span>diamonds_test <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1267-2" title="2"><span class="st">  </span><span class="kw">lm</span>(price_lg <span class="op">~</span><span class="st"> </span>carat_lg, <span class="dt">data =</span> .)</a>
<a class="sourceLine" id="cb1267-3" title="3"></a>
<a class="sourceLine" id="cb1267-4" title="4">diamonds2_w_mod &lt;-<span class="st"> </span>diamonds_test <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1267-5" title="5"><span class="st">  </span><span class="kw">add_residuals</span>(mod_diamond, <span class="st">&quot;resid_lg&quot;</span>)</a></code></pre></div>
<p>All the patterns Hadley pointed-out seem to hold on this slightly modified dataset</p>
<div class="sourceCode" id="cb1268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1268-1" title="1"><span class="kw">ggplot</span>(diamonds2_w_mod, <span class="kw">aes</span>(cut, resid_lg)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<div class="sourceCode" id="cb1269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1269-1" title="1"><span class="kw">ggplot</span>(diamonds2_w_mod, <span class="kw">aes</span>(color, resid_lg)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-41-2.png" width="672" /></p>
<div class="sourceCode" id="cb1270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1270-1" title="1"><span class="kw">ggplot</span>(diamonds2_w_mod, <span class="kw">aes</span>(clarity, resid_lg)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-41-3.png" width="672" /></p>
</div>
<div id="cutoff-part-2" class="section level3">
<h3><span class="header-section-number">30.5.3</span> Cutoff, Part 2</h3>
<p>Check if there are differences in coefficients when training on full <code>diamonds</code> data set v <code>diamonds2</code> dataset</p>
<div class="sourceCode" id="cb1271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1271-1" title="1">mod_diamonds &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1271-2" title="2"><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">lprice =</span> <span class="kw">log2</span>(price), </a>
<a class="sourceLine" id="cb1271-3" title="3">         <span class="dt">lcarat =</span> <span class="kw">log2</span>(carat)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1271-4" title="4"><span class="kw">lm</span>(lprice <span class="op">~</span><span class="st"> </span>lcarat, <span class="dt">data =</span> .)</a>
<a class="sourceLine" id="cb1271-5" title="5"></a>
<a class="sourceLine" id="cb1271-6" title="6">mod_diamonds2 &lt;-<span class="st"> </span><span class="kw">lm</span>(lprice <span class="op">~</span><span class="st"> </span>lcarat, <span class="dt">data =</span> diamonds2)</a>
<a class="sourceLine" id="cb1271-7" title="7"></a>
<a class="sourceLine" id="cb1271-8" title="8">diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1271-9" title="9"><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">lprice =</span> <span class="kw">log2</span>(price), </a>
<a class="sourceLine" id="cb1271-10" title="10">         <span class="dt">lcarat =</span> <span class="kw">log2</span>(carat)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1271-11" title="11"><span class="st">   </span><span class="kw">spread_predictions</span>(mod_diamonds, mod_diamonds2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1271-12" title="12"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1271-13" title="13"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> lcarat, <span class="dt">y =</span> lprice))<span class="op">+</span></a>
<a class="sourceLine" id="cb1271-14" title="14"><span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1271-15" title="15"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mod_diamonds), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1271-16" title="16"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mod_diamonds2), <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p><img src="24-model-building_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>essentially no difference between the models that come-out when training on one v the the other</p>
</div>
</div>
<div id="section-87" class="section level2">
<h2><span class="header-section-number">30.6</span> 25.3.5.4</h2>
<p>In this section I create a marker for days that are “near a holiday”</p>
<div class="sourceCode" id="cb1272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1272-1" title="1">near_holidays &lt;-<span class="st"> </span>holidays <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1272-2" title="2"><span class="st">  </span><span class="co"># This creates a series of helper variables to create the variable &#39;Holiday_IntervalDay&#39; that represents an interval that encloses the period between the holiday and the beginning or end of the most recent weekend</span></a>
<a class="sourceLine" id="cb1272-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">HolidayWday =</span> <span class="kw">wday</span>(HolidayDate, <span class="dt">label =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1272-4" title="4">         <span class="dt">HolidayWknd =</span> lubridate<span class="op">::</span><span class="kw">round_date</span>(HolidayDate, <span class="dt">unit =</span> <span class="st">&quot;week&quot;</span>),</a>
<a class="sourceLine" id="cb1272-5" title="5">         <span class="dt">HolidayFloor =</span> lubridate<span class="op">::</span><span class="kw">floor_date</span>(HolidayDate, <span class="dt">unit =</span> <span class="st">&quot;week&quot;</span>),</a>
<a class="sourceLine" id="cb1272-6" title="6">         <span class="dt">HolidayCeiling =</span> lubridate<span class="op">::</span><span class="kw">ceiling_date</span>(HolidayDate, <span class="dt">unit =</span> <span class="st">&quot;week&quot;</span>),</a>
<a class="sourceLine" id="cb1272-7" title="7">         <span class="dt">Holiday_IntervalDay =</span> <span class="kw">case_when</span>(HolidayWknd <span class="op">==</span><span class="st"> </span>HolidayFloor <span class="op">~</span><span class="st"> </span>(HolidayFloor <span class="op">-</span><span class="st"> </span><span class="kw">ddays</span>(<span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb1272-8" title="8">                                         <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>HolidayCeiling)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1272-9" title="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Holiday_Period =</span> <span class="kw">interval</span>(<span class="kw">pmin</span>(HolidayDate, Holiday_IntervalDay), <span class="kw">pmax</span>(HolidayDate, Holiday_IntervalDay)))</a>
<a class="sourceLine" id="cb1272-10" title="10"></a>
<a class="sourceLine" id="cb1272-11" title="11"><span class="co"># This returns each day and whether it occurred near a holiday</span></a>
<a class="sourceLine" id="cb1272-12" title="12">near_holiday &lt;-<span class="st"> </span><span class="kw">map</span>(near_holidays<span class="op">$</span>Holiday_Period, <span class="op">~</span>(<span class="kw">seq.Date</span>(<span class="kw">ymd</span>(<span class="st">&quot;2013-01-01&quot;</span>), <span class="kw">ymd</span>(<span class="st">&quot;2013-12-31&quot;</span>), <span class="dt">by =</span> <span class="st">&quot;day&quot;</span>) <span class="op">%within%</span><span class="st"> </span>.x)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1272-13" title="13"><span class="st">  </span><span class="kw">transpose</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1272-14" title="14"><span class="st">  </span><span class="kw">map_lgl</span>(any) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1272-15" title="15"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1272-16" title="16"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">NearHoliday =</span> value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1272-17" title="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">seq.Date</span>(<span class="kw">ymd</span>(<span class="st">&quot;2013-01-01&quot;</span>), <span class="kw">ymd</span>(<span class="st">&quot;2013-12-31&quot;</span>), <span class="dt">by =</span> <span class="st">&quot;day&quot;</span>))</a>
<a class="sourceLine" id="cb1272-18" title="18"></a>
<a class="sourceLine" id="cb1272-19" title="19">near_holiday</a></code></pre></div>
<pre><code>## # A tibble: 365 x 2
##    NearHoliday date      
##    &lt;lgl&gt;       &lt;date&gt;    
##  1 TRUE        2013-01-01
##  2 FALSE       2013-01-02
##  3 FALSE       2013-01-03
##  4 FALSE       2013-01-04
##  5 FALSE       2013-01-05
##  6 FALSE       2013-01-06
##  7 FALSE       2013-01-07
##  8 FALSE       2013-01-08
##  9 FALSE       2013-01-09
## 10 FALSE       2013-01-10
## # ... with 355 more rows</code></pre>
<ul>
<li>I ended-up not adding any additional analysis here, though the methodology for creating the “near holiday” seemed worth saving</li>
<li>Could come back to add more in the future</li>
</ul>

<p><em>Make sure the following packages are installed:</em></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-24-model-building.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-25-many-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
