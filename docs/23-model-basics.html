<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Another set of solutions to ‘R for Data Science’</title>
  <meta name="description" content="My notes and solutions to ‘R for Data Science’ by Garrett Grolemund and Hadley Wickham">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Another set of solutions to ‘R for Data Science’" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://brshallo.github.io/R4DS_Solutions/" />
  
  <meta property="og:description" content="My notes and solutions to ‘R for Data Science’ by Garrett Grolemund and Hadley Wickham" />
  <meta name="github-repo" content="https://github.com/brshallo/R4DS_Solutions" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Another set of solutions to ‘R for Data Science’" />
  
  <meta name="twitter:description" content="My notes and solutions to ‘R for Data Science’ by Garrett Grolemund and Hadley Wickham" />
  

<meta name="author" content="Bryan Shalloway">


<meta name="date" content="2019-05-28">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="21-iteration.html">
<link rel="next" href="24-model-building.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.8.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.39.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.39.2/plotly-latest.min.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.3.1/str_view.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Chapter contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Purpose of this book</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#features-of-this-book"><i class="fa fa-check"></i>Features of this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#origin-of-this-book"><i class="fa fa-check"></i>Origin of this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#plug-for-r4ds"><i class="fa fa-check"></i>Plug for R4DS</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#plug-for-r4ds-1"><i class="fa fa-check"></i>Plug for R4DS</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html"><i class="fa fa-check"></i>Ch 3: Data visualization</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#first-steps"><i class="fa fa-check"></i>3.2: First steps</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section"><i class="fa fa-check"></i>3.2.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#aesthetic-mappings"><i class="fa fa-check"></i>3.3: Aesthetic mappings</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-1"><i class="fa fa-check"></i>3.3.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#facets"><i class="fa fa-check"></i>3.5: Facets</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-2"><i class="fa fa-check"></i>3.5.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#geometric-objects"><i class="fa fa-check"></i>3.6: Geometric Objects</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-3"><i class="fa fa-check"></i>3.6.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#statistical-transformations"><i class="fa fa-check"></i>3.7: Statistical transformations</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-4"><i class="fa fa-check"></i>3.7.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#position-adjjustment"><i class="fa fa-check"></i>3.8: Position Adjjustment</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-5"><i class="fa fa-check"></i>3.8.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#coordinate-systems"><i class="fa fa-check"></i>3.9: Coordinate systems</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-6"><i class="fa fa-check"></i>3.9.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#appendix"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#extension"><i class="fa fa-check"></i>3.7.1.1 extension</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html"><i class="fa fa-check"></i>Ch. 5 Data transformations</a><ul>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#filter-rows"><i class="fa fa-check"></i>5.2: Filter rows</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-7"><i class="fa fa-check"></i>5.2.4.</a><ul>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-8"><i class="fa fa-check"></i>5.3.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#grouped-summaries"><i class="fa fa-check"></i>5.6: Grouped summaries</a><ul>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-9"><i class="fa fa-check"></i>5.6.7.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#grouped-mutates-and-filters"><i class="fa fa-check"></i>Grouped mutates (and filters)</a><ul>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-10"><i class="fa fa-check"></i>5.7.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#appendix-1"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-11"><i class="fa fa-check"></i>5.4.1.3.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-12"><i class="fa fa-check"></i>5.5.2.1.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-13"><i class="fa fa-check"></i>5.5.2.2</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-14"><i class="fa fa-check"></i>5.6.7.1.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-15"><i class="fa fa-check"></i>5.6.7.4.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-16"><i class="fa fa-check"></i>5.6.7.5.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-17"><i class="fa fa-check"></i>5.6.7.6.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-18"><i class="fa fa-check"></i>5.7.1.6.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-19"><i class="fa fa-check"></i>5.7.1.5</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-20"><i class="fa fa-check"></i>5.7.1.8.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#on-piping-dots"><i class="fa fa-check"></i>On piping dots</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#plotly"><i class="fa fa-check"></i>plotly</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html"><i class="fa fa-check"></i>Ch. 7: Data exploration</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#variation"><i class="fa fa-check"></i>7.3. Variation</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-21"><i class="fa fa-check"></i>7.3.4.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#missing-values"><i class="fa fa-check"></i>7.4. Missing values</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-22"><i class="fa fa-check"></i>7.4.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#covariation"><i class="fa fa-check"></i>7.5. Covariation</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-23"><i class="fa fa-check"></i>7.5.1.1.</a></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-24"><i class="fa fa-check"></i>7.5.2.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#two-continuous-variables"><i class="fa fa-check"></i>7.5.3 Two continuous variables</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-25"><i class="fa fa-check"></i>7.5.3.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#appendix-2"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-26"><i class="fa fa-check"></i>7.5.2.1.2.</a></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-27"><i class="fa fa-check"></i>7.5.3.1.4.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="10-tibbles.html"><a href="10-tibbles.html"><i class="fa fa-check"></i>Ch. 10: Tibbles</a><ul>
<li class="chapter" data-level="" data-path="10-tibbles.html"><a href="10-tibbles.html#section-28"><i class="fa fa-check"></i>10.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="11-data-import.html"><a href="11-data-import.html"><i class="fa fa-check"></i>Ch. 11: Data import</a><ul>
<li class="chapter" data-level="" data-path="11-data-import.html"><a href="11-data-import.html#section-29"><i class="fa fa-check"></i>11.2.2.</a></li>
<li class="chapter" data-level="" data-path="11-data-import.html"><a href="11-data-import.html#section-30"><i class="fa fa-check"></i>11.3.5.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html"><i class="fa fa-check"></i>ch. 12: Tidy data</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#tidy-data"><i class="fa fa-check"></i>12.2: Tidy data</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#section-31"><i class="fa fa-check"></i>12.2.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#spreading-and-gathering"><i class="fa fa-check"></i>12.3: Spreading and gathering</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#section-32"><i class="fa fa-check"></i>12.3.3.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#separating-and-uniting"><i class="fa fa-check"></i>12.4: Separating and uniting</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#section-33"><i class="fa fa-check"></i>12.4.3.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#missing-values-1"><i class="fa fa-check"></i>12.5: missing values</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#section-34"><i class="fa fa-check"></i>12.5.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#case-study"><i class="fa fa-check"></i>12.6 Case Study</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#section-35"><i class="fa fa-check"></i>12.6.1.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html"><i class="fa fa-check"></i>Ch. 13: Relational data</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#nycflights13"><i class="fa fa-check"></i>13.2 nycflights13</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#section-36"><i class="fa fa-check"></i>13.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#keys"><i class="fa fa-check"></i>13.3 Keys</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#section-37"><i class="fa fa-check"></i>13.3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#mutating-joins"><i class="fa fa-check"></i>13.4 Mutating joins</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#section-38"><i class="fa fa-check"></i>13.4.6</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#filtering-joins"><i class="fa fa-check"></i>13.5 Filtering joins</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#section-39"><i class="fa fa-check"></i>13.5.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#appendix-3"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#section-40"><i class="fa fa-check"></i>13.5.1.4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html"><i class="fa fa-check"></i>Ch. 14: Strings</a><ul>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#string-basics"><i class="fa fa-check"></i>14.2: String basics</a><ul>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-41"><i class="fa fa-check"></i>14.2.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#matching-patterns-w-regex"><i class="fa fa-check"></i>14.3: Matching patterns w/ regex</a><ul>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-42"><i class="fa fa-check"></i>14.3.1.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-43"><i class="fa fa-check"></i>14.3.2.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-44"><i class="fa fa-check"></i>14.3.3.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-45"><i class="fa fa-check"></i>14.3.4.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-46"><i class="fa fa-check"></i>14.3.5.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#tools"><i class="fa fa-check"></i>14.4 Tools</a><ul>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-47"><i class="fa fa-check"></i>14.4.2</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-48"><i class="fa fa-check"></i>14.4.3.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-49"><i class="fa fa-check"></i>14.4.4.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-50"><i class="fa fa-check"></i>14.4.5.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-51"><i class="fa fa-check"></i>14.4.6.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#other-types-of-patterns"><i class="fa fa-check"></i>14.5: Other types of patterns</a><ul>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-52"><i class="fa fa-check"></i>14.5.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-53"><i class="fa fa-check"></i>14.7.1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html"><i class="fa fa-check"></i>Ch. 15: Factors</a><ul>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#modifying-factor-order"><i class="fa fa-check"></i>15.4: Modifying factor order</a><ul>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#section-54"><i class="fa fa-check"></i>15.3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#modifying-factor-order-1"><i class="fa fa-check"></i>15.4: Modifying factor order</a><ul>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#section-55"><i class="fa fa-check"></i>15.4.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#modifying-factor-levels"><i class="fa fa-check"></i>15.5: Modifying factor levels</a><ul>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#section-56"><i class="fa fa-check"></i>15.5.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#appendix-4"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#viewing-all-levels"><i class="fa fa-check"></i>Viewing all levels</a></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#percentage-na-each-level"><i class="fa fa-check"></i>Percentage NA each level</a></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#print-all-levels-of-tibble"><i class="fa fa-check"></i>Print all levels of tibble</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html"><i class="fa fa-check"></i>Ch. 16: Dates and times</a><ul>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#creating-datetimes"><i class="fa fa-check"></i>16.2: Creating date/times</a><ul>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-57"><i class="fa fa-check"></i>16.2.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#date-time-components"><i class="fa fa-check"></i>16.3: Date-time components</a><ul>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-58"><i class="fa fa-check"></i>16.3.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#time-spans"><i class="fa fa-check"></i>16.4: Time spans</a><ul>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-59"><i class="fa fa-check"></i>16.4.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#appendix-5"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-60"><i class="fa fa-check"></i>16.3.4.1</a></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-61"><i class="fa fa-check"></i>16.3.4.3</a></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-62"><i class="fa fa-check"></i>16.3.4.4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="18-pipes.html"><a href="18-pipes.html"><i class="fa fa-check"></i>Ch. 18: Pipes (notes only)</a></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html"><i class="fa fa-check"></i>Ch. 19: Functions</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#when-should-you-write-a-function"><i class="fa fa-check"></i>19.2: When should you write a function?</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-63"><i class="fa fa-check"></i>19.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#functions-are-for-humans-and-computers"><i class="fa fa-check"></i>19.3: Functions are for humans and computers</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-64"><i class="fa fa-check"></i>19.3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#conditional-execution"><i class="fa fa-check"></i>19.4: Conditional execution</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-65"><i class="fa fa-check"></i>19.4.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#function-arguments"><i class="fa fa-check"></i>19.5: Function arguments</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-66"><i class="fa fa-check"></i>19.5.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#return-values"><i class="fa fa-check"></i>19.6: Return values</a></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#appendix-6"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-67"><i class="fa fa-check"></i>19.2.1.4</a></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#changing-values-with-indexes"><i class="fa fa-check"></i>Changing values with indexes</a></li>
<li><a href="19-functions.html#better-than-ifelse">Better than <code>ifelse()</code>?</a></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#dplyr-and-functions"><i class="fa fa-check"></i>Dplyr and functions</a></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-68"><i class="fa fa-check"></i>19.2.3.5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html"><i class="fa fa-check"></i>Ch. 20: Vectors</a><ul>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#section-69"><i class="fa fa-check"></i>20.3.5</a></li>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#using-atomic-vectors"><i class="fa fa-check"></i>20.4: Using atomic vectors</a><ul>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#section-70"><i class="fa fa-check"></i>20.4.6</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#recursive-vectors-lists"><i class="fa fa-check"></i>20.5: Recursive vectors (lists)</a><ul>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#section-71"><i class="fa fa-check"></i>20.5.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#augmented-vectors"><i class="fa fa-check"></i>20.7: Augmented vectors</a><ul>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#section-72"><i class="fa fa-check"></i>20.7.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#appendix-7"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#subsetting-nested-lists"><i class="fa fa-check"></i>Subsetting nested lists</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html"><i class="fa fa-check"></i>Ch. 21: Iteration</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#for-loops"><i class="fa fa-check"></i>21.2: For loops</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-73"><i class="fa fa-check"></i>21.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#for-loop-variations"><i class="fa fa-check"></i>21.3 For loop variations</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-74"><i class="fa fa-check"></i>21.3.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#for-loops-vs.-functionals"><i class="fa fa-check"></i>21.4: For loops vs. functionals</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-75"><i class="fa fa-check"></i>21.4.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#the-map-functions"><i class="fa fa-check"></i>21.5: The map functions</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-76"><i class="fa fa-check"></i>21.5.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#other-patterns-of-for-loops"><i class="fa fa-check"></i>21.9 Other patterns of for loops</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-77"><i class="fa fa-check"></i>21.9.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#appendix-8"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-78"><i class="fa fa-check"></i>21.3.5.1</a></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#with-purrr"><i class="fa fa-check"></i>21.3.5.2 (with purrr)</a></li>
<li><a href="21-iteration.html#mirroring-keep">21.9 mirroring <code>keep</code></a></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#invoke-examples"><i class="fa fa-check"></i>invoke examples</a></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#indexing-nms-caution"><i class="fa fa-check"></i>indexing nms caution</a></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#in-class-notes"><i class="fa fa-check"></i>in-class notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html"><i class="fa fa-check"></i>Ch. 23: Model basics</a><ul>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#a-simple-model"><i class="fa fa-check"></i>23.2: A simple model</a><ul>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#section-79"><i class="fa fa-check"></i>23.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#visualising-models"><i class="fa fa-check"></i>23.3: Visualising models</a><ul>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#section-80"><i class="fa fa-check"></i>23.3.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#formulas-and-model-families"><i class="fa fa-check"></i>23.4: Formulas and model families</a><ul>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#section-81"><i class="fa fa-check"></i>23.4.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#appendix-9"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#other-model-families"><i class="fa fa-check"></i>Other model families</a></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#book-example"><i class="fa fa-check"></i>23.2 book example</a></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#tidy-grid_space"><i class="fa fa-check"></i>tidy grid_space</a></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#section-82"><i class="fa fa-check"></i>23.4.5.4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html"><i class="fa fa-check"></i>Ch. 24: Model building</a><ul>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#why-are-low-quality-diamonds-more-expensive"><i class="fa fa-check"></i>24.2: Why are low quality diamonds more expensive?</a><ul>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-83"><i class="fa fa-check"></i>24.2.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#what-affects-the-number-of-daily-flights"><i class="fa fa-check"></i>24.3 What affects the number of daily flights?</a><ul>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-84"><i class="fa fa-check"></i>24.3.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#appendix-10"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-85"><i class="fa fa-check"></i>24.2.3.3</a></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-86"><i class="fa fa-check"></i>24.2.3.4</a></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-87"><i class="fa fa-check"></i>24.2.3.1</a></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#logs-simulated-examples"><i class="fa fa-check"></i>Logs (simulated examples)</a></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#diamonds-data-review"><i class="fa fa-check"></i>Diamonds data review</a></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-88"><i class="fa fa-check"></i>25.3.5.4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html"><i class="fa fa-check"></i>Ch. 25: Many models</a><ul>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#gapminder"><i class="fa fa-check"></i>25.2: gapminder</a><ul>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#section-89"><i class="fa fa-check"></i>25.2.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#creating-list-columns"><i class="fa fa-check"></i>25.4: Creating list-columns</a><ul>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#section-90"><i class="fa fa-check"></i>25.4.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#simplifying-list-columns"><i class="fa fa-check"></i>25.5: Simplifying list-columns</a><ul>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#section-91"><i class="fa fa-check"></i>25.5.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#appendix-11"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#models-in-lists"><i class="fa fa-check"></i>Models in lists</a></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#list-columns-for-sampling"><i class="fa fa-check"></i>List-columns for sampling</a></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#section-92"><i class="fa fa-check"></i>25.2.5.1</a></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#multiple-graphs-in-chunk"><i class="fa fa-check"></i>Multiple graphs in chunk</a></li>
<li><a href="25-many-models.html#listquantile-examples"><code>list(quantile())</code> examples</a></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#extracting-row-names"><i class="fa fa-check"></i>Extracting row names</a></li>
<li><a href="25-many-models.html#invoke_map-example-book"><code>invoke_map</code> example (book)</a></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#named-list-example-book"><i class="fa fa-check"></i>named list example (book)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html"><i class="fa fa-check"></i>Ch. 27: R Markdown</a><ul>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#r-markdown-basics"><i class="fa fa-check"></i>27.2 R Markdown basics</a><ul>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#section-93"><i class="fa fa-check"></i>27.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#text-formatting-with-markdown"><i class="fa fa-check"></i>27.3: Text formatting with Markdown</a><ul>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#section-94"><i class="fa fa-check"></i>27.3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#code-chunks"><i class="fa fa-check"></i>27.4: Code chunks</a><ul>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#section-95"><i class="fa fa-check"></i>27.4.7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html"><i class="fa fa-check"></i>Ch. 28: Graphics for communication</a><ul>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#label"><i class="fa fa-check"></i>28.2: Label</a><ul>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#section-96"><i class="fa fa-check"></i>28.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#annotations"><i class="fa fa-check"></i>28.3: Annotations</a><ul>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#section-97"><i class="fa fa-check"></i>28.3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#scales"><i class="fa fa-check"></i>28.4: Scales</a><ul>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#section-98"><i class="fa fa-check"></i>28.4.4</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Another set of solutions to ‘R for Data Science’</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch.-23-model-basics" class="section level1">
<h1>Ch. 23: Model basics</h1>
<ul>
<li><code>geom_abline</code> create line or lines given intercept and slopes, e.g. <code>geom_abline(aes(intercept = a1, slope = a2), data = models, alpha = 1/4)</code></li>
<li><code>optim</code> general purpose function for optimization using Newton-Raphson search</li>
<li><code>coef</code> function for extracting coefficients from a linear model</li>
<li><code>modelr::data_grid</code>, can be used to generate an evenly spaced grid of values that covers region where data lies<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a>
<ul>
<li>First arg is dataframe, next args are variable names to build grid from</li>
<li>when using with continuous data, <code>seq_range</code> or similar can be a good complement, see<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a> for an example where this is used.</li>
</ul></li>
<li><code>seq_range(x1, 5)</code> takes 5 values evenly spaced within this set. Two other useful args:
<ul>
<li><code>pretty = TRUE</code> : will generate a “pretty sequence”
++ <code>seq_range(c(0.0123, 0.923423), n = 5, pretty = TRUE)</code> , 0, 0.2, 0.4, 0.6, 0.8, 1</li>
<li><code>trim = 0.1</code> will trim off 10% of tail values (useful if vars have long tailed distribution and you want to focus on values near center)
+`expand = 0.1 is kind of the opposite and expands the range by 10%</li>
</ul></li>
<li><code>modelr::add_predictions</code> takes a data frame and modle an adds predictions from the model to a new column</li>
<li><code>modelr::add_residuals</code> is similar to above but requires actual value be in dataframe so that residuals can be calculated</li>
<li><code>modelr::spread_residuals</code> and <code>modelr::gather_residuals</code> allow you to do this for multiple models at once. equivalent are avaialble for <code>*_predictions</code> as well.</li>
<li>use <code>model_matrix</code> to see what equation is being fitted</li>
<li>To include <em>all</em> 2-way interactions can do something like this <code>model_matrix(sim3, y ~ (x1 + x2 + x3)^2)</code> or <code>model_matrix(sim3, y ~ (.)^2)</code></li>
<li>Use <code>I()</code> in <code>I(x2^2)</code> to incorporate squared term or any transformation that includes <code>+</code>, <code>-</code>, <code>*</code>, or <code>^</code></li>
<li>Use <code>poly</code> to include 1, 2, … n order terms associated with a variable, e.g. <code>model_matrix(df, y ~ poly(x, 3))</code></li>
<li><code>splines::ns()</code> represent safer alternative to <code>poly</code> that is less likely to become extreme, e.g.Interesting spline note<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a>.</li>
</ul>
<ul>
<li><code>nobs(mod)</code> see how many observations were used in model building (assuming ‘mod’ represents a model)</li>
<li>make dropping of missing values explicit with <code>options(na.action = na.warn)</code>
<ul>
<li>to make silent in specific models use e.g. <code>mod &lt;- lm(y ~ x, data = df, na.action = na.exclude)</code></li>
</ul></li>
</ul>
<div id="a-simple-model" class="section level2">
<h2>23.2: A simple model</h2>
<div id="section-79" class="section level3">
<h3>23.2.1</h3>
<ol style="list-style-type: decimal">
<li><p>One downside of the linear model is that it is sensitive to unusual values
because the distance incorporates a squared term. Fit a linear model to
the simulated data below, and visualise the results. Rerun a few times to
generate different simulated datasets. What do you notice about the model?</p>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1154-1" title="1">sim1a &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1154-2" title="2">  <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb1154-3" title="3">  <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1154-4" title="4">)</a></code></pre></div>
<p>generate n number of datasets that fit characteristics of sim1a</p>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1155-1" title="1">sim1a_mult &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">num =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">500</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1155-2" title="2"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1155-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">list</span>(<span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1155-4" title="4">    <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb1155-5" title="5">    <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1155-6" title="6">  ))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1155-7" title="7"><span class="st">  </span><span class="co">#undoes rowwise (used to have much more of workflow with rowwise, but have</span></a>
<a class="sourceLine" id="cb1155-8" title="8"><span class="st">  </span><span class="co">#changed to use more of map)</span></a>
<a class="sourceLine" id="cb1155-9" title="9"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb1155-10" title="10"></a>
<a class="sourceLine" id="cb1155-11" title="11">plots_prep &lt;-<span class="st"> </span>sim1a_mult <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1155-12" title="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mods =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> .x))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1155-13" title="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">preds =</span> <span class="kw">map2</span>(data, mods, modelr<span class="op">::</span>add_predictions),</a>
<a class="sourceLine" id="cb1155-14" title="14">         <span class="dt">rmse =</span> <span class="kw">map2_dbl</span>(mods, data, modelr<span class="op">::</span>rmse),</a>
<a class="sourceLine" id="cb1155-15" title="15">         <span class="dt">mae =</span> <span class="kw">map2_dbl</span>(mods, data, modelr<span class="op">::</span>mae))</a>
<a class="sourceLine" id="cb1155-16" title="16"></a>
<a class="sourceLine" id="cb1155-17" title="17">plots_prep <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1155-18" title="18"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">&quot;rmse&quot;</span>, <span class="dt">y =</span> rmse))<span class="op">+</span></a>
<a class="sourceLine" id="cb1155-19" title="19"><span class="st">  </span><span class="kw">geom_violin</span>()</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1156-1" title="1">plots_prep <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1156-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">&quot;rmse&quot;</span>, <span class="dt">y =</span> rmse))<span class="op">+</span></a>
<a class="sourceLine" id="cb1156-3" title="3"><span class="st">  </span>ggbeeswarm<span class="op">::</span><span class="kw">geom_beeswarm</span>()</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<ul>
<li>as a metric it tends to be more suseptible to outliers, than say mae</li>
</ul></li>
<li><p>One way to make linear models more robust is to use a different distance
measure. For example, instead of root-mean-squared distance, you could use
mean-absolute distance:</p>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1157-1" title="1">measure_distance &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {</a>
<a class="sourceLine" id="cb1157-2" title="2">  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">make_prediction</span>(mod, data)</a>
<a class="sourceLine" id="cb1157-3" title="3">  <span class="kw">mean</span>(<span class="kw">abs</span>(diff))</a>
<a class="sourceLine" id="cb1157-4" title="4">}</a></code></pre></div>
<p>Use <code>optim()</code> to fit this model to the simulated data above and compare it
to the linear model.</p>
<div class="sourceCode" id="cb1158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1158-1" title="1">model_1df &lt;-<span class="st"> </span><span class="cf">function</span>(betas, <span class="dt">x1 =</span> sim1<span class="op">$</span>x) {</a>
<a class="sourceLine" id="cb1158-2" title="2">  betas[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>betas[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb1158-3" title="3">}</a>
<a class="sourceLine" id="cb1158-4" title="4"></a>
<a class="sourceLine" id="cb1158-5" title="5">measure_mae &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {</a>
<a class="sourceLine" id="cb1158-6" title="6">  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">model_1df</span>(<span class="dt">betas =</span> mod, data<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb1158-7" title="7">  <span class="kw">mean</span>(<span class="kw">abs</span>(diff))</a>
<a class="sourceLine" id="cb1158-8" title="8">}</a>
<a class="sourceLine" id="cb1158-9" title="9"></a>
<a class="sourceLine" id="cb1158-10" title="10">measure_rmse &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {</a>
<a class="sourceLine" id="cb1158-11" title="11">  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">model_1df</span>(<span class="dt">betas =</span> mod, data<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb1158-12" title="12">  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diff<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb1158-13" title="13">}</a>
<a class="sourceLine" id="cb1158-14" title="14"></a>
<a class="sourceLine" id="cb1158-15" title="15">best_mae_sims &lt;-<span class="st"> </span><span class="kw">map</span>(sim1a_mult<span class="op">$</span>data, <span class="op">~</span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), measure_mae, <span class="dt">data =</span> .x))</a>
<a class="sourceLine" id="cb1158-16" title="16">best_rmse_sims &lt;-<span class="st"> </span><span class="kw">map</span>(sim1a_mult<span class="op">$</span>data, <span class="op">~</span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), measure_rmse, <span class="dt">data =</span> .x))</a></code></pre></div>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1159-1" title="1">mae_df &lt;-<span class="st"> </span>best_mae_sims <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-2" title="2"><span class="st">  </span><span class="kw">map</span>(<span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-3" title="3"><span class="st">  </span><span class="kw">transpose</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-4" title="4"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="st">&quot;error&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-5" title="5"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-6" title="6"><span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">error_type =</span> <span class="st">&quot;mae&quot;</span>, </a>
<a class="sourceLine" id="cb1159-8" title="8">         <span class="dt">row_n =</span> <span class="kw">row_number</span>())</a>
<a class="sourceLine" id="cb1159-9" title="9"></a>
<a class="sourceLine" id="cb1159-10" title="10">rmse_df &lt;-<span class="st"> </span>best_rmse_sims <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-11" title="11"><span class="st">  </span><span class="kw">map</span>(<span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-12" title="12"><span class="st">  </span><span class="kw">transpose</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-13" title="13"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="st">&quot;error&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-14" title="14"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-15" title="15"><span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-16" title="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">error_type =</span> <span class="st">&quot;rmse&quot;</span>,</a>
<a class="sourceLine" id="cb1159-17" title="17">         <span class="dt">row_n =</span> <span class="kw">row_number</span>())</a>
<a class="sourceLine" id="cb1159-18" title="18"></a>
<a class="sourceLine" id="cb1159-19" title="19"><span class="kw">bind_rows</span>(rmse_df, mae_df) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-20" title="20"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> row_n, <span class="dt">colour =</span> error_type))<span class="op">+</span></a>
<a class="sourceLine" id="cb1159-21" title="21"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> error))</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<ul>
<li>you can see the error for rmse seems to have more extreme examples</li>
</ul>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1160-1" title="1"><span class="kw">bind_rows</span>(rmse_df, mae_df) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> error_type, <span class="dt">colour =</span> error_type))<span class="op">+</span></a>
<a class="sourceLine" id="cb1160-3" title="3"><span class="st">  </span>ggbeeswarm<span class="op">::</span><span class="kw">geom_beeswarm</span>(<span class="kw">aes</span>(<span class="dt">y =</span> error))<span class="op">+</span></a>
<a class="sourceLine" id="cb1160-4" title="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>error_type, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<ul>
<li>let’s look at differences in the coefficients produced</li>
</ul>
<div class="sourceCode" id="cb1161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1161-1" title="1">mae_df &lt;-<span class="st"> </span>best_mae_sims <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-2" title="2"><span class="st">  </span><span class="kw">map</span>(<span class="st">&quot;par&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-3" title="3"><span class="st">  </span><span class="kw">transpose</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-4" title="4"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="st">&quot;bo&quot;</span>, <span class="st">&quot;b1&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-5" title="5"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-6" title="6"><span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">error_type =</span> <span class="st">&quot;mae&quot;</span>, </a>
<a class="sourceLine" id="cb1161-8" title="8">         <span class="dt">row_n =</span> <span class="kw">row_number</span>())</a>
<a class="sourceLine" id="cb1161-9" title="9"></a>
<a class="sourceLine" id="cb1161-10" title="10">rmse_df &lt;-<span class="st"> </span>best_rmse_sims <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-11" title="11"><span class="st">  </span><span class="kw">map</span>(<span class="st">&quot;par&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-12" title="12"><span class="st">  </span><span class="kw">transpose</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-13" title="13"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="st">&quot;bo&quot;</span>, <span class="st">&quot;b1&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-14" title="14"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-15" title="15"><span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-16" title="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">error_type =</span> <span class="st">&quot;rmse&quot;</span>,</a>
<a class="sourceLine" id="cb1161-17" title="17">         <span class="dt">row_n =</span> <span class="kw">row_number</span>())</a>
<a class="sourceLine" id="cb1161-18" title="18"></a>
<a class="sourceLine" id="cb1161-19" title="19"><span class="kw">bind_rows</span>(rmse_df, mae_df) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-20" title="20"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> bo, <span class="dt">colour =</span> error_type))<span class="op">+</span></a>
<a class="sourceLine" id="cb1161-21" title="21"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> b1))</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<ul>
<li>see more variability in the b1</li>
<li>another way of visualizing the variability in coefficients is below</li>
</ul>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1162-1" title="1"><span class="kw">left_join</span>(rmse_df, mae_df, <span class="dt">by =</span> <span class="st">&quot;row_n&quot;</span>, <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_rmse&quot;</span>, <span class="st">&quot;_mae&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1162-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b1_rmse, <span class="dt">y =</span> b1_mae))<span class="op">+</span></a>
<a class="sourceLine" id="cb1162-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1162-4" title="4"><span class="st">  </span><span class="kw">coord_fixed</span>()</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p></li>
<li><p>One challenge with performing numerical optimisation is that it’s only
guaranteed to find one local optima. What’s the problem with optimising
a three parameter model like this?</p>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1163-1" title="1">model1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {</a>
<a class="sourceLine" id="cb1163-2" title="2">  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>data<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>a[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb1163-3" title="3">}</a></code></pre></div>
<ul>
<li>the problem is that is that there are multiple “best” solutions in this example. a[1] and a[3] together represent the intercept here.</li>
</ul>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1164-1" title="1">models_two &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1164-2" title="2"></a>
<a class="sourceLine" id="cb1164-3" title="3">model1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {</a>
<a class="sourceLine" id="cb1164-4" title="4">  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>data<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>a[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb1164-5" title="5">}</a>
<a class="sourceLine" id="cb1164-6" title="6"></a>
<a class="sourceLine" id="cb1164-7" title="7">models_two[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), measure_rmse, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb1164-8" title="8">models_two[[<span class="dv">1</span>]]<span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1]  4.219814  2.051678 -3.049197</code></pre>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1166-1" title="1">model1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {</a>
<a class="sourceLine" id="cb1166-2" title="2">  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>data<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb1166-3" title="3">}</a>
<a class="sourceLine" id="cb1166-4" title="4"></a>
<a class="sourceLine" id="cb1166-5" title="5">models_two[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), measure_rmse, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb1166-6" title="6"></a>
<a class="sourceLine" id="cb1166-7" title="7">models_two</a></code></pre></div>
<pre><code>## [[1]]
## [[1]]$par
## [1]  4.219814  2.051678 -3.049197
## 
## [[1]]$value
## [1] 2.128181
## 
## [[1]]$counts
## function gradient 
##      110       NA 
## 
## [[1]]$convergence
## [1] 0
## 
## [[1]]$message
## NULL
## 
## 
## [[2]]
## [[2]]$par
## [1] 4.222248 2.051204
## 
## [[2]]$value
## [1] 2.128181
## 
## [[2]]$counts
## function gradient 
##       77       NA 
## 
## [[2]]$convergence
## [1] 0
## 
## [[2]]$message
## NULL</code></pre></li>
</ol>
<ul>
<li>a1 and a3 are essentially equivalent, so optimizes somewhat arbitrarily, in this case can see the a1+a3 in the 1st (when there are 3 parameters) is equal to a1 in the 2nd (when there are only two parameters)…</li>
<li>it would be nice if this spit out a warning of colinearity or something…</li>
</ul>
</div>
</div>
<div id="visualising-models" class="section level2">
<h2>23.3: Visualising models</h2>
<div id="section-80" class="section level3">
<h3>23.3.3</h3>
<ol style="list-style-type: decimal">
<li><p>Instead of using <code>lm()</code> to fit a straight line, you can use <code>loess()</code>
to fit a smooth curve. Repeat the process of model fitting,
grid generation, predictions, and visualisation on <code>sim1</code> using
<code>loess()</code> instead of <code>lm()</code>. How does the result compare to
<code>geom_smooth()</code>?</p>
<div class="sourceCode" id="cb1168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1168-1" title="1">sim1_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb1168-2" title="2">sim1_mod_loess &lt;-<span class="st"> </span><span class="kw">loess</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb1168-3" title="3"></a>
<a class="sourceLine" id="cb1168-4" title="4"><span class="co">#Look at plot of points</span></a>
<a class="sourceLine" id="cb1168-5" title="5">sim1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1168-6" title="6"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_mod, <span class="dt">var =</span> <span class="st">&quot;pred_lin&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1168-7" title="7"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_mod_loess) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1168-8" title="8"><span class="st">  </span><span class="kw">add_residuals</span>(sim1_mod_loess) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1168-9" title="9"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1168-10" title="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y))<span class="op">+</span></a>
<a class="sourceLine" id="cb1168-11" title="11"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> pred_lin), <span class="dt">colour =</span> <span class="st">&quot;dark green&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">size =</span> <span class="fl">2.5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1168-12" title="12"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> pred), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">size =</span> <span class="fl">2.5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1168-13" title="13"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y), <span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/23.3.3%201-1.png" width="672" /></p>
<ul>
<li>For sim1, the default value for <code>geom_smooth</code> is to use loess, os it is the exact same. <code>geom_smooth</code> will sometimes use gam or other methods depending on data, note that there is also a <code>weight</code> argument that can be useful</li>
<li>this relationship looks pretty solidly linear
<ul>
<li>below are some plots of the resids, just for kicks</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1169-1" title="1">sim1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-2" title="2"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_mod_loess, <span class="dt">var =</span> <span class="st">&quot;pred_loess&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-3" title="3"><span class="st">  </span><span class="kw">add_residuals</span>(sim1_mod_loess, <span class="dt">var =</span> <span class="st">&quot;resid_loess&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1169-4" title="4"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_mod, <span class="dt">var =</span> <span class="st">&quot;pred_lin&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-5" title="5"><span class="st">  </span><span class="kw">add_residuals</span>(sim1_mod, <span class="dt">var =</span> <span class="st">&quot;resid_lin&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1169-6" title="6"><span class="st">  </span><span class="co"># mutate(row_n = row_number) %&gt;% </span></a>
<a class="sourceLine" id="cb1169-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1169-8" title="8"><span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1169-9" title="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> resid_loess), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1169-10" title="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> resid_lin), <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1170-1" title="1">sim1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-2" title="2"><span class="st">  </span><span class="kw">gather_residuals</span>(sim1_mod, sim1_mod_loess) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1170-4" title="4"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> resid))<span class="op">+</span></a>
<a class="sourceLine" id="cb1170-5" title="5"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>model)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p></li>
<li><p><code>add_predictions()</code> is paired with <code>gather_predictions()</code> and
<code>spread_predictions()</code>. How do these three functions differ?</p>
<ul>
<li><code>spread_predictions()</code> adds a new <code>pred</code> for each model included</li>
<li><code>gather_predictions()</code> adds 2 columns <code>model</code> and <code>pred</code> for each model and repeats the input rows for each model (seems like it would work well with facets)</li>
</ul>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1171-1" title="1">sim1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1171-2" title="2"><span class="st">  </span><span class="kw">spread_predictions</span>(sim1_mod, sim1_mod_loess)</a></code></pre></div>
<pre><code>## # A tibble: 30 x 4
##        x     y sim1_mod sim1_mod_loess
##    &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;
##  1     1  4.20     6.27           5.34
##  2     1  7.51     6.27           5.34
##  3     1  2.13     6.27           5.34
##  4     2  8.99     8.32           8.27
##  5     2 10.2      8.32           8.27
##  6     2 11.3      8.32           8.27
##  7     3  7.36    10.4           10.8 
##  8     3 10.5     10.4           10.8 
##  9     3 10.5     10.4           10.8 
## 10     4 12.4     12.4           12.8 
## # ... with 20 more rows</code></pre>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1173-1" title="1"><span class="co">#How can I add a prefix when using spread_predictions() ? -- could use the method below</span></a>
<a class="sourceLine" id="cb1173-2" title="2">sim1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1173-3" title="3"><span class="st">  </span><span class="kw">gather_predictions</span>(sim1_mod, sim1_mod_loess) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1173-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">str_c</span>(model, <span class="st">&quot;_pred&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1173-5" title="5"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> model, <span class="dt">value =</span> pred)</a></code></pre></div>
<pre><code>## # A tibble: 30 x 4
##        x     y sim1_mod_loess_pred sim1_mod_pred
##    &lt;int&gt; &lt;dbl&gt;               &lt;dbl&gt;         &lt;dbl&gt;
##  1     1  2.13                5.34          6.27
##  2     1  4.20                5.34          6.27
##  3     1  7.51                5.34          6.27
##  4     2  8.99                8.27          8.32
##  5     2 10.2                 8.27          8.32
##  6     2 11.3                 8.27          8.32
##  7     3  7.36               10.8          10.4 
##  8     3 10.5                10.8          10.4 
##  9     3 10.5                10.8          10.4 
## 10     4 11.9                12.8          12.4 
## # ... with 20 more rows</code></pre>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1175-1" title="1"><span class="co">#now could add a spread_residuals() without it breaking...</span></a>
<a class="sourceLine" id="cb1175-2" title="2"></a>
<a class="sourceLine" id="cb1175-3" title="3">sim1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-4" title="4"><span class="st">  </span><span class="kw">gather_predictions</span>(sim1_mod, sim1_mod_loess) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1175-6" title="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y))<span class="op">+</span></a>
<a class="sourceLine" id="cb1175-7" title="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> pred))<span class="op">+</span></a>
<a class="sourceLine" id="cb1175-8" title="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>model)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/23.3.3%202-1.png" width="672" /></p></li>
<li><p>What does <code>geom_ref_line()</code> do? What package does it come from?
Why is displaying a reference line in plots showing residuals
useful and important?</p>
<ul>
<li>It comes from ggplot2 and shows either a geom_hline or a geom_vline, depending on whether you specify h or v. <code>ggplot2::geom_ref_line</code></li>
</ul></li>
<li><p>Why might you want to look at a frequency polygon of absolute residuals?
What are the pros and cons compared to looking at the raw residuals?</p>
<ul>
<li>may be good for situations when you have TONS of residuals, and is hard to look at?…</li>
<li>pros are it may be easier to get sense of count, cons are that you can’t plot it against something like x so patterns associated with residuals will not be picked-up, e.g. heteroskedasticity, or more simply, signs that the model could be improved by incorporating other vars in the model</li>
</ul></li>
</ol>
</div>
</div>
<div id="formulas-and-model-families" class="section level2">
<h2>23.4: Formulas and model families</h2>
<div id="section-81" class="section level3">
<h3>23.4.5</h3>
<ol style="list-style-type: decimal">
<li><p>What happens if you repeat the analysis of <code>sim2</code> using a model without
an intercept. What happens to the model equation? What happens to the
predictions?</p>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1176-1" title="1">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim2)</a>
<a class="sourceLine" id="cb1176-2" title="2">mod2_NoInt &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> sim2)</a>
<a class="sourceLine" id="cb1176-3" title="3"></a>
<a class="sourceLine" id="cb1176-4" title="4">mod2</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x, data = sim2)
## 
## Coefficients:
## (Intercept)           xb           xc           xd  
##      1.1522       6.9639       4.9750       0.7588</code></pre>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1178-1" title="1">mod2_NoInt</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x - 1, data = sim2)
## 
## Coefficients:
##    xa     xb     xc     xd  
## 1.152  8.116  6.127  1.911</code></pre>
<ul>
<li>you have an ANOVA analysis, one of the variables takes on the value of the intercept, the others all have the value of the intercept added to them.</li>
</ul></li>
<li><p>Use <code>model_matrix()</code> to explore the equations generated for the models
I fit to <code>sim3</code> and <code>sim4</code>. Why is <code>*</code> a good shorthand for interaction?</p>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1180-1" title="1"><span class="kw">model_matrix</span>(y <span class="op">~</span><span class="st"> </span>x1<span class="op">*</span>x2, <span class="dt">data =</span> sim3)</a></code></pre></div>
<pre><code>## # A tibble: 120 x 8
##    `(Intercept)`    x1   x2b   x2c   x2d `x1:x2b` `x1:x2c` `x1:x2d`
##            &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1             1     1     0     0     0        0        0        0
##  2             1     1     0     0     0        0        0        0
##  3             1     1     0     0     0        0        0        0
##  4             1     1     1     0     0        1        0        0
##  5             1     1     1     0     0        1        0        0
##  6             1     1     1     0     0        1        0        0
##  7             1     1     0     1     0        0        1        0
##  8             1     1     0     1     0        0        1        0
##  9             1     1     0     1     0        0        1        0
## 10             1     1     0     0     1        0        0        1
## # ... with 110 more rows</code></pre>
<div class="sourceCode" id="cb1182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1182-1" title="1"><span class="kw">model_matrix</span>(y <span class="op">~</span><span class="st"> </span>x1<span class="op">*</span>x2, <span class="dt">data =</span> sim4)</a></code></pre></div>
<pre><code>## # A tibble: 300 x 4
##    `(Intercept)`    x1     x2 `x1:x2`
##            &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1             1    -1 -1       1    
##  2             1    -1 -1       1    
##  3             1    -1 -1       1    
##  4             1    -1 -0.778   0.778
##  5             1    -1 -0.778   0.778
##  6             1    -1 -0.778   0.778
##  7             1    -1 -0.556   0.556
##  8             1    -1 -0.556   0.556
##  9             1    -1 -0.556   0.556
## 10             1    -1 -0.333   0.333
## # ... with 290 more rows</code></pre>
<ul>
<li>because each of the levels are multiplied by one another (just don’t have to write in the design variables)</li>
</ul></li>
<li><p>Using the basic principles, convert the formulas in the following two models into functions. (Hint: start by converting the categorical variable into 0-1 variables.)</p>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1184-1" title="1">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</a>
<a class="sourceLine" id="cb1184-2" title="2">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</a></code></pre></div>
<ul>
<li>do later</li>
</ul></li>
<li><p>For <code>sim4</code>, which of <code>mod1</code> and <code>mod2</code> is better? I think <code>mod2</code> does a slightly better job at removing patterns, but it’s pretty subtle. Can you come up with a plot to support my claim?</p></li>
</ol>
<pre><code>```r
mod1 &lt;- lm(y ~ x1 + x2, data = sim4)
mod2 &lt;- lm(y ~ x1 * x2, data = sim4)

grid &lt;-  modelr::seq_range(sim4$x1, n = 3, pretty = TRUE)

sim4 %&gt;% 
  gather_residuals(mod1, mod2) %&gt;% 
  mutate(resid_abs = (resid)^2) %&gt;% 
  group_by(model) %&gt;% 
  summarise(rmse = sqrt(mean(resid_abs)))
```

```
## # A tibble: 2 x 2
##   model  rmse
##   &lt;chr&gt; &lt;dbl&gt;
## 1 mod1   2.10
## 2 mod2   2.06
```

* The aggregate `rmse` between the two models is nearly the same.


```r
sim4 %&gt;% 
  gather_residuals(mod1, mod2) %&gt;% 
  ggplot(aes(x = resid, fill = model, group = model))+
  geom_density(alpha = 0.3)
```

&lt;img src=&quot;23-model-basics_files/figure-html/unnamed-chunk-19-1.png&quot; width=&quot;672&quot; /&gt;

* any difference in resids is pretty subtle...

*Let&#39;s plot them though and see how their predictions differ*

```r
sim4 %&gt;% 
  spread_residuals(mod1, mod2) %&gt;% 
  gather_predictions(mod1, mod2) %&gt;% 
  ggplot(aes(x1, pred, colour = x2, group = x2))+
  geom_line()+
  geom_point(aes(y = y), alpha = 0.3)+
  facet_wrap(~model)
```

&lt;img src=&quot;23-model-basics_files/figure-html/unnamed-chunk-20-1.png&quot; width=&quot;672&quot; /&gt;

* notice subtle difference where for mod2 as x2 decreases, the predicted value for x1 also decreases, this is because the interaciton term between these is positive
* the values near where x2 and x1 are most near 0 should be where the residuals are most similar

*Plot difference in residuals*</code></pre>
<div class="sourceCode" id="cb1186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1186-1" title="1">sim4 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1186-2" title="2"><span class="st">  </span><span class="kw">spread_residuals</span>(mod1, mod2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1186-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod2_less_mod1 =</span> mod2 <span class="op">-</span><span class="st"> </span>mod1) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1186-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(x1, x2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1186-5" title="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mod2_less_mod1 =</span> <span class="kw">mean</span>(mod2_less_mod1) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1186-6" title="6"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1186-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x1, <span class="dt">y =</span> x2))<span class="op">+</span></a>
<a class="sourceLine" id="cb1186-8" title="8"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> mod2_less_mod1))<span class="op">+</span></a>
<a class="sourceLine" id="cb1186-9" title="9"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">round</span>(mod2_less_mod1, <span class="dv">1</span>)), <span class="dt">size =</span> <span class="dv">3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1186-10" title="10"><span class="st">  </span><span class="kw">scale_fill_gradient2</span>()</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<ul>
<li>This shows how <code>mod2</code> has higher valued predictions when x1 and x2 are opposite signs compared to the predictions from <code>mod1</code></li>
</ul>
<p><em>Plot difference in distance from 0 between <code>mod1</code> and <code>mod1</code> resids</em></p>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1187-1" title="1">sim4 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1187-2" title="2"><span class="st">  </span><span class="kw">spread_residuals</span>(mod1, mod2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1187-3" title="3"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">c</span>(<span class="st">&quot;mod1&quot;</span>, <span class="st">&quot;mod2&quot;</span>), abs) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1187-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod2_less_mod1 =</span> mod2 <span class="op">-</span><span class="st"> </span>mod1) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1187-5" title="5"><span class="st">  </span><span class="kw">group_by</span>(x1, x2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1187-6" title="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mod2_less_mod1 =</span> <span class="kw">mean</span>(mod2_less_mod1) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1187-7" title="7"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1187-8" title="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x1, <span class="dt">y =</span> x2))<span class="op">+</span></a>
<a class="sourceLine" id="cb1187-9" title="9"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> mod2_less_mod1))<span class="op">+</span></a>
<a class="sourceLine" id="cb1187-10" title="10"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">round</span>(mod2_less_mod1, <span class="dv">1</span>)), <span class="dt">size =</span> <span class="dv">3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1187-11" title="11"><span class="st">  </span><span class="kw">scale_fill_gradient2</span>()</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<ul>
<li>see slightly more red than blue indicating that <code>mod2</code> may, in general, have slightly smaller residuals on a wider range of locations
<ul>
<li>however very little difference, and I might lean more towards <code>mod1</code> for simplicities sake</li>
</ul></li>
</ul>
</div>
</div>
<div id="appendix-9" class="section level2">
<h2>Appendix</h2>
<div id="other-model-families" class="section level3">
<h3>Other model families</h3>
<ul>
<li><p><strong>Generalised linear models</strong>, e.g. <code>stats::glm()</code>. Linear models assume that
the response is continuous and the error has a normal distribution.
Generalised linear models extend linear models to include non-continuous
responses (e.g. binary data or counts). They work by defining a distance
metric based on the statistical idea of likelihood.</p></li>
<li><p><strong>Generalised additive models</strong>, e.g. <code>mgcv::gam()</code>, extend generalised
linear models to incorporate arbitrary smooth functions. That means you can
write a formula like <code>y ~ s(x)</code> which becomes an equation like
<code>y = f(x)</code> and let <code>gam()</code> estimate what that function is (subject to some
smoothness constraints to make the problem tractable).</p></li>
<li><p><strong>Penalised linear models</strong>, e.g. <code>glmnet::glmnet()</code>, add a penalty term to
the distance that penalises complex models (as defined by the distance
between the parameter vector and the origin). This tends to make
models that generalise better to new datasets from the same population.</p></li>
<li><p><strong>Robust linear models</strong>, e.g. <code>MASS:rlm()</code>, tweak the distance to downweight
points that are very far away. This makes them less sensitive to the presence
of outliers, at the cost of being not quite as good when there are no
outliers.</p></li>
<li><p><strong>Trees</strong>, e.g. <code>rpart::rpart()</code>, attack the problem in a completely different
way than linear models. They fit a piece-wise constant model, splitting the
data into progressively smaller and smaller pieces. Trees aren’t terribly
effective by themselves, but they are very powerful when used in aggregate
by models like <strong>random forests</strong> (e.g. <code>randomForest::randomForest()</code>) or
<strong>gradient boosting machines</strong> (e.g. <code>xgboost::xgboost</code>.)</p></li>
</ul>
</div>
<div id="book-example" class="section level3">
<h3>23.2 book example</h3>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1188-1" title="1">models &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1188-2" title="2">  <span class="dt">a1 =</span> <span class="kw">runif</span>(<span class="dv">250</span>, <span class="dv">-20</span>, <span class="dv">40</span>),</a>
<a class="sourceLine" id="cb1188-3" title="3">  <span class="dt">a2 =</span> <span class="kw">runif</span>(<span class="dv">250</span>, <span class="dv">-5</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1188-4" title="4">)</a>
<a class="sourceLine" id="cb1188-5" title="5"></a>
<a class="sourceLine" id="cb1188-6" title="6"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x,y))<span class="op">+</span></a>
<a class="sourceLine" id="cb1188-7" title="7"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="kw">aes</span>(<span class="dt">intercept =</span> a1, <span class="dt">slope =</span> a2), <span class="dt">data =</span> models, <span class="dt">alpha =</span> <span class="fl">0.25</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1188-8" title="8"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Next, lets set-up a way to calculate the distance between predicted value and each point.</p>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1189-1" title="1">models_error &lt;-<span class="st"> </span>models <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1189-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">preds =</span> <span class="kw">map2</span>(<span class="dt">.y =</span> a1, <span class="dt">.x =</span> a2, <span class="op">~</span><span class="kw">mutate</span>(sim1, </a>
<a class="sourceLine" id="cb1189-3" title="3">                                                <span class="dt">pred =</span> .x<span class="op">*</span>x <span class="op">+</span><span class="st"> </span>.y,</a>
<a class="sourceLine" id="cb1189-4" title="4">                                                <span class="dt">resid =</span> y <span class="op">-</span><span class="st"> </span>pred,</a>
<a class="sourceLine" id="cb1189-5" title="5">                                                <span class="dt">error_squared =</span> (y <span class="op">-</span><span class="st"> </span>pred)<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1189-6" title="6">                                                <span class="dt">error_abs =</span> <span class="kw">abs</span>(y <span class="op">-</span><span class="st"> </span>pred))),</a>
<a class="sourceLine" id="cb1189-7" title="7">         <span class="dt">rmse =</span> <span class="kw">map_dbl</span>(preds, <span class="op">~</span>(<span class="kw">with</span>(.x, <span class="kw">mean</span>(error_squared)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sqrt</span>(.))),</a>
<a class="sourceLine" id="cb1189-8" title="8">         <span class="dt">mae =</span> <span class="kw">map_dbl</span>(preds, <span class="op">~</span><span class="kw">with</span>(.x, <span class="kw">mean</span>(error_abs))),</a>
<a class="sourceLine" id="cb1189-9" title="9">         <span class="dt">rank_rmse =</span> <span class="kw">min_rank</span>(rmse))</a></code></pre></div>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1190-1" title="1"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y))<span class="op">+</span></a>
<a class="sourceLine" id="cb1190-2" title="2"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="kw">aes</span>(<span class="dt">intercept =</span> a1, <span class="dt">slope =</span> a2, <span class="dt">colour =</span> <span class="op">-</span>rmse), </a>
<a class="sourceLine" id="cb1190-3" title="3">              <span class="dt">data =</span> <span class="kw">filter</span>(models_error, rank_rmse <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb1190-4" title="4"><span class="st">  </span><span class="kw">geom_point</span>()  </a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/distance_graph-1.png" width="672" /></p>
<p>Could instead plot this as a model of a1 vs a2 and whichever does the best</p>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1191-1" title="1">models_error <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1191-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> a1, <span class="dt">y =</span> a2))<span class="op">+</span></a>
<a class="sourceLine" id="cb1191-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">data =</span> <span class="kw">filter</span>(models_error, rank_rmse <span class="op">&lt;</span><span class="st"> </span><span class="dv">15</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb1191-4" title="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> <span class="op">-</span>rmse))</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p><em>Could be more methodical and use Grid Search.</em> Let’s use the min and max points of the top 15 to set.</p>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1192-1" title="1"><span class="co">#need helper function because distance function expects the model as a numeric vector of length 2</span></a>
<a class="sourceLine" id="cb1192-2" title="2">sim1_rmse &lt;-<span class="st"> </span><span class="cf">function</span>(b0, b1, <span class="dt">df =</span> sim1, <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>){</a>
<a class="sourceLine" id="cb1192-3" title="3">  ((b0 <span class="op">+</span><span class="st"> </span>b1<span class="op">*</span>df[[x]]) <span class="op">-</span><span class="st"> </span>df[[y]])<span class="op">^</span><span class="dv">2</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mean</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sqrt</span>()</a>
<a class="sourceLine" id="cb1192-4" title="4">}</a>
<a class="sourceLine" id="cb1192-5" title="5"></a>
<a class="sourceLine" id="cb1192-6" title="6"><span class="kw">sim1_rmse</span>(<span class="dv">2</span>,<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] 4.574414</code></pre>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1194-1" title="1">grid_space &lt;-<span class="st"> </span>models_error <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1194-2" title="2"><span class="st">  </span><span class="kw">filter</span>(rank_rmse <span class="op">&lt;</span><span class="st"> </span><span class="dv">15</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1194-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">min_x =</span> <span class="kw">min</span>(a1),</a>
<a class="sourceLine" id="cb1194-4" title="4">            <span class="dt">max_x =</span> <span class="kw">max</span>(a1),</a>
<a class="sourceLine" id="cb1194-5" title="5">            <span class="dt">min_y =</span> <span class="kw">min</span>(a2),</a>
<a class="sourceLine" id="cb1194-6" title="6">            <span class="dt">max_y =</span> <span class="kw">max</span>(a2))</a>
<a class="sourceLine" id="cb1194-7" title="7"></a>
<a class="sourceLine" id="cb1194-8" title="8">grid_models &lt;-<span class="st"> </span><span class="kw">data_grid</span>(grid_space, </a>
<a class="sourceLine" id="cb1194-9" title="9">  <span class="dt">a1 =</span> <span class="kw">seq</span>(min_x, max_x, <span class="dt">length =</span> <span class="dv">25</span>),</a>
<a class="sourceLine" id="cb1194-10" title="10">  <span class="dt">a2 =</span> <span class="kw">seq</span>(min_y, max_y, <span class="dt">length =</span> <span class="dv">25</span>)</a>
<a class="sourceLine" id="cb1194-11" title="11">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1194-12" title="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rmse =</span> <span class="kw">map2_dbl</span>(a1, a2, sim1_rmse, <span class="dt">df =</span> sim1))</a>
<a class="sourceLine" id="cb1194-13" title="13"></a>
<a class="sourceLine" id="cb1194-14" title="14">grid_models <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1194-15" title="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> a1, <span class="dt">y =</span> a2))<span class="op">+</span></a>
<a class="sourceLine" id="cb1194-16" title="16"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">data =</span> <span class="kw">filter</span>(grid_models, <span class="kw">min_rank</span>(rmse) <span class="op">&lt;</span><span class="st"> </span><span class="dv">15</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb1194-17" title="17"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> <span class="op">-</span>rmse))</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/grid%20search-1.png" width="672" /></p>
<p>In the future add-in a grid-search that would have used PCA to first rotate axes and then do min and max values.</p>
<p>Could instead use Newton-Raphson search with <code>optim</code></p>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1195-1" title="1">model_1df &lt;-<span class="st"> </span><span class="cf">function</span>(betas, <span class="dt">x1 =</span> sim1<span class="op">$</span>x) {</a>
<a class="sourceLine" id="cb1195-2" title="2">  betas[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>betas[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb1195-3" title="3">}</a>
<a class="sourceLine" id="cb1195-4" title="4"></a>
<a class="sourceLine" id="cb1195-5" title="5">measure_rmse &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {</a>
<a class="sourceLine" id="cb1195-6" title="6">  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">model_1df</span>(<span class="dt">betas =</span> mod, data<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb1195-7" title="7">  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diff<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb1195-8" title="8">}</a>
<a class="sourceLine" id="cb1195-9" title="9"></a>
<a class="sourceLine" id="cb1195-10" title="10">best_rmse &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), measure_rmse, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb1195-11" title="11"></a>
<a class="sourceLine" id="cb1195-12" title="12">best_rmse<span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] 4.222248 2.051204</code></pre>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1197-1" title="1">best_rmse<span class="op">$</span>value</a></code></pre></div>
<pre><code>## [1] 2.128181</code></pre>
<p>Above is equivalent to R’s <code>lm</code> function</p>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1199-1" title="1">sim1_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb1199-2" title="2"></a>
<a class="sourceLine" id="cb1199-3" title="3">sim1_mod <span class="op">%&gt;%</span><span class="st"> </span>coef</a></code></pre></div>
<pre><code>## (Intercept)           x 
##    4.220822    2.051533</code></pre>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1201-1" title="1"><span class="kw">rmse</span>(sim1_mod, sim1)</a></code></pre></div>
<pre><code>## [1] 2.128181</code></pre>
<ul>
<li>Notice are <em>slightly</em> different, perhaps due to number of steps optim will take</li>
</ul>
<p>E.g. could build a function for optimizing upon MAE instead and still works</p>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1203-1" title="1">measure_mae &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {</a>
<a class="sourceLine" id="cb1203-2" title="2">  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">model_1df</span>(<span class="dt">betas =</span> mod, data<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb1203-3" title="3">  <span class="kw">mean</span>(<span class="kw">abs</span>(diff))</a>
<a class="sourceLine" id="cb1203-4" title="4">}</a>
<a class="sourceLine" id="cb1203-5" title="5"></a>
<a class="sourceLine" id="cb1203-6" title="6">best_mae &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), measure_mae, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb1203-7" title="7"></a>
<a class="sourceLine" id="cb1203-8" title="8">best_mae<span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] 4.364852 2.048918</code></pre>
</div>
<div id="tidy-grid_space" class="section level3">
<h3>tidy grid_space</h3>
<p>Below is a pseudo-tidy way of creating the <code>grid_space</code> var from above, it actually took more effort to create this probably, so didn’t use. However you could imagine if you had to do this across A LOT of values it could be worth doing it this way</p>
<div class="sourceCode" id="cb1205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1205-1" title="1">funs_names &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">funs =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;min&quot;</span>, <span class="dv">2</span>), <span class="kw">rep</span>(<span class="st">&quot;max&quot;</span>, <span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb1205-2" title="2">                     <span class="dt">coord =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1205-3" title="3">                     <span class="dt">field_names =</span> <span class="kw">str_c</span>(funs, <span class="st">&quot;_&quot;</span>, coord))</a>
<a class="sourceLine" id="cb1205-4" title="4"></a>
<a class="sourceLine" id="cb1205-5" title="5">grid_space &lt;-<span class="st"> </span>models_error <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1205-6" title="6"><span class="st">  </span><span class="kw">filter</span>(rank_rmse <span class="op">&lt;</span><span class="st"> </span><span class="dv">15</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1205-7" title="7"><span class="st">  </span><span class="kw">select</span>(a1, a2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1205-8" title="8"><span class="st">  </span><span class="kw">rep</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1205-9" title="9"><span class="st">  </span><span class="kw">invoke_map</span>(<span class="dt">.f =</span> funs_names<span class="op">$</span>funs,</a>
<a class="sourceLine" id="cb1205-10" title="10">             <span class="dt">.x =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1205-11" title="11"><span class="st">  </span><span class="kw">set_names</span>(funs_names<span class="op">$</span>field_names) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1205-12" title="12"><span class="st">  </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb1205-13" title="13"></a>
<a class="sourceLine" id="cb1205-14" title="14">grid_space</a></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   min_x min_y max_x max_y
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 -8.30 0.381  14.0  3.86</code></pre>
</div>
<div id="section-82" class="section level3">
<h3>23.4.5.4</h3>
<p>Rather than <code>geom_density</code> or <code>geom_freqpoly</code> let’s look at histogram with values overlaid rather than stacked.</p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1207-1" title="1">sim4 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1207-2" title="2"><span class="st">  </span><span class="kw">gather_residuals</span>(mod1, mod2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1207-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> resid, <span class="dt">y =</span> ..density.., <span class="dt">fill =</span> model))<span class="op">+</span></a>
<a class="sourceLine" id="cb1207-4" title="4"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>)</a></code></pre></div>
<p><img src="23-model-basics_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>

<div class="footnotes">
<hr />
<ol start="29">
<li id="fn29"><p><code>expand.grid</code> is very similar to <code>data_grid</code><a href="23-model-basics.html#fnref29" class="footnote-back">↩</a></p></li>
</ol>
</div>
<div id="disqus_thread"></div>
<script>
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//brshallo.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the
<a href="https://disqus.com/?ref_noscript">
  comments powered by Disqus.</a></noscript>
            </section>

          </div>
        </div>
      </div>
<a href="21-iteration.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="24-model-building.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": true,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
