<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Another set of solutions to ‘R for Data Science’</title>
  <meta name="description" content="My notes and solutions to ‘R for Data Science’ by Garrett Grolemund and Hadley Wickham">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Another set of solutions to ‘R for Data Science’" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://brshallo.github.io/R4DS_Solutions/" />
  
  <meta property="og:description" content="My notes and solutions to ‘R for Data Science’ by Garrett Grolemund and Hadley Wickham" />
  <meta name="github-repo" content="https://github.com/brshallo/R4DS_Solutions" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Another set of solutions to ‘R for Data Science’" />
  
  <meta name="twitter:description" content="My notes and solutions to ‘R for Data Science’ by Garrett Grolemund and Hadley Wickham" />
  

<meta name="author" content="Bryan Shalloway">


<meta name="date" content="2019-05-28">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="12-tidy-data.html">
<link rel="next" href="14-strings.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.8.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.39.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.39.2/plotly-latest.min.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.3.1/str_view.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Chapter contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Purpose of this book</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#features-of-this-book"><i class="fa fa-check"></i>Features of this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#origin-of-this-book"><i class="fa fa-check"></i>Origin of this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#plug-for-r4ds"><i class="fa fa-check"></i>Plug for R4DS</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#plug-for-r4ds-1"><i class="fa fa-check"></i>Plug for R4DS</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html"><i class="fa fa-check"></i>Ch 3: Data visualization</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#first-steps"><i class="fa fa-check"></i>3.2: First steps</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section"><i class="fa fa-check"></i>3.2.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#aesthetic-mappings"><i class="fa fa-check"></i>3.3: Aesthetic mappings</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-1"><i class="fa fa-check"></i>3.3.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#facets"><i class="fa fa-check"></i>3.5: Facets</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-2"><i class="fa fa-check"></i>3.5.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#geometric-objects"><i class="fa fa-check"></i>3.6: Geometric Objects</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-3"><i class="fa fa-check"></i>3.6.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#statistical-transformations"><i class="fa fa-check"></i>3.7: Statistical transformations</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-4"><i class="fa fa-check"></i>3.7.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#position-adjjustment"><i class="fa fa-check"></i>3.8: Position Adjjustment</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-5"><i class="fa fa-check"></i>3.8.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#coordinate-systems"><i class="fa fa-check"></i>3.9: Coordinate systems</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#section-6"><i class="fa fa-check"></i>3.9.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#appendix"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="03-data-visualization.html"><a href="03-data-visualization.html#extension"><i class="fa fa-check"></i>3.7.1.1 extension</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html"><i class="fa fa-check"></i>Ch. 5 Data transformations</a><ul>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#filter-rows"><i class="fa fa-check"></i>5.2: Filter rows</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-7"><i class="fa fa-check"></i>5.2.4.</a><ul>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-8"><i class="fa fa-check"></i>5.3.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#grouped-summaries"><i class="fa fa-check"></i>5.6: Grouped summaries</a><ul>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-9"><i class="fa fa-check"></i>5.6.7.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#grouped-mutates-and-filters"><i class="fa fa-check"></i>Grouped mutates (and filters)</a><ul>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-10"><i class="fa fa-check"></i>5.7.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#appendix-1"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-11"><i class="fa fa-check"></i>5.4.1.3.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-12"><i class="fa fa-check"></i>5.5.2.1.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-13"><i class="fa fa-check"></i>5.5.2.2</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-14"><i class="fa fa-check"></i>5.6.7.1.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-15"><i class="fa fa-check"></i>5.6.7.4.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-16"><i class="fa fa-check"></i>5.6.7.5.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-17"><i class="fa fa-check"></i>5.6.7.6.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-18"><i class="fa fa-check"></i>5.7.1.6.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-19"><i class="fa fa-check"></i>5.7.1.5</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#section-20"><i class="fa fa-check"></i>5.7.1.8.</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#on-piping-dots"><i class="fa fa-check"></i>On piping dots</a></li>
<li class="chapter" data-level="" data-path="05-data-transformations.html"><a href="05-data-transformations.html#plotly"><i class="fa fa-check"></i>plotly</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html"><i class="fa fa-check"></i>Ch. 7: Data exploration</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#variation"><i class="fa fa-check"></i>7.3. Variation</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-21"><i class="fa fa-check"></i>7.3.4.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#missing-values"><i class="fa fa-check"></i>7.4. Missing values</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-22"><i class="fa fa-check"></i>7.4.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#covariation"><i class="fa fa-check"></i>7.5. Covariation</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-23"><i class="fa fa-check"></i>7.5.1.1.</a></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-24"><i class="fa fa-check"></i>7.5.2.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#two-continuous-variables"><i class="fa fa-check"></i>7.5.3 Two continuous variables</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-25"><i class="fa fa-check"></i>7.5.3.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#appendix-2"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-26"><i class="fa fa-check"></i>7.5.2.1.2.</a></li>
<li class="chapter" data-level="" data-path="07-exploratory-data-analysis.html"><a href="07-exploratory-data-analysis.html#section-27"><i class="fa fa-check"></i>7.5.3.1.4.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="10-tibbles.html"><a href="10-tibbles.html"><i class="fa fa-check"></i>Ch. 10: Tibbles</a><ul>
<li class="chapter" data-level="" data-path="10-tibbles.html"><a href="10-tibbles.html#section-28"><i class="fa fa-check"></i>10.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="11-data-import.html"><a href="11-data-import.html"><i class="fa fa-check"></i>Ch. 11: Data import</a><ul>
<li class="chapter" data-level="" data-path="11-data-import.html"><a href="11-data-import.html#section-29"><i class="fa fa-check"></i>11.2.2.</a></li>
<li class="chapter" data-level="" data-path="11-data-import.html"><a href="11-data-import.html#section-30"><i class="fa fa-check"></i>11.3.5.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html"><i class="fa fa-check"></i>ch. 12: Tidy data</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#tidy-data"><i class="fa fa-check"></i>12.2: Tidy data</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#section-31"><i class="fa fa-check"></i>12.2.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#spreading-and-gathering"><i class="fa fa-check"></i>12.3: Spreading and gathering</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#section-32"><i class="fa fa-check"></i>12.3.3.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#separating-and-uniting"><i class="fa fa-check"></i>12.4: Separating and uniting</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#section-33"><i class="fa fa-check"></i>12.4.3.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#missing-values-1"><i class="fa fa-check"></i>12.5: missing values</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#section-34"><i class="fa fa-check"></i>12.5.1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#case-study"><i class="fa fa-check"></i>12.6 Case Study</a><ul>
<li class="chapter" data-level="" data-path="12-tidy-data.html"><a href="12-tidy-data.html#section-35"><i class="fa fa-check"></i>12.6.1.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html"><i class="fa fa-check"></i>Ch. 13: Relational data</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#nycflights13"><i class="fa fa-check"></i>13.2 nycflights13</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#section-36"><i class="fa fa-check"></i>13.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#keys"><i class="fa fa-check"></i>13.3 Keys</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#section-37"><i class="fa fa-check"></i>13.3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#mutating-joins"><i class="fa fa-check"></i>13.4 Mutating joins</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#section-38"><i class="fa fa-check"></i>13.4.6</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#filtering-joins"><i class="fa fa-check"></i>13.5 Filtering joins</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#section-39"><i class="fa fa-check"></i>13.5.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#appendix-3"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="13-relational-data.html"><a href="13-relational-data.html#section-40"><i class="fa fa-check"></i>13.5.1.4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html"><i class="fa fa-check"></i>Ch. 14: Strings</a><ul>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#string-basics"><i class="fa fa-check"></i>14.2: String basics</a><ul>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-41"><i class="fa fa-check"></i>14.2.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#matching-patterns-w-regex"><i class="fa fa-check"></i>14.3: Matching patterns w/ regex</a><ul>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-42"><i class="fa fa-check"></i>14.3.1.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-43"><i class="fa fa-check"></i>14.3.2.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-44"><i class="fa fa-check"></i>14.3.3.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-45"><i class="fa fa-check"></i>14.3.4.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-46"><i class="fa fa-check"></i>14.3.5.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#tools"><i class="fa fa-check"></i>14.4 Tools</a><ul>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-47"><i class="fa fa-check"></i>14.4.2</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-48"><i class="fa fa-check"></i>14.4.3.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-49"><i class="fa fa-check"></i>14.4.4.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-50"><i class="fa fa-check"></i>14.4.5.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-51"><i class="fa fa-check"></i>14.4.6.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#other-types-of-patterns"><i class="fa fa-check"></i>14.5: Other types of patterns</a><ul>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-52"><i class="fa fa-check"></i>14.5.1</a></li>
<li class="chapter" data-level="" data-path="14-strings.html"><a href="14-strings.html#section-53"><i class="fa fa-check"></i>14.7.1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html"><i class="fa fa-check"></i>Ch. 15: Factors</a><ul>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#modifying-factor-order"><i class="fa fa-check"></i>15.4: Modifying factor order</a><ul>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#section-54"><i class="fa fa-check"></i>15.3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#modifying-factor-order-1"><i class="fa fa-check"></i>15.4: Modifying factor order</a><ul>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#section-55"><i class="fa fa-check"></i>15.4.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#modifying-factor-levels"><i class="fa fa-check"></i>15.5: Modifying factor levels</a><ul>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#section-56"><i class="fa fa-check"></i>15.5.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#appendix-4"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#viewing-all-levels"><i class="fa fa-check"></i>Viewing all levels</a></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#percentage-na-each-level"><i class="fa fa-check"></i>Percentage NA each level</a></li>
<li class="chapter" data-level="" data-path="15-factors.html"><a href="15-factors.html#print-all-levels-of-tibble"><i class="fa fa-check"></i>Print all levels of tibble</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html"><i class="fa fa-check"></i>Ch. 16: Dates and times</a><ul>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#creating-datetimes"><i class="fa fa-check"></i>16.2: Creating date/times</a><ul>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-57"><i class="fa fa-check"></i>16.2.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#date-time-components"><i class="fa fa-check"></i>16.3: Date-time components</a><ul>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-58"><i class="fa fa-check"></i>16.3.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#time-spans"><i class="fa fa-check"></i>16.4: Time spans</a><ul>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-59"><i class="fa fa-check"></i>16.4.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#appendix-5"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-60"><i class="fa fa-check"></i>16.3.4.1</a></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-61"><i class="fa fa-check"></i>16.3.4.3</a></li>
<li class="chapter" data-level="" data-path="16-dates-and-times.html"><a href="16-dates-and-times.html#section-62"><i class="fa fa-check"></i>16.3.4.4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="18-pipes.html"><a href="18-pipes.html"><i class="fa fa-check"></i>Ch. 18: Pipes (notes only)</a></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html"><i class="fa fa-check"></i>Ch. 19: Functions</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#when-should-you-write-a-function"><i class="fa fa-check"></i>19.2: When should you write a function?</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-63"><i class="fa fa-check"></i>19.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#functions-are-for-humans-and-computers"><i class="fa fa-check"></i>19.3: Functions are for humans and computers</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-64"><i class="fa fa-check"></i>19.3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#conditional-execution"><i class="fa fa-check"></i>19.4: Conditional execution</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-65"><i class="fa fa-check"></i>19.4.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#function-arguments"><i class="fa fa-check"></i>19.5: Function arguments</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-66"><i class="fa fa-check"></i>19.5.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#return-values"><i class="fa fa-check"></i>19.6: Return values</a></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#appendix-6"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-67"><i class="fa fa-check"></i>19.2.1.4</a></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#changing-values-with-indexes"><i class="fa fa-check"></i>Changing values with indexes</a></li>
<li><a href="19-functions.html#better-than-ifelse">Better than <code>ifelse()</code>?</a></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#dplyr-and-functions"><i class="fa fa-check"></i>Dplyr and functions</a></li>
<li class="chapter" data-level="" data-path="19-functions.html"><a href="19-functions.html#section-68"><i class="fa fa-check"></i>19.2.3.5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html"><i class="fa fa-check"></i>Ch. 20: Vectors</a><ul>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#section-69"><i class="fa fa-check"></i>20.3.5</a></li>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#using-atomic-vectors"><i class="fa fa-check"></i>20.4: Using atomic vectors</a><ul>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#section-70"><i class="fa fa-check"></i>20.4.6</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#recursive-vectors-lists"><i class="fa fa-check"></i>20.5: Recursive vectors (lists)</a><ul>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#section-71"><i class="fa fa-check"></i>20.5.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#augmented-vectors"><i class="fa fa-check"></i>20.7: Augmented vectors</a><ul>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#section-72"><i class="fa fa-check"></i>20.7.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#appendix-7"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="20-vectors.html"><a href="20-vectors.html#subsetting-nested-lists"><i class="fa fa-check"></i>Subsetting nested lists</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html"><i class="fa fa-check"></i>Ch. 21: Iteration</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#for-loops"><i class="fa fa-check"></i>21.2: For loops</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-73"><i class="fa fa-check"></i>21.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#for-loop-variations"><i class="fa fa-check"></i>21.3 For loop variations</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-74"><i class="fa fa-check"></i>21.3.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#for-loops-vs.-functionals"><i class="fa fa-check"></i>21.4: For loops vs. functionals</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-75"><i class="fa fa-check"></i>21.4.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#the-map-functions"><i class="fa fa-check"></i>21.5: The map functions</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-76"><i class="fa fa-check"></i>21.5.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#other-patterns-of-for-loops"><i class="fa fa-check"></i>21.9 Other patterns of for loops</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-77"><i class="fa fa-check"></i>21.9.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#appendix-8"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#section-78"><i class="fa fa-check"></i>21.3.5.1</a></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#with-purrr"><i class="fa fa-check"></i>21.3.5.2 (with purrr)</a></li>
<li><a href="21-iteration.html#mirroring-keep">21.9 mirroring <code>keep</code></a></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#invoke-examples"><i class="fa fa-check"></i>invoke examples</a></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#indexing-nms-caution"><i class="fa fa-check"></i>indexing nms caution</a></li>
<li class="chapter" data-level="" data-path="21-iteration.html"><a href="21-iteration.html#in-class-notes"><i class="fa fa-check"></i>in-class notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html"><i class="fa fa-check"></i>Ch. 23: Model basics</a><ul>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#a-simple-model"><i class="fa fa-check"></i>23.2: A simple model</a><ul>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#section-79"><i class="fa fa-check"></i>23.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#visualising-models"><i class="fa fa-check"></i>23.3: Visualising models</a><ul>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#section-80"><i class="fa fa-check"></i>23.3.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#formulas-and-model-families"><i class="fa fa-check"></i>23.4: Formulas and model families</a><ul>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#section-81"><i class="fa fa-check"></i>23.4.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#appendix-9"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#other-model-families"><i class="fa fa-check"></i>Other model families</a></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#book-example"><i class="fa fa-check"></i>23.2 book example</a></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#tidy-grid_space"><i class="fa fa-check"></i>tidy grid_space</a></li>
<li class="chapter" data-level="" data-path="23-model-basics.html"><a href="23-model-basics.html#section-82"><i class="fa fa-check"></i>23.4.5.4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html"><i class="fa fa-check"></i>Ch. 24: Model building</a><ul>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#why-are-low-quality-diamonds-more-expensive"><i class="fa fa-check"></i>24.2: Why are low quality diamonds more expensive?</a><ul>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-83"><i class="fa fa-check"></i>24.2.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#what-affects-the-number-of-daily-flights"><i class="fa fa-check"></i>24.3 What affects the number of daily flights?</a><ul>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-84"><i class="fa fa-check"></i>24.3.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#appendix-10"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-85"><i class="fa fa-check"></i>24.2.3.3</a></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-86"><i class="fa fa-check"></i>24.2.3.4</a></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-87"><i class="fa fa-check"></i>24.2.3.1</a></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#logs-simulated-examples"><i class="fa fa-check"></i>Logs (simulated examples)</a></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#diamonds-data-review"><i class="fa fa-check"></i>Diamonds data review</a></li>
<li class="chapter" data-level="" data-path="24-model-building.html"><a href="24-model-building.html#section-88"><i class="fa fa-check"></i>25.3.5.4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html"><i class="fa fa-check"></i>Ch. 25: Many models</a><ul>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#gapminder"><i class="fa fa-check"></i>25.2: gapminder</a><ul>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#section-89"><i class="fa fa-check"></i>25.2.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#creating-list-columns"><i class="fa fa-check"></i>25.4: Creating list-columns</a><ul>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#section-90"><i class="fa fa-check"></i>25.4.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#simplifying-list-columns"><i class="fa fa-check"></i>25.5: Simplifying list-columns</a><ul>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#section-91"><i class="fa fa-check"></i>25.5.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#appendix-11"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#models-in-lists"><i class="fa fa-check"></i>Models in lists</a></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#list-columns-for-sampling"><i class="fa fa-check"></i>List-columns for sampling</a></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#section-92"><i class="fa fa-check"></i>25.2.5.1</a></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#multiple-graphs-in-chunk"><i class="fa fa-check"></i>Multiple graphs in chunk</a></li>
<li><a href="25-many-models.html#listquantile-examples"><code>list(quantile())</code> examples</a></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#extracting-row-names"><i class="fa fa-check"></i>Extracting row names</a></li>
<li><a href="25-many-models.html#invoke_map-example-book"><code>invoke_map</code> example (book)</a></li>
<li class="chapter" data-level="" data-path="25-many-models.html"><a href="25-many-models.html#named-list-example-book"><i class="fa fa-check"></i>named list example (book)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html"><i class="fa fa-check"></i>Ch. 27: R Markdown</a><ul>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#r-markdown-basics"><i class="fa fa-check"></i>27.2 R Markdown basics</a><ul>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#section-93"><i class="fa fa-check"></i>27.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#text-formatting-with-markdown"><i class="fa fa-check"></i>27.3: Text formatting with Markdown</a><ul>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#section-94"><i class="fa fa-check"></i>27.3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#code-chunks"><i class="fa fa-check"></i>27.4: Code chunks</a><ul>
<li class="chapter" data-level="" data-path="27-r-markdown.html"><a href="27-r-markdown.html#section-95"><i class="fa fa-check"></i>27.4.7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html"><i class="fa fa-check"></i>Ch. 28: Graphics for communication</a><ul>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#label"><i class="fa fa-check"></i>28.2: Label</a><ul>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#section-96"><i class="fa fa-check"></i>28.2.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#annotations"><i class="fa fa-check"></i>28.3: Annotations</a><ul>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#section-97"><i class="fa fa-check"></i>28.3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#scales"><i class="fa fa-check"></i>28.4: Scales</a><ul>
<li class="chapter" data-level="" data-path="28-graphics-for-communication.html"><a href="28-graphics-for-communication.html#section-98"><i class="fa fa-check"></i>28.4.4</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Another set of solutions to ‘R for Data Science’</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch.-13-relational-data" class="section level1">
<h1>Ch. 13: Relational data</h1>
<blockquote>
<p>“The relations of three or more tables are always a property of the relations between each pairs.”</p>
</blockquote>
<ul>
<li><p>Three families of verbs in relational data: *</p></li>
<li><strong>Mutating joins</strong>, which add new variables to one data frame from matching
observations in another.
<ul>
<li><code>inner_join</code>: match when equal</li>
<li><code>left_join</code>: keep all observations in table in 1st arg</li>
<li><code>right_join</code>: keep all observations in table in 2nd arg</li>
<li><code>full_join</code>: keep all observations in table in 1st and 2nd arg</li>
</ul></li>
<li><strong>Filtering joins</strong>, which filter observations from one data frame based on
whether or not they match an observation in the other table.
<ul>
<li><code>semi_join(x, y)</code> <strong>keeps</strong> all observations in <code>x</code> that have a match in <code>y</code>.</li>
<li><code>anti_join(x, y)</code> <strong>drops</strong> all observations in <code>x</code> that have a match in <code>y</code>.</li>
</ul></li>
<li><strong>Set operations</strong>, which treat observations as if they were set elements.
<ul>
<li><code>intersect(x, y)</code>: return only observations in both <code>x</code> and <code>y</code> (when inputs are a df, is comparing across all values in a row).</li>
<li><code>union(x, y)</code>: return unique observations in <code>x</code> and <code>y</code>.</li>
<li><code>setdiff(x, y)</code>: return observations in <code>x</code>, but not in <code>y</code>.</li>
</ul></li>
</ul>
<p><code>base::merge()</code> can perform all four types of mutating join:</p>
<table>
<thead>
<tr class="header">
<th>dplyr</th>
<th>merge</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>inner_join(x, y)</code></td>
<td><code>merge(x, y)</code></td>
</tr>
<tr class="even">
<td><code>left_join(x, y)</code></td>
<td><code>merge(x, y, all.x = TRUE)</code></td>
</tr>
<tr class="odd">
<td><code>right_join(x, y)</code></td>
<td><code>merge(x, y, all.y = TRUE)</code>,</td>
</tr>
<tr class="even">
<td><code>full_join(x, y)</code></td>
<td><code>merge(x, y, all.x = TRUE, all.y = TRUE)</code></td>
</tr>
</tbody>
</table>
<p>SQL is the inspiration for dplyr’s conventions, so the translation is straightforward:</p>
<table>
<thead>
<tr class="header">
<th>dplyr</th>
<th>SQL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>inner_join(x, y, by = "z")</code></td>
<td><code>SELECT * FROM x INNER JOIN y USING (z)</code></td>
</tr>
<tr class="even">
<td><code>left_join(x, y, by = "z")</code></td>
<td><code>SELECT * FROM x LEFT OUTER JOIN y USING (z)</code></td>
</tr>
<tr class="odd">
<td><code>right_join(x, y, by = "z")</code></td>
<td><code>SELECT * FROM x RIGHT OUTER JOIN y USING (z)</code></td>
</tr>
<tr class="even">
<td><code>full_join(x, y, by = "z")</code></td>
<td><code>SELECT * FROM x FULL OUTER JOIN y USING (z)</code></td>
</tr>
</tbody>
</table>
<div id="nycflights13" class="section level2">
<h2>13.2 nycflights13</h2>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb543-1" title="1">flights</a>
<a class="sourceLine" id="cb543-2" title="2">airlines</a>
<a class="sourceLine" id="cb543-3" title="3">airports</a>
<a class="sourceLine" id="cb543-4" title="4">planes</a>
<a class="sourceLine" id="cb543-5" title="5">weather</a></code></pre></div>
<div id="section-36" class="section level3">
<h3>13.2.1</h3>
<ol style="list-style-type: decimal">
<li><p><em>Imagine you wanted to draw (approximately) the route each plane flies from</em>
<em>its origin to its destination. What variables would you need? What tables</em>
<em>would you need to combine?</em></p>
<p>To draw a line from origin to destination, I need the lat lon points from airports<code>as well as the dest and origin variables from</code>flights`.</p></li>
<li><p><em>I forgot to draw the relationship between <code>weather</code> and <code>airports</code>.</em>
<em>What is the relationship and how should it appear in the diagram?</em></p>
<p><code>origin</code> from <code>weather connects to</code>faa<code>from</code>airports` in a many to one relationship</p></li>
<li><p><em><code>weather</code> only contains information for the origin (NYC) airports. If</em>
<em>it contained weather records for all airports in the USA, what additional</em>
<em>relation would it define with <code>flights</code>?</em></p>
<p>It would connect to <code>dest</code>.</p></li>
<li><p><em>We know that some days of the year are “special”, and fewer people than</em>
<em>usual fly on them. How might you represent that data as a data frame?</em>
<em>What would be the primary keys of that table? How would it connect to the</em>
<em>existing tables?</em></p>
<p>Make a set of days that are less popular and have these dates connect by month and day</p></li>
</ol>
</div>
</div>
<div id="keys" class="section level2">
<h2>13.3 Keys</h2>
<div id="section-37" class="section level3">
<h3>13.3.1</h3>
<ol style="list-style-type: decimal">
<li><p><em>Add a surrogate key to <code>flights</code>.</em></p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb544-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb544-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">surrogate_key =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb544-3" title="3"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 336,776
## Variables: 20
## $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013,...
## $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 55...
## $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 60...
## $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2...
## $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 7...
## $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 7...
## $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -...
## $ carrier        &lt;chr&gt; &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;, &quot;DL&quot;, &quot;UA&quot;, &quot;B6&quot;, &quot;EV&quot;,...
## $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79...
## $ tailnum        &lt;chr&gt; &quot;N14228&quot;, &quot;N24211&quot;, &quot;N619AA&quot;, &quot;N804JB&quot;, &quot;N668DN...
## $ origin         &lt;chr&gt; &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;JFK&quot;, &quot;LGA&quot;, &quot;EWR&quot;, &quot;EWR&quot;...
## $ dest           &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;MIA&quot;, &quot;BQN&quot;, &quot;ATL&quot;, &quot;ORD&quot;, &quot;FLL&quot;...
## $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138...
## $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 94...
## $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5,...
## $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, ...
## $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013...
## $ surrogate_key  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, ...</code></pre></li>
<li><p><em>Identify the keys in the following datasets</em></p>
<ol style="list-style-type: decimal">
<li><code>Lahman::Batting</code>: player, year, stint</li>
</ol>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb546-1" title="1">Lahman<span class="op">::</span>Batting <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb546-2" title="2"><span class="st">  </span><span class="kw">count</span>(playerID, yearID, stint) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb546-3" title="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 4
## # ... with 4 variables: playerID &lt;chr&gt;, yearID &lt;int&gt;, stint &lt;int&gt;, n &lt;int&gt;</code></pre>
<ol style="list-style-type: decimal">
<li><code>babynames::babynames</code>: name, sex, year</li>
</ol>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb548-1" title="1">babynames<span class="op">::</span>babynames <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb548-2" title="2"><span class="st">  </span><span class="kw">count</span>(name, sex, year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb548-3" title="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 4
## # ... with 4 variables: name &lt;chr&gt;, sex &lt;chr&gt;, year &lt;dbl&gt;, n &lt;int&gt;</code></pre>
<ol style="list-style-type: decimal">
<li><code>nasaweather::atmos</code>: lat, long, year, month</li>
</ol>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb550-1" title="1">nasaweather<span class="op">::</span>atmos <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb550-2" title="2"><span class="st">  </span><span class="kw">count</span>(lat, long, year, month) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb550-3" title="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 5
## # ... with 5 variables: lat &lt;dbl&gt;, long &lt;dbl&gt;, year &lt;int&gt;, month &lt;int&gt;,
## #   n &lt;int&gt;</code></pre>
<ol style="list-style-type: decimal">
<li><code>fueleconomy::vehicles</code>: id</li>
</ol>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb552-1" title="1">fueleconomy<span class="op">::</span>vehicles <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb552-2" title="2"><span class="st">  </span><span class="kw">count</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb552-3" title="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 2
## # ... with 2 variables: id &lt;int&gt;, n &lt;int&gt;</code></pre>
<ol style="list-style-type: decimal">
<li><code>ggplot2::diamonds</code>: needs surrogate</li>
</ol>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb554-1" title="1">diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb554-2" title="2"><span class="st">  </span><span class="kw">count</span>(x, y, z, depth, table, carat, cut, color, price, clarity ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb554-3" title="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 143 x 11
##        x     y     z depth table carat cut       color price clarity     n
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;int&gt; &lt;ord&gt;   &lt;int&gt;
##  1  0     0     0     64.1    60  0.71 Good      F      2130 SI2         2
##  2  4.23  4.26  2.69  63.4    57  0.3  Good      J       394 VS1         2
##  3  4.26  4.23  2.69  63.4    57  0.3  Very Good J       506 VS1         2
##  4  4.26  4.29  2.66  62.2    57  0.3  Ideal     H       450 SI1         2
##  5  4.27  4.28  2.66  62.2    57  0.3  Ideal     H       450 SI1         2
##  6  4.29  4.31  2.71  63      55  0.3  Very Good G       526 VS2         2
##  7  4.29  4.31  2.73  63.5    56  0.31 Good      D       571 SI1         2
##  8  4.31  4.28  2.67  62.2    58  0.3  Premium   D       709 SI1         2
##  9  4.31  4.29  2.71  63      55  0.3  Ideal     G       675 VS2         2
## 10  4.31  4.29  2.73  63.5    56  0.31 Very Good D       732 SI1         2
## # ... with 133 more rows</code></pre>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb556-1" title="1">diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb556-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">surrogate_id =</span> <span class="kw">row_number</span>())</a></code></pre></div>
<pre><code>## # A tibble: 53,940 x 11
##    carat cut   color clarity depth table price     x     y     z
##    &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 0.23  Ideal E     SI2      61.5    55   326  3.95  3.98  2.43
##  2 0.21  Prem~ E     SI1      59.8    61   326  3.89  3.84  2.31
##  3 0.23  Good  E     VS1      56.9    65   327  4.05  4.07  2.31
##  4 0.290 Prem~ I     VS2      62.4    58   334  4.2   4.23  2.63
##  5 0.31  Good  J     SI2      63.3    58   335  4.34  4.35  2.75
##  6 0.24  Very~ J     VVS2     62.8    57   336  3.94  3.96  2.48
##  7 0.24  Very~ I     VVS1     62.3    57   336  3.95  3.98  2.47
##  8 0.26  Very~ H     SI1      61.9    55   337  4.07  4.11  2.53
##  9 0.22  Fair  E     VS2      65.1    61   337  3.87  3.78  2.49
## 10 0.23  Very~ H     VS1      59.4    61   338  4     4.05  2.39
## # ... with 53,930 more rows, and 1 more variable: surrogate_id &lt;int&gt;</code></pre></li>
<li><p><em>Draw a diagram illustrating the connections between the <code>Batting</code>,</em>
<em><code>Master</code>, and <code>Salaries</code> tables in the Lahman package. Draw another diagram</em>
<em>that shows the relationship between <code>Master</code>, <code>Managers</code>, <code>AwardsManagers</code>.</em></p>
<p>For each dataset show just the <code>head(1)</code></p>
<p>Combine by playerid</p>
<pre><code>##    playerID yearID stint teamID lgID G AB R H X2B X3B HR RBI SB CS BB SO
## 1 abercda01   1871     1    TRO   NA 1  4 0 0   0   0  0   0  0  0  0  0
##   IBB HBP SH SF GIDP
## 1  NA  NA NA NA   NA</code></pre>
<pre><code>##    playerID birthYear birthMonth birthDay birthCountry birthState
## 1 aardsda01      1981         12       27          USA         CO
##   birthCity deathYear deathMonth deathDay deathCountry deathState
## 1    Denver        NA         NA       NA         &lt;NA&gt;       &lt;NA&gt;
##   deathCity nameFirst nameLast   nameGiven weight height bats throws
## 1      &lt;NA&gt;     David  Aardsma David Allan    215     75    R      R
##        debut  finalGame  retroID   bbrefID deathDate  birthDate
## 1 2004-04-06 2015-08-23 aardd001 aardsda01      &lt;NA&gt; 1981-12-27</code></pre>
<p>Combine by playerID, yearID</p>
<pre><code>##    playerID yearID stint teamID lgID G AB R H X2B X3B HR RBI SB CS BB SO
## 1 abercda01   1871     1    TRO   NA 1  4 0 0   0   0  0   0  0  0  0  0
##   IBB HBP SH SF GIDP
## 1  NA  NA NA NA   NA</code></pre>
<pre><code>##   yearID teamID lgID  playerID salary
## 1   1985    ATL   NL barkele01 870000</code></pre>
<p>Combine by playerID</p>
<pre><code>##    playerID birthYear birthMonth birthDay birthCountry birthState
## 1 aardsda01      1981         12       27          USA         CO
##   birthCity deathYear deathMonth deathDay deathCountry deathState
## 1    Denver        NA         NA       NA         &lt;NA&gt;       &lt;NA&gt;
##   deathCity nameFirst nameLast   nameGiven weight height bats throws
## 1      &lt;NA&gt;     David  Aardsma David Allan    215     75    R      R
##        debut  finalGame  retroID   bbrefID deathDate  birthDate
## 1 2004-04-06 2015-08-23 aardd001 aardsda01      &lt;NA&gt; 1981-12-27</code></pre>
<pre><code>##   yearID teamID lgID  playerID salary
## 1   1985    ATL   NL barkele01 870000</code></pre>
<p>Connect by playerID</p>
<pre><code>##    playerID birthYear birthMonth birthDay birthCountry birthState
## 1 aardsda01      1981         12       27          USA         CO
##   birthCity deathYear deathMonth deathDay deathCountry deathState
## 1    Denver        NA         NA       NA         &lt;NA&gt;       &lt;NA&gt;
##   deathCity nameFirst nameLast   nameGiven weight height bats throws
## 1      &lt;NA&gt;     David  Aardsma David Allan    215     75    R      R
##        debut  finalGame  retroID   bbrefID deathDate  birthDate
## 1 2004-04-06 2015-08-23 aardd001 aardsda01      &lt;NA&gt; 1981-12-27</code></pre>
<pre><code>##    playerID yearID teamID lgID inseason  G  W  L rank plyrMgr
## 1 wrighha01   1871    BS1   NA        1 31 20 10    3       Y</code></pre>
<p>Connect by playerID</p>
<pre><code>##    playerID birthYear birthMonth birthDay birthCountry birthState
## 1 aardsda01      1981         12       27          USA         CO
##   birthCity deathYear deathMonth deathDay deathCountry deathState
## 1    Denver        NA         NA       NA         &lt;NA&gt;       &lt;NA&gt;
##   deathCity nameFirst nameLast   nameGiven weight height bats throws
## 1      &lt;NA&gt;     David  Aardsma David Allan    215     75    R      R
##        debut  finalGame  retroID   bbrefID deathDate  birthDate
## 1 2004-04-06 2015-08-23 aardd001 aardsda01      &lt;NA&gt; 1981-12-27</code></pre>
<pre><code>##    playerID                   awardID yearID lgID  tie notes
## 1 larusto01 BBWAA Manager of the Year   1983   AL &lt;NA&gt;    NA</code></pre>
<p><em>How would you characterise the relationship between the <code>Batting</code>,</em>
<em><code>Pitching</code>, and <code>Fielding</code> tables?</em></p>
<p>All connect by playerID, yearID, stint</p>
<pre><code>##    playerID yearID stint teamID lgID G AB R H X2B X3B HR RBI SB CS BB SO
## 1 abercda01   1871     1    TRO   NA 1  4 0 0   0   0  0   0  0  0  0  0
##   IBB HBP SH SF GIDP
## 1  NA  NA NA NA   NA</code></pre>
<pre><code>##    playerID yearID stint teamID lgID W L G GS CG SHO SV IPouts  H ER HR BB
## 1 bechtge01   1871     1    PH1   NA 1 2 3  3  2   0  0     78 43 23  0 11
##   SO BAOpp  ERA IBB WP HBP BK BFP GF  R SH SF GIDP
## 1  1    NA 7.96  NA NA  NA  0  NA NA 42 NA NA   NA</code></pre>
<pre><code>##    playerID yearID stint teamID lgID POS G GS InnOuts PO A E DP PB WP SB
## 1 abercda01   1871     1    TRO   NA  SS 1 NA      NA  1 3 2  0 NA NA NA
##   CS ZR
## 1 NA NA</code></pre></li>
</ol>
</div>
</div>
<div id="mutating-joins" class="section level2">
<h2>13.4 Mutating joins</h2>
<blockquote>
<p>The most commonly used join is the left join: you use this whenever you look up additional data from another table, because it preserves the original observations even when there isn’t a match.</p>
</blockquote>
<div id="section-38" class="section level3">
<h3>13.4.6</h3>
<ol style="list-style-type: decimal">
<li><p><em>Compute the average delay by destination, then join on the <code>airports</code></em>
<em>data frame so you can show the spatial distribution of delays. Here’s an</em>
<em>easy way to draw a map of the United States:</em></p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb571-1" title="1">airports <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb571-2" title="2"><span class="st">  </span><span class="kw">semi_join</span>(flights, <span class="kw">c</span>(<span class="st">&quot;faa&quot;</span> =<span class="st"> &quot;dest&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb571-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lon, lat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb571-4" title="4"><span class="st">  </span><span class="kw">borders</span>(<span class="st">&quot;state&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb571-5" title="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb571-6" title="6"><span class="st">  </span><span class="kw">coord_quickmap</span>()</a></code></pre></div>
<p>Now adding in colour by average delay.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb572-1" title="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb572-2" title="2"><span class="st">  </span><span class="kw">semi_join</span>(airports, <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb572-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb572-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb572-5" title="5"><span class="st">  </span><span class="kw">left_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span>=<span class="st">&quot;faa&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb572-6" title="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lon, lat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb572-7" title="7"><span class="st">  </span><span class="kw">borders</span>(<span class="st">&quot;state&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb572-8" title="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb572-9" title="9"><span class="st">  </span><span class="kw">coord_quickmap</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb572-10" title="10"><span class="st">  </span><span class="kw">scale_color_gradientn</span>(<span class="dt">colours =</span> <span class="kw">rainbow</span>(<span class="dv">3</span>))</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p></li>
<li><p><em>Add the location of the origin <em>and</em> destination (i.e. the <code>lat</code> and <code>lon</code>)</em>
<em>to <code>flights</code>.</em></p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb573-1" title="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb573-2" title="2"><span class="st">  </span><span class="kw">left_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb573-3" title="3"><span class="st">  </span><span class="kw">left_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span> =<span class="st"> &quot;faa&quot;</span>), <span class="dt">suffix=</span><span class="kw">c</span>(<span class="st">&quot;_dest&quot;</span>, <span class="st">&quot;_origin&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb573-4" title="4"><span class="st">  </span><span class="kw">select</span>(flight, carrier, dest, lat_dest, lon_dest, origin, lat_origin, lon_origin)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 8
##    flight carrier dest  lat_dest lon_dest origin lat_origin lon_origin
##     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
##  1   1545 UA      IAH       30.0    -95.3 EWR          40.7      -74.2
##  2   1714 UA      IAH       30.0    -95.3 LGA          40.8      -73.9
##  3   1141 AA      MIA       25.8    -80.3 JFK          40.6      -73.8
##  4    725 B6      BQN       NA       NA   JFK          40.6      -73.8
##  5    461 DL      ATL       33.6    -84.4 LGA          40.8      -73.9
##  6   1696 UA      ORD       42.0    -87.9 EWR          40.7      -74.2
##  7    507 B6      FLL       26.1    -80.2 EWR          40.7      -74.2
##  8   5708 EV      IAD       38.9    -77.5 LGA          40.8      -73.9
##  9     79 B6      MCO       28.4    -81.3 JFK          40.6      -73.8
## 10    301 AA      ORD       42.0    -87.9 LGA          40.8      -73.9
## # ... with 336,766 more rows</code></pre>
<p>Note that the suffix allows you to tag names onto first and second table, hence why vector is length 2</p></li>
<li><p><em>Is there a relationship between the age of a plane and its delays?</em></p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb575-1" title="1"><span class="kw">group_by</span>(flights, tailnum) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb575-2" title="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm=</span><span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb575-3" title="3">            <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb575-4" title="4"><span class="st">  </span><span class="kw">left_join</span>(planes, <span class="dt">by=</span><span class="st">&quot;tailnum&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb575-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> <span class="dv">2013</span> <span class="op">-</span><span class="st"> </span>year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb575-6" title="6"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>, age <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb575-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> avg_delay))<span class="op">+</span></a>
<a class="sourceLine" id="cb575-8" title="8"><span class="st">  </span>ggbeeswarm<span class="op">::</span><span class="kw">geom_quasirandom</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb575-9" title="9"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Looks as though planes that are roughly 5 to 10 years old have higher delays… Let’s look at same thing using boxplots.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb576-1" title="1"><span class="kw">group_by</span>(flights, tailnum) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb576-2" title="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm=</span><span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb576-3" title="3">            <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb576-4" title="4"><span class="st">  </span><span class="kw">left_join</span>(planes, <span class="dt">by=</span><span class="st">&quot;tailnum&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb576-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> <span class="dv">2013</span> <span class="op">-</span><span class="st"> </span>year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb576-6" title="6"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>, age <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>, age <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb576-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb576-8" title="8"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">cut_width</span>(age, <span class="dv">2</span>, <span class="dt">boundary =</span> <span class="dv">0</span>), <span class="dt">y =</span> avg_delay))<span class="op">+</span></a>
<a class="sourceLine" id="cb576-9" title="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Perhaps there is not an overall trend association between age and delays, though it seems that the particular group of planes in that time range seem to have delays than either newer or older planes. On the other hand, there does almost look to be a seasonality pattern – though this may just be me seeing things… perhaps worth exploring more…</p>
<p>A simple way to test for a non-linear relationship would be to discretize age and then pass it through an anova</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb577-1" title="1">nycflights13<span class="op">::</span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb577-2" title="2"><span class="st">  </span><span class="kw">select</span>(arr_delay, tailnum) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb577-3" title="3"><span class="st">  </span><span class="kw">left_join</span>(planes, <span class="dt">by=</span><span class="st">&quot;tailnum&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb577-4" title="4"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb577-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> <span class="dv">2013</span> <span class="op">-</span><span class="st"> </span>year,</a>
<a class="sourceLine" id="cb577-6" title="6">         <span class="dt">age_round_5 =</span> (<span class="dv">5</span> <span class="op">*</span><span class="st"> </span>age <span class="op">%/%</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.factor</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb577-7" title="7"><span class="st">  </span><span class="kw">with</span>(<span class="kw">aov</span>(arr_delay <span class="op">~</span><span class="st"> </span>age_round_<span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb577-8" title="8"><span class="st">  </span><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>##                 Df    Sum Sq Mean Sq F value Pr(&gt;F)    
## age_round_5     11   1062080   96553   47.92 &lt;2e-16 ***
## Residuals   273841 551756442    2015                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 53493 observations deleted due to missingness</code></pre>
<ul>
<li>There are weaknesses to using anova, but according to this test arrival delay does not appear to be randomly distributed across age</li>
<li>The reason for such a difference may be trivial or may be confounded by a more interesting pattern… but these are deeper questions</li>
</ul></li>
<li><p><em>What weather conditions make it more likely to see a delay?</em></p>
<p>There are a lot of ways you could have approached this problem. Below, I look at the average weather value for each of the groups <code>FALSE</code>, <code>TRUE</code> and <code>Canceled</code> – <code>FALSE</code> corresponding with non-delayed flights, <code>TRUE</code> with delayed flights and <code>Canceled</code> with flights that were canceled. If I were feeling fancy, I would have also added the standard errors on these…</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb579-1" title="1">flights_weath &lt;-<span class="st"> </span><span class="kw">mutate</span>(flights, <span class="dt">delay_TF =</span> dep_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb579-2" title="2"><span class="st">  </span><span class="kw">separate</span>(sched_dep_time, </a>
<a class="sourceLine" id="cb579-3" title="3">           <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;hour_sched&quot;</span>, <span class="st">&quot;min_sched&quot;</span>), </a>
<a class="sourceLine" id="cb579-4" title="4">           <span class="dt">sep =</span> <span class="dv">-3</span>,</a>
<a class="sourceLine" id="cb579-5" title="5">           <span class="dt">remove =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb579-6" title="6">           <span class="dt">convert =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb579-7" title="7"><span class="st">  </span><span class="kw">left_join</span>(weather, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span>, <span class="st">&quot;year&quot;</span>,<span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;hour_sched&quot;</span>=<span class="st">&quot;hour&quot;</span>))</a>
<a class="sourceLine" id="cb579-8" title="8"></a>
<a class="sourceLine" id="cb579-9" title="9">flights_weath_gath &lt;-<span class="st"> </span>flights_weath <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb579-10" title="10"><span class="st">  </span><span class="kw">select</span>(sched_dep_time, delay_TF, sched_dep_time, temp<span class="op">:</span>visib) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb579-11" title="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb579-12" title="12"><span class="st">  </span><span class="kw">gather</span>(temp, dewp, humid, wind_dir, wind_speed, wind_gust, precip, pressure, visib, </a>
<a class="sourceLine" id="cb579-13" title="13">       <span class="dt">key=</span><span class="st">&quot;weather&quot;</span>, <span class="dt">value=</span><span class="st">&quot;values&quot;</span>) </a>
<a class="sourceLine" id="cb579-14" title="14"></a>
<a class="sourceLine" id="cb579-15" title="15">flights_summarized &lt;-<span class="st"> </span>flights_weath_gath <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb579-16" title="16"><span class="st">  </span><span class="kw">group_by</span>(weather, delay_TF) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb579-17" title="17"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">median_weath =</span> <span class="kw">median</span>(values, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb579-18" title="18">            <span class="dt">mean_weath =</span> <span class="kw">mean</span>(values, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb579-19" title="19">            <span class="dt">sum_n =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(values))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb579-20" title="20"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb579-21" title="21"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delay_TF =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(delay_TF), <span class="st">&quot;Canceled&quot;</span>, delay_TF),</a>
<a class="sourceLine" id="cb579-22" title="22">         <span class="dt">delay_TF =</span> forcats<span class="op">::</span><span class="kw">as_factor</span>(delay_TF, <span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="st">&quot;Canceled&quot;</span>)))</a>
<a class="sourceLine" id="cb579-23" title="23"></a>
<a class="sourceLine" id="cb579-24" title="24">flights_summarized <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb579-25" title="25"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> delay_TF, <span class="dt">y =</span> mean_weath, <span class="dt">fill =</span> delay_TF))<span class="op">+</span></a>
<a class="sourceLine" id="cb579-26" title="26"><span class="st">  </span><span class="kw">geom_col</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb579-27" title="27"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>weather, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb579-28" title="28"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>While precipitation is the largest difference, my guess is that the standard error on this would be much greater day to day because as you can see the values are very low, so it could be that a few cases with a lot of rain may tick it up, but it may be tough to actually use this as a predictor…</p></li>
<li><p><em>What happened on June 13 2013? Display the spatial pattern of delays,</em>
<em>and then use Google to cross-reference with the weather.</em></p>
<p>Looks like East coast is getting hammered and flights arriving from Atlanta an similar locations were very delayed. Guessing either weather issue, or problem in Atl or delta.</p></li>
</ol>
</div>
</div>
<div id="filtering-joins" class="section level2">
<h2>13.5 Filtering joins</h2>
<div id="section-39" class="section level3">
<h3>13.5.1</h3>
<ol style="list-style-type: decimal">
<li><p><em>What does it mean for a flight to have a missing <code>tailnum</code>?</em></p>
<p>All flights with a missing tailnum in the <code>flights</code> table were cancelled as you can see below.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb580-1" title="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb580-2" title="2"><span class="st">  </span><span class="kw">count</span>(<span class="kw">is.na</span>(tailnum), <span class="kw">is.na</span>(arr_delay))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   `is.na(tailnum)` `is.na(arr_delay)`      n
##   &lt;lgl&gt;            &lt;lgl&gt;               &lt;int&gt;
## 1 FALSE            FALSE              327346
## 2 FALSE            TRUE                 6918
## 3 TRUE             TRUE                 2512</code></pre>
<p><em>What do the tail numbers that don’t have a matching record in <code>planes</code> have in common?</em>
<em>(Hint: one variable explains ~90% of the problems.)</em></p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb582-1" title="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb582-2" title="2"><span class="st">  </span><span class="kw">anti_join</span>(planes, <span class="dt">by=</span><span class="st">&quot;tailnum&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb582-3" title="3"><span class="st">  </span><span class="kw">count</span>(carrier, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    carrier     n
##    &lt;chr&gt;   &lt;int&gt;
##  1 MQ      25397
##  2 AA      22558
##  3 UA       1693
##  4 9E       1044
##  5 B6        830
##  6 US        699
##  7 FL        187
##  8 DL        110
##  9 F9         50
## 10 WN         38</code></pre>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb584-1" title="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb584-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">in_planes =</span> tailnum <span class="op">%in%</span><span class="st"> </span>planes<span class="op">$</span>tailnum) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb584-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb584-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">flights_inPlanes =</span> <span class="kw">sum</span>(in_planes),</a>
<a class="sourceLine" id="cb584-5" title="5">            <span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb584-6" title="6">            <span class="dt">perc_inPlanes =</span> flights_inPlanes <span class="op">/</span><span class="st"> </span>n) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb584-7" title="7"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<pre><code>## # A tibble: 16 x 4
##    carrier flights_inPlanes     n perc_inPlanes
##    &lt;chr&gt;              &lt;int&gt; &lt;int&gt;         &lt;dbl&gt;
##  1 9E                 17416 18460        0.943 
##  2 AA                 10171 32729        0.311 
##  3 AS                   714   714        1     
##  4 B6                 53805 54635        0.985 
##  5 DL                 48000 48110        0.998 
##  6 EV                 54173 54173        1     
##  7 F9                   635   685        0.927 
##  8 FL                  3073  3260        0.943 
##  9 HA                   342   342        1     
## 10 MQ                  1000 26397        0.0379
## 11 OO                    32    32        1     
## 12 UA                 56972 58665        0.971 
## 13 US                 19837 20536        0.966 
## 14 VX                  5162  5162        1     
## 15 WN                 12237 12275        0.997 
## 16 YV                   601   601        1</code></pre>
<p>Some carriers do not have many of their tailnums data in the <code>planes</code> table. Anyone have more insight here?</p></li>
<li><p><em>Filter flights to only show flights with planes that have flown at least 100</em>
<em>flights.</em></p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb586-1" title="1">planes_many &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb586-2" title="2"><span class="st">  </span><span class="kw">count</span>(tailnum, <span class="dt">sort=</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb586-3" title="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb586-4" title="4"></a>
<a class="sourceLine" id="cb586-5" title="5"><span class="kw">semi_join</span>(flights, planes_many)</a></code></pre></div>
<pre><code>## # A tibble: 229,202 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      544            545        -1     1004
##  4  2013     1     1      554            558        -4      740
##  5  2013     1     1      555            600        -5      913
##  6  2013     1     1      557            600        -3      709
##  7  2013     1     1      557            600        -3      838
##  8  2013     1     1      558            600        -2      849
##  9  2013     1     1      558            600        -2      853
## 10  2013     1     1      558            600        -2      923
## # ... with 229,192 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre></li>
<li><p><em>Combine <code>fueleconomy::vehicles</code> and <code>fueleconomy::common</code> to find only the</em>
<em>records for the most common models.</em></p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb588-1" title="1">fueleconomy<span class="op">::</span>vehicles <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb588-2" title="2"><span class="st">  </span><span class="kw">semi_join</span>(fueleconomy<span class="op">::</span>common, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;make&quot;</span>, <span class="st">&quot;model&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 14,531 x 12
##       id make  model   year class trans drive   cyl displ fuel    hwy   cty
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;
##  1  1833 Acura Integ~  1986 Subc~ Auto~ Fron~     4   1.6 Regu~    28    22
##  2  1834 Acura Integ~  1986 Subc~ Manu~ Fron~     4   1.6 Regu~    28    23
##  3  3037 Acura Integ~  1987 Subc~ Auto~ Fron~     4   1.6 Regu~    28    22
##  4  3038 Acura Integ~  1987 Subc~ Manu~ Fron~     4   1.6 Regu~    28    23
##  5  4183 Acura Integ~  1988 Subc~ Auto~ Fron~     4   1.6 Regu~    27    22
##  6  4184 Acura Integ~  1988 Subc~ Manu~ Fron~     4   1.6 Regu~    28    23
##  7  5303 Acura Integ~  1989 Subc~ Auto~ Fron~     4   1.6 Regu~    27    22
##  8  5304 Acura Integ~  1989 Subc~ Manu~ Fron~     4   1.6 Regu~    28    23
##  9  6442 Acura Integ~  1990 Subc~ Auto~ Fron~     4   1.8 Regu~    24    20
## 10  6443 Acura Integ~  1990 Subc~ Manu~ Fron~     4   1.8 Regu~    26    21
## # ... with 14,521 more rows</code></pre></li>
<li><p><em>Find the 48 hours (over the course of the whole year) that have the worst</em>
<em>delays. Cross-reference it with the <code>weather</code> data. Can you see any</em>
<em>patterns?</em></p>
<p>First: Create two variables that together capture all 48 hour time windows across the year, at the day window of granularity (e.g. the time of day the flight takes off does not matter in establishing time windows for this example, only the day).
Second: Gather these time windows into a single dataframe (note that this will increase the length of your data by ~364/365 * 100 %)
Third: Group by <code>window_start_date</code> and calculate average <code>arr_delay</code> and related metrics.</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb590-1" title="1">delays_windows &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb590-2" title="2"><span class="st">  </span><span class="co">#First</span></a>
<a class="sourceLine" id="cb590-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_flight =</span> lubridate<span class="op">::</span><span class="kw">as_date</span>(time_hour)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb590-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">startdate_window1 =</span> <span class="kw">cut.Date</span>(date_flight, <span class="st">&quot;2 day&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb590-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_flight2 =</span> <span class="kw">ifelse</span>(<span class="op">!</span>(date_flight <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(date_flight, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)), date_flight, <span class="ot">NA</span>),</a>
<a class="sourceLine" id="cb590-6" title="6">         <span class="dt">date_flight2 =</span> lubridate<span class="op">::</span><span class="kw">as_date</span>(date_flight2),</a>
<a class="sourceLine" id="cb590-7" title="7">         <span class="dt">startdate_window2 =</span> <span class="kw">cut.Date</span>(date_flight2, <span class="st">&quot;2 day&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb590-8" title="8"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>date_flight, <span class="op">-</span>date_flight2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb590-9" title="9"><span class="st">  </span><span class="co">#Second</span></a>
<a class="sourceLine" id="cb590-10" title="10"><span class="st">  </span><span class="kw">gather</span>(startdate_window1, startdate_window2, <span class="dt">key =</span> <span class="st">&quot;start_window&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;window_start_date&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb590-11" title="11"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(window_start_date)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb590-12" title="12"><span class="st">  </span><span class="co">#Third</span></a>
<a class="sourceLine" id="cb590-13" title="13"><span class="st">  </span><span class="kw">group_by</span>(window_start_date) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb590-14" title="14"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">num =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb590-15" title="15">            <span class="dt">perc_cancelled =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(arr_delay)) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb590-16" title="16">            <span class="dt">mean_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb590-17" title="17">            <span class="dt">perc_delay =</span> <span class="kw">mean</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb590-18" title="18">            <span class="dt">total_delay_mins =</span> <span class="kw">sum</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb590-19" title="19"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb592-1" title="1"><span class="co">#don&#39;t worry about warning of &#39;attributes are not identical...&#39;, that is</span></a>
<a class="sourceLine" id="cb592-2" title="2"><span class="co">#because the cut function assigns attributes to the value, it&#39;s fine if</span></a>
<a class="sourceLine" id="cb592-3" title="3"><span class="co">#these are dropped here.</span></a></code></pre></div>
<p>Create tibble of worst 2-day period for mean <code>arr_delay</code></p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb593-1" title="1">WorstWindow &lt;-<span class="st"> </span>delays_windows <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb593-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean_delay_rank =</span> dplyr<span class="op">::</span><span class="kw">min_rank</span>(<span class="op">-</span>mean_delay)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb593-3" title="3"><span class="st">  </span><span class="kw">filter</span>(mean_delay_rank <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb593-4" title="4"></a>
<a class="sourceLine" id="cb593-5" title="5">WorstDates &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">dates =</span> <span class="kw">c</span>(lubridate<span class="op">::</span><span class="kw">as_date</span>(WorstWindow<span class="op">$</span>window_start_date), lubridate<span class="op">::</span><span class="kw">as_date</span>(WorstWindow<span class="op">$</span>window_start_date) <span class="op">+</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw">duration</span>(<span class="dv">1</span>, <span class="st">&quot;days&quot;</span>)))</a></code></pre></div>
<p>Ammend weather data so that weather is an average across three NY locations rather than seperate for each<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a></p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb594-1" title="1">weather_ammended &lt;-<span class="st"> </span>weather <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb594-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time_hour =</span> lubridate<span class="op">::</span><span class="kw">make_datetime</span>(year, month, day, hour)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb594-3" title="3"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">one_of</span>(<span class="st">&quot;origin&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;hour&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb594-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(time_hour) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb594-5" title="5"><span class="st">  </span><span class="kw">summarise_all</span>(mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb594-6" title="6"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<p>Filtering join to just times weather for worst 2 days</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb595-1" title="1">weather_worst &lt;-<span class="st"> </span>weather_ammended <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb595-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dates =</span> <span class="kw">as_date</span>(time_hour)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb595-3" title="3"><span class="st">  </span><span class="kw">semi_join</span>(WorstDates)</a></code></pre></div>
<p>Plot of hourly weather values across 48 hour time windows.</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb596-1" title="1">weather_worst <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb596-2" title="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>dates) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb596-3" title="3"><span class="st">  </span><span class="kw">gather</span>(temp<span class="op">:</span>visib, <span class="dt">key =</span> <span class="st">&quot;weather_type&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;weather_value&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb596-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> weather_value))<span class="op">+</span></a>
<a class="sourceLine" id="cb596-5" title="5"><span class="st">  </span><span class="kw">geom_line</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb596-6" title="6"><span class="st">  </span><span class="kw">facet_grid</span>(weather_type <span class="op">~</span><span class="st"> </span>., <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb596-7" title="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Hourly weather values across worst 48 hours of delays&#39;</span>)</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Patterns:</p>
<ul>
<li><code>wind_gust</code> and <code>wind_speed</code> are the same.</li>
<li>See high level of colinearity in spikes and changes, e.g. increase in <code>precip</code> corresponds with decrease in <code>visib</code> and perhaps uptick in <code>wind_spee</code></li>
</ul>
<p>Perhaps, we want to view how the average hourly weather values compare on the worst days to average weather days. Create summary of average hourly weather values for worst 48 hour period, for average period, and then append these and plot.</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb597-1" title="1"><span class="kw">bind_rows</span>(  </a>
<a class="sourceLine" id="cb597-2" title="2">weather_worst <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb597-3" title="3"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(temp<span class="op">:</span>visib), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb597-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">category =</span> <span class="st">&quot;weather on worst 48&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb597-5" title="5"><span class="st">  </span><span class="kw">gather</span>(temp<span class="op">:</span>visib, <span class="dt">key =</span> weather_type, <span class="dt">value =</span> weather_val)</a>
<a class="sourceLine" id="cb597-6" title="6">,</a>
<a class="sourceLine" id="cb597-7" title="7">weather_ammended <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb597-8" title="8"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(temp<span class="op">:</span>visib), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb597-9" title="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">category =</span> <span class="st">&quot;weather on average&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb597-10" title="10"><span class="st">  </span><span class="kw">gather</span>(temp<span class="op">:</span>visib, <span class="dt">key =</span> weather_type, <span class="dt">value =</span> weather_val)</a>
<a class="sourceLine" id="cb597-11" title="11">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb597-12" title="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> category, <span class="dt">y =</span> weather_val, <span class="dt">fill =</span> category))<span class="op">+</span></a>
<a class="sourceLine" id="cb597-13" title="13"><span class="st">  </span><span class="kw">geom_col</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb597-14" title="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>weather_type, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb597-15" title="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Hourly average weather values on worst 48 hour window of delays vs. hourly average weather across year&quot;</span>, </a>
<a class="sourceLine" id="cb597-16" title="16">       <span class="dt">caption =</span> <span class="st">&quot;Note that delays are based on mean(arr_delay, na.rm = TRUE)&quot;</span>)</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>For this to be the worst 48 hour period, the weather doesn’t actually seem to be as extreme as I would have guessed.</p>
<p>Let’s add-in average <code>arr_delay</code> by planned departure time to this to see how the delay times throughout the day varied, to see if there was a surge or change in weather that led to the huge change in delays.</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb598-1" title="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dates =</span> <span class="kw">as_date</span>(time_hour)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-3" title="3"><span class="st">  </span><span class="kw">semi_join</span>(WorstDates) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(time_hour) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-5" title="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">value =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-6" title="6"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_type =</span> <span class="st">&quot;Mean_ArrDelay&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-8" title="8"><span class="st">  </span><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb598-9" title="9">  weather_worst <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-10" title="10"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>dates) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-11" title="11"><span class="st">    </span><span class="kw">gather</span>(temp<span class="op">:</span>visib, <span class="dt">key =</span> <span class="st">&quot;value_type&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>)</a>
<a class="sourceLine" id="cb598-12" title="12">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-13" title="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weather_attr =</span> <span class="op">!</span>(value_type <span class="op">==</span><span class="st"> &quot;Mean_ArrDelay&quot;</span>),</a>
<a class="sourceLine" id="cb598-14" title="14">         <span class="dt">value_type =</span> forcats<span class="op">::</span><span class="kw">fct_relevel</span>(value_type, <span class="st">&quot;Mean_ArrDelay&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-15" title="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time_hour, value, <span class="dt">colour =</span> weather_attr))<span class="op">+</span></a>
<a class="sourceLine" id="cb598-16" title="16"><span class="st">  </span><span class="kw">geom_line</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb598-17" title="17"><span class="st">  </span><span class="kw">facet_grid</span>(value_type <span class="op">~</span><span class="st"> </span>., <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb598-18" title="18"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Hourly weather and delay values across worst 48 hours of delays&#39;</span>)</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>Maybe that first uptick in precipitation corresponded with the increase in delay… but still, looks extreme like an incident caused this. I cheched the news and it looks like a plane was crash landed onto the tarmac at one of the airports on this day <a href="https://en.wikipedia.org/wiki/Southwest_Airlines_Flight_345#cite_note-DMN_Aircraft_Totaled_20160808-4" class="uri">https://en.wikipedia.org/wiki/Southwest_Airlines_Flight_345#cite_note-DMN_Aircraft_Totaled_20160808-4</a> , I checked the incident time and it occurred at 17:45 Jul 22, looks like it overlaps with the time we see the uptick in delays.</p>
<p>I show plots and models of 48 hour time windows in a variety of other contexts and detail in <a href="25-many-models.html#appendix-11">Appendix</a></p></li>
<li><p><em>What does <code>anti_join(flights, airports, by = c("dest" = "faa"))</code> tell you?</em>
<em>What does <code>anti_join(airports, flights, by = c("faa" = "dest"))</code> tell you?</em></p>
<p><code>anti_join(flights, airports, by = c("dest" = "faa"))</code> –tells me the flight dests missing an airport
<code>anti_join(airports, flights, by = c("faa" = "dest"))</code> – tells me the airports with no flights coming to them</p></li>
<li><p><em>You might expect that there’s an implicit relationship between plane</em>
<em>and airline, because each plane is flown by a single airline. Confirm</em>
<em>or reject this hypothesis using the tools you’ve learned above.</em></p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb599-1" title="1">tail_carr &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb599-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tailnum)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb599-3" title="3"><span class="st">  </span><span class="kw">distinct</span>(carrier, tailnum) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb599-4" title="4"><span class="st">  </span><span class="kw">count</span>(tailnum, <span class="dt">sort=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb599-5" title="5"></a>
<a class="sourceLine" id="cb599-6" title="6">tail_carr <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb599-7" title="7"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 17 x 2
##    tailnum     n
##    &lt;chr&gt;   &lt;int&gt;
##  1 N146PQ      2
##  2 N153PQ      2
##  3 N176PQ      2
##  4 N181PQ      2
##  5 N197PQ      2
##  6 N200PQ      2
##  7 N228PQ      2
##  8 N232PQ      2
##  9 N933AT      2
## 10 N935AT      2
## 11 N977AT      2
## 12 N978AT      2
## 13 N979AT      2
## 14 N981AT      2
## 15 N989AT      2
## 16 N990AT      2
## 17 N994AT      2</code></pre>
<p>You should reject that hypothesis, you can see that 17 <code>tailnum</code>s are duplicated on multiple carriers.</p>
<p>Below is code to show those 17 tailnums</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb601-1" title="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-2" title="2"><span class="st">  </span><span class="kw">distinct</span>(carrier, tailnum) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-3" title="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tailnum)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n_tail =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb601-6" title="6"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-7" title="7"><span class="st">  </span><span class="kw">filter</span>(n_tail <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-8" title="8"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n_tail), tailnum)</a></code></pre></div>
<pre><code>## # A tibble: 34 x 3
##    carrier tailnum n_tail
##    &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt;
##  1 9E      N146PQ       2
##  2 EV      N146PQ       2
##  3 9E      N153PQ       2
##  4 EV      N153PQ       2
##  5 9E      N176PQ       2
##  6 EV      N176PQ       2
##  7 9E      N181PQ       2
##  8 EV      N181PQ       2
##  9 9E      N197PQ       2
## 10 EV      N197PQ       2
## # ... with 24 more rows</code></pre></li>
</ol>
</div>
</div>
<div id="appendix-3" class="section level2">
<h2>Appendix</h2>
<div id="section-40" class="section level3">
<h3>13.5.1.4</h3>
<p>Graph all of these metrics at once using roughly the same method as used on 13.4.6 #4.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" title="1">delays_windows <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb603-2" title="2"><span class="st">  </span><span class="kw">gather</span>(perc_cancelled, mean_delay, perc_delay, <span class="dt">key =</span> value_type, <span class="dt">value =</span> val) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb603-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">window_start_date =</span> lubridate<span class="op">::</span><span class="kw">as_date</span>(window_start_date)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb603-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(window_start_date, val))<span class="op">+</span></a>
<a class="sourceLine" id="cb603-5" title="5"><span class="st">  </span><span class="kw">geom_line</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb603-6" title="6"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>value_type, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb603-7" title="7"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_labels =</span> <span class="st">&quot;%b %d&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb603-8" title="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Measures of delay across 48 hour time windows&#39;</span>)</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>Create 48 hour windows for weather data. Follow exact same steps as above.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb604-1" title="1">weather_windows &lt;-<span class="st"> </span>weather_ammended <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb604-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_flight =</span> lubridate<span class="op">::</span><span class="kw">as_date</span>(time_hour)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb604-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">startdate_window1 =</span> <span class="kw">cut.Date</span>(date_flight, <span class="st">&quot;2 day&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb604-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_flight2 =</span> <span class="kw">ifelse</span>(<span class="op">!</span>(date_flight <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(date_flight, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)), date_flight, <span class="ot">NA</span>),</a>
<a class="sourceLine" id="cb604-5" title="5">         <span class="dt">date_flight2 =</span> lubridate<span class="op">::</span><span class="kw">as_date</span>(date_flight2),</a>
<a class="sourceLine" id="cb604-6" title="6">         <span class="dt">startdate_window2 =</span> <span class="kw">cut.Date</span>(date_flight2, <span class="st">&quot;2 day&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb604-7" title="7"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>date_flight, <span class="op">-</span>date_flight2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb604-8" title="8"><span class="st">    </span><span class="co">#Second</span></a>
<a class="sourceLine" id="cb604-9" title="9"><span class="st">  </span><span class="kw">gather</span>(startdate_window1, startdate_window2, <span class="dt">key =</span> <span class="st">&quot;start_window&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;window_start_date&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb604-10" title="10"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(window_start_date)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb604-11" title="11"><span class="st">  </span><span class="co">#Third</span></a>
<a class="sourceLine" id="cb604-12" title="12"><span class="st">  </span><span class="kw">group_by</span>(window_start_date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb604-13" title="13"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(temp<span class="op">:</span>visib), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb604-14" title="14"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb604-15" title="15"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>wind_gust)</a></code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<p>Graph using same method as above…</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb606-1" title="1">weather_windows <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb606-2" title="2"><span class="st">  </span><span class="kw">gather</span>(temp<span class="op">:</span>visib, <span class="dt">key =</span> weather_type, <span class="dt">value =</span> val) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb606-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">window_start_date =</span> lubridate<span class="op">::</span><span class="kw">as_date</span>(window_start_date)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb606-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> window_start_date, <span class="dt">y =</span> val))<span class="op">+</span></a>
<a class="sourceLine" id="cb606-5" title="5"><span class="st">  </span><span class="kw">geom_line</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb606-6" title="6"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>weather_type, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb606-7" title="7"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_labels =</span> <span class="st">&quot;%b %d&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb606-8" title="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Measures of weather across 48 hour time windows&#39;</span>)</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Connect delays and weather data</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" title="1">weather_delay_joined &lt;-<span class="st"> </span><span class="kw">left_join</span>(delays_windows, weather_windows, <span class="dt">by =</span> <span class="st">&quot;window_start_date&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb607-2" title="2"><span class="st">  </span><span class="kw">select</span>(mean_delay, temp<span class="op">:</span>visib, window_start_date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb607-3" title="3"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>dewp) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">#is almost completely correlated with temp so removed one of them...</span></a>
<a class="sourceLine" id="cb607-4" title="4"><span class="st">  </span><span class="kw">na.omit</span>()</a></code></pre></div>
<p>Plot of 48 hour window of weather scores against mean delay keeping intact order of observations</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb608-1" title="1">weather_delay_joined <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb608-2" title="2"><span class="st">  </span><span class="kw">gather</span>(mean_delay, temp<span class="op">:</span>visib, <span class="dt">key =</span> value_type, <span class="dt">value =</span> val) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb608-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">window_start_date =</span> lubridate<span class="op">::</span><span class="kw">as_date</span>(window_start_date),</a>
<a class="sourceLine" id="cb608-4" title="4">         <span class="dt">value_type =</span> forcats<span class="op">::</span><span class="kw">fct_relevel</span>(value_type, <span class="st">&quot;mean_delay&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb608-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> window_start_date, <span class="dt">y =</span> val, <span class="dt">colour =</span> <span class="op">!</span><span class="st"> </span>value_type <span class="op">==</span><span class="st"> &quot;mean_delay&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb608-6" title="6"><span class="st">  </span><span class="kw">geom_line</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb608-7" title="7"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>value_type, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb608-8" title="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;Weather value&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Mean delay and weather value in 2-day rolling window&quot;</span>)</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>Plot of mean_delay against weather type, each point representing a different ‘window’</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb609-1" title="1">weather_delay_joined <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb609-2" title="2"><span class="st">  </span><span class="kw">gather</span>(temp<span class="op">:</span>visib, <span class="dt">key =</span> weather_type, <span class="dt">value =</span> weather_val) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb609-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weather_val, <span class="dt">y =</span> mean_delay))<span class="op">+</span></a>
<a class="sourceLine" id="cb609-4" title="4"><span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb609-5" title="5"><span class="st">  </span><span class="kw">geom_smooth</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb609-6" title="6"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>weather_type, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>)</a></code></pre></div>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>In a sense, these plots are not really valid as they obscure the fact that each point is not an independent observation (because there is a high level of association with w/e the value was on a single day with what it was in the previous day). E.g. mean_delay has a correlation of ~ 0.68 with prior days value as shown below… This is often ignored and we can also ignore it for now as it gets into time series and things we don’t need to worry about for now… but somthing to be aware…</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb610-1" title="1">weather_delay_joined <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb610-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean_delay_lag =</span> <span class="kw">lag</span>(mean_delay)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb610-3" title="3"><span class="st">  </span><span class="kw">select</span>(mean_delay, mean_delay_lag) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb610-4" title="4"><span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb610-5" title="5"><span class="st">  </span><span class="kw">cor</span>()</a></code></pre></div>
<pre><code>##                mean_delay mean_delay_lag
## mean_delay      1.0000000      0.6795631
## mean_delay_lag  0.6795631      1.0000000</code></pre>
<p>Data is not Independent (as mentioned above) and many problems associated with this… but let’s ignore this for now and just look at a few statisitics…</p>
<p>Can see below that raw correlation of <code>mean_delay</code> is highest with humid.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb612-1" title="1">weather_delay_joined <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb612-2" title="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>window_start_date) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb612-3" title="3"><span class="st">  </span><span class="kw">cor</span>()</a></code></pre></div>
<pre><code>##             mean_delay        temp      humid    wind_dir  wind_speed
## mean_delay  1.00000000  0.08515338  0.4549140 -0.05371522  0.16262585
## temp        0.08515338  1.00000000  0.3036520 -0.25906906 -0.40160692
## humid       0.45491403  0.30365205  1.0000000 -0.51010505 -0.30383181
## wind_dir   -0.05371522 -0.25906906 -0.5101050  1.00000000  0.50039832
## wind_speed  0.16262585 -0.40160692 -0.3038318  0.50039832  1.00000000
## precip      0.36475598  0.02775525  0.4481898 -0.12853817  0.11176053
## pressure   -0.31716918 -0.23873857 -0.2363718 -0.26627495 -0.25716938
## visib      -0.38740156  0.12290097 -0.6647598  0.26307685  0.05275072
##                 precip   pressure       visib
## mean_delay  0.36475598 -0.3171692 -0.38740156
## temp        0.02775525 -0.2387386  0.12290097
## humid       0.44818978 -0.2363718 -0.66475984
## wind_dir   -0.12853817 -0.2662749  0.26307685
## wind_speed  0.11176053 -0.2571694  0.05275072
## precip      1.00000000 -0.2265636 -0.44400337
## pressure   -0.22656357  1.0000000  0.12032520
## visib      -0.44400337  0.1203252  1.00000000</code></pre>
<p>When accounting for other variables, see relationship with windspeed seems to emerge as important…</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb614-1" title="1">weather_delay_joined <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb614-2" title="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>window_start_date) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb614-3" title="3"><span class="st">  </span><span class="kw">lm</span>(mean_delay <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb614-4" title="4"><span class="st">  </span><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mean_delay ~ ., data = .)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -26.179  -7.581  -1.374   5.271  38.008 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 169.56872  132.07737   1.284   0.2000    
## temp          0.05460    0.04702   1.161   0.2464    
## humid         0.48158    0.09088   5.299 2.04e-07 ***
## wind_dir      0.01420    0.01376   1.032   0.3026    
## wind_speed    1.15641    0.25561   4.524 8.28e-06 ***
## precip      140.84141   78.84192   1.786   0.0749 .  
## pressure     -0.19722    0.12476  -1.581   0.1148    
## visib        -1.15009    0.80567  -1.427   0.1543    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.64 on 356 degrees of freedom
## Multiple R-squared:  0.3332, Adjusted R-squared:  0.3201 
## F-statistic: 25.42 on 7 and 356 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>For a variety of reasons, especially in cases where your observations are not independent, you may want to evaluate how the change in an attribute relates to the change in another attribute. In the cases below I plot the diffs for example:</p>
<p><em>(average value on 2013-02-07 to 2013-02-08) - (average value on 2013-02-08 to 2013-02-09)</em></p>
<p>Note that the time windows are not distinct but overlap by 24 hours.</p>
<p>If doing a thorough account of time-series you would do a lot more than I show below…</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb616-1" title="1">weather_delay_joined <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb616-2" title="2"><span class="st">  </span><span class="kw">gather</span>(mean_delay, temp<span class="op">:</span>visib, <span class="dt">key =</span> value_type, <span class="dt">value =</span> val) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb616-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">window_start_date =</span> lubridate<span class="op">::</span><span class="kw">as_date</span>(window_start_date),</a>
<a class="sourceLine" id="cb616-4" title="4">         <span class="dt">value_type =</span> forcats<span class="op">::</span><span class="kw">fct_relevel</span>(value_type, <span class="st">&quot;mean_delay&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb616-5" title="5"><span class="st">  </span><span class="kw">group_by</span>(value_type) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb616-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_diff =</span> val <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(val)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb616-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> window_start_date, <span class="dt">y =</span> value_diff, <span class="dt">colour =</span> <span class="op">!</span>value_type <span class="op">==</span><span class="st"> &quot;mean_delay&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb616-8" title="8"><span class="st">  </span><span class="kw">geom_line</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb616-9" title="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>value_type, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb616-10" title="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;Weather value&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Plot of diffs in value&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_path).</code></pre>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>Let’s plot these diffs as a scatter plot now (no longer looking at the order in which the observations emerged)</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb618-1" title="1">weather_delay_joined <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-2" title="2"><span class="st">  </span><span class="kw">gather</span>(temp<span class="op">:</span>visib, <span class="dt">key =</span> weather_type, <span class="dt">value =</span> val) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(weather_type) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weather_diff =</span> val <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(val),</a>
<a class="sourceLine" id="cb618-5" title="5">         <span class="dt">delay_diff =</span> mean_delay <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(mean_delay)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-6" title="6"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weather_diff, <span class="dt">y =</span> delay_diff))<span class="op">+</span></a>
<a class="sourceLine" id="cb618-8" title="8"><span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb618-9" title="9"><span class="st">  </span><span class="kw">geom_smooth</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb618-10" title="10"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>weather_type, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb618-11" title="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;scatter plot of diffs in value&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 7 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<p><img src="13-relational-data_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>Let’s look at the correlatioin and regression against these diffs</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb621-1" title="1">diff_data &lt;-<span class="st"> </span>weather_delay_joined <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb621-2" title="2"><span class="st">  </span><span class="kw">gather</span>(mean_delay, temp<span class="op">:</span>visib, <span class="dt">key =</span> value_type, <span class="dt">value =</span> val) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb621-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(value_type) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb621-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff =</span> val <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(val)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb621-5" title="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb621-6" title="6"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>val) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb621-7" title="7"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> value_type, <span class="dt">value =</span> diff)</a>
<a class="sourceLine" id="cb621-8" title="8"></a>
<a class="sourceLine" id="cb621-9" title="9">diff_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb621-10" title="10"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>window_start_date) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb621-11" title="11"><span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb621-12" title="12"><span class="st">  </span><span class="kw">cor</span>()</a></code></pre></div>
<pre><code>##                 humid  mean_delay      precip   pressure         temp
## humid       1.0000000  0.54331654  0.48014091 -0.3427556  0.318534448
## mean_delay  0.5433165  1.00000000  0.51510649 -0.3247584  0.150601446
## precip      0.4801409  0.51510649  1.00000000 -0.3014413  0.074916969
## pressure   -0.3427556 -0.32475840 -0.30144131  1.0000000 -0.488629288
## temp        0.3185344  0.15060145  0.07491697 -0.4886293  1.000000000
## visib      -0.7393902 -0.53844191 -0.49795469  0.2721685 -0.206815887
## wind_dir   -0.4978895 -0.20689204 -0.20823801 -0.2443716 -0.003608694
## wind_speed -0.1964910  0.05738881  0.15742776 -0.3687487 -0.085437521
##                  visib     wind_dir  wind_speed
## humid      -0.73939024 -0.497889528 -0.19649100
## mean_delay -0.53844191 -0.206892045  0.05738881
## precip     -0.49795469 -0.208238012  0.15742776
## pressure    0.27216848 -0.244371617 -0.36874869
## temp       -0.20681589 -0.003608694 -0.08543752
## visib       1.00000000  0.378625695  0.06152223
## wind_dir    0.37862569  1.000000000  0.43970745
## wind_speed  0.06152223  0.439707451  1.00000000</code></pre>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb623-1" title="1">diff_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb623-2" title="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>window_start_date) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb623-3" title="3"><span class="st">  </span><span class="kw">lm</span>(mean_delay <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb623-4" title="4"><span class="st">  </span><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mean_delay ~ ., data = .)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -32.843  -4.394  -0.189   3.749  27.177 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -0.022454   0.460301  -0.049 0.961121    
## humid         0.281416   0.082305   3.419 0.000701 ***
## precip      324.087906  63.453719   5.107 5.34e-07 ***
## pressure     -0.275033   0.149084  -1.845 0.065895 .  
## temp         -0.127570   0.143134  -0.891 0.373394    
## visib        -2.420046   0.728749  -3.321 0.000991 ***
## wind_dir      0.002373   0.012316   0.193 0.847329    
## wind_speed    0.128749   0.226138   0.569 0.569487    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 8.77 on 355 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.4111, Adjusted R-squared:  0.3995 
## F-statistic:  35.4 on 7 and 355 DF,  p-value: &lt; 2.2e-16</code></pre>

<p><em>Make sure the following packages are installed:</em></p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="24">
<li id="fn24"><p>note that a weighted average based on traffic would be more appropriate here because the <code>mean_delay</code> values will be weighted by number of flights going through each – hopefully lack of substantial difference between locatioins means this won’t be too impactful…<a href="13-relational-data.html#fnref24" class="footnote-back">↩</a></p></li>
</ol>
</div>
<div id="disqus_thread"></div>
<script>
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//brshallo.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the
<a href="https://disqus.com/?ref_noscript">
  comments powered by Disqus.</a></noscript>
            </section>

          </div>
        </div>
      </div>
<a href="12-tidy-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="14-strings.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": true,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
